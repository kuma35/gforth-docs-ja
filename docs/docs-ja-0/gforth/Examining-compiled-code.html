<!DOCTYPE html>
<html>
<!-- Created by GNU Texinfo 7.1, https://www.gnu.org/software/texinfo/ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<!-- このマニュアルは、 標準 Forth 言語の高速で移植可能な実装である Gforth (バージョン 0.7.9_20240418,
April 18, 2024)用です。 これはリファレンス・マニュアルとして機能しますが、 Forth の概要と Forth
チュートリアルも含まれています。

Authors: Bernd Paysan, Anton Ertl, Gerald Wodni Copyright © 1995,
1996, 1997, 1998, 2000, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010,
2011, 2012, 2013, 2014,2015,2016,2017,2018,2019,2020,2021,2022,2023 Free
Software Foundation, Inc.

Permission is granted to copy, distribute and/or modify this document under
the terms of the GNU Free Documentation License, Version 1.1 or any later
version published by the Free Software Foundation; with no Invariant
Sections, with the Front-Cover texts being "A GNU Manual," and with the
Back-Cover Texts as in (a) below.  A copy of the license is included in the
section entitled "GNU Free Documentation License."

(a) The FSF's Back-Cover Text is: "You have freedom to copy and modify this
GNU Manual, like GNU software.  Copies published by the Free Software
Foundation raise funds for GNU development." -->
<title>Examining compiled code (Gforth マニュアル)</title>

<meta name="description" content="Examining compiled code (Gforth マニュアル)">
<meta name="keywords" content="Examining compiled code (Gforth マニュアル)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<meta name="viewport" content="width=device-width,initial-scale=1">

<link href="index.html" rel="start" title="Top">
<link href="Word-Index.html" rel="index" title="Word Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Programming-Tools.html" rel="up" title="Programming Tools">
<link href="Examining-data.html" rel="next" title="Examining data">
<link href="Locating-exception-source.html" rel="prev" title="Locating exception source">
<style type="text/css">
<!--
a.copiable-link {visibility: hidden; text-decoration: none; line-height: 0em}
div.example {margin-left: 3.2em}
pre.format-preformatted {font-family: inherit}
span:hover a.copiable-link {visibility: visible}
-->
</style>
<link rel="stylesheet" type="text/css" href="gforth.css">


</head>

<body lang="en">
<div class="subsection-level-extent" id="Examining-compiled-code">
<div class="nav-panel">
<p>
Next: <a href="Examining-data.html" accesskey="n" rel="next">Examining data and code</a>, Previous: <a href="Locating-exception-source.html" accesskey="p" rel="prev">Locating exception source</a>, Up: <a href="Programming-Tools.html" accesskey="u" rel="up">Programming Tools</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Word-Index.html" title="Index" rel="index">Index</a>]</p>
</div>
<hr>
<h4 class="subsection" id="Examining-compiled-code-1"><span>6.26.4 Examining compiled code<a class="copiable-link" href="#Examining-compiled-code-1"> &para;</a></span></h4>
<a class="index-entry-id" id="index-compiled-code-examination"></a>

<p>そして最後に、 <code class="code">see</code> とそのファミリーが、 コンパイル済のコードの表示を行います。  ソース・コード内の一部の内容は、
コンパイルされたコードには存在しません(書式設定やコメント等)。 しかし、 これは、 マクロや Gforth
の最適化機能によってどのようなスレッド化コード(threaded code)やネイティブ・コード(native
code)が生成されるかを確認するのに役立ちます。
</p>
<a class="index-entry-id" id="index-see-_0028-_0022_003cspaces_003ename_0022-_002d_002d-_0029-tools"></a>
<a class="index-entry-id" id="index-see"></a>
<a class="index-entry-id" id="index-see-1"></a>
<div class="format">
<pre class="format-preformatted"><code class="code">see</code> ( <i class="i">&quot;&lt;spaces&gt;name&quot; &ndash;  </i>) tools &ldquo;see&rdquo;
</pre></div>
<p>現在の検索順序(search order)を使用して <var class="var">name</var> を <code class="code">locate</code> します。 <code class="code">locate</code>
できたら、 その定義を表示します。 これは定義を逆コンパイルすることで実現されるため、 書式は機械化され、
一部のソース情報(コメントや定義内のインタプリトされたシーケンスなど)は失われます。
</p>

<a class="index-entry-id" id="index-xt_002dsee-_0028-xt-_002d_002d-_0029-gforth_002d0_002e2"></a>
<a class="index-entry-id" id="index-xt_002dsee"></a>
<a class="index-entry-id" id="index-xt_002dsee-1"></a>
<div class="format">
<pre class="format-preformatted"><code class="code">xt-see</code> ( <i class="i">xt &ndash;  </i>) gforth-0.2 &ldquo;xt-see&rdquo;
</pre></div>
<p><i class="i">xt</i> で表される定義を逆コンパイルします。
</p>

<a class="index-entry-id" id="index-simple_002dsee-_0028-_0022name_0022-_002d_002d-_0029-gforth_002d0_002e6"></a>
<a class="index-entry-id" id="index-simple_002dsee"></a>
<a class="index-entry-id" id="index-simple_002dsee-1"></a>
<div class="format">
<pre class="format-preformatted"><code class="code">simple-see</code> ( <i class="i">&quot;name&quot; &ndash;  </i>) gforth-0.6 &ldquo;simple-see&rdquo;
</pre></div>
<p>コロン定義 <i class="i">name</i> を逆コンパイルして各セルごとに行表示し、 セルの意味を推測してそれを表示します。
</p>

<a class="index-entry-id" id="index-xt_002dsimple_002dsee-_0028-xt-_002d_002d-_0029-gforth_002d1_002e0"></a>
<a class="index-entry-id" id="index-xt_002dsimple_002dsee"></a>
<a class="index-entry-id" id="index-xt_002dsimple_002dsee-1"></a>
<div class="format">
<pre class="format-preformatted"><code class="code">xt-simple-see</code> ( <i class="i">xt &ndash;  </i>) gforth-1.0 &ldquo;xt-simple-see&rdquo;
</pre></div>
<p><code class="code">simple-see</code> のようにコロン定義 <i class="i">xt</i> を逆コンパイルします。
</p>

<a class="index-entry-id" id="index-simple_002dsee_002drange-_0028-addr1-addr2-_002d_002d-_0029-gforth_002d0_002e6"></a>
<a class="index-entry-id" id="index-simple_002dsee_002drange"></a>
<a class="index-entry-id" id="index-simple_002dsee_002drange-1"></a>
<div class="format">
<pre class="format-preformatted"><code class="code">simple-see-range</code> ( <i class="i">addr1 addr2 &ndash;  </i>) gforth-0.6 &ldquo;simple-see-range&rdquo;
</pre></div>
<p>[<i class="i">addr1</i>,<i class="i">addr2</i>) ( <i class="i">addr1</i> &lt;= and &lt; <i class="i">addr2</i> )の範囲のコードを
<code class="code">simple-see</code>  のように逆コンパイルします
</p>

<a class="index-entry-id" id="index-see_002dcode-_0028-_0022name_0022-_002d_002d-_0029-gforth_002d0_002e7"></a>
<a class="index-entry-id" id="index-see_002dcode"></a>
<a class="index-entry-id" id="index-see_002dcode-1"></a>
<div class="format">
<pre class="format-preformatted"><code class="code">see-code</code> ( <i class="i">&quot;name&quot; &ndash;  </i>) gforth-0.7 &ldquo;see-code&rdquo;
</pre></div>
<p><code class="code">simple-see</code> と似ていますが、 インライン化されたプリミティブの動的ネイティブ・コード(dynamic native
code)も表示されます。  静的命令融合(superinstructions)の場合、
最初のプリミティブではなくプリミティブ・シーケンスが表示されます(命令融合(superinstructions)の他のプリミティブも表示されます)。
ネイティブ・コードが生成されるプリミティブの場合、 最初と最後のレジスタ内のスタック項目の数が表示されます(たとえば、 <code class="code">1-&gt;1</code> は、
最初と最後のレジスターに 1 つのスタック項目があることを意味します)。
ネイティブ・コードを使用した各プリミティブまたは命令融合(superinstructions)については、
インライン引数とコンポーネント・プリミティブが最初に表示され、 次にネイティブ・コードが表示されます。
</p>

<a class="index-entry-id" id="index-xt_002dsee_002dcode-_0028-xt-_002d_002d-_0029-gforth_002d1_002e0"></a>
<a class="index-entry-id" id="index-xt_002dsee_002dcode"></a>
<a class="index-entry-id" id="index-xt_002dsee_002dcode-1"></a>
<div class="format">
<pre class="format-preformatted"><code class="code">xt-see-code</code> ( <i class="i">xt &ndash;  </i>) gforth-1.0 &ldquo;xt-see-code&rdquo;
</pre></div>
<p>コロン定義 <i class="i">xt</i> を <code class="code">see-code</code> のように逆コンパイルします。
</p>

<a class="index-entry-id" id="index-see_002dcode_002drange-_0028-addr1-addr2-_002d_002d-_0029-gforth_002d0_002e7"></a>
<a class="index-entry-id" id="index-see_002dcode_002drange"></a>
<a class="index-entry-id" id="index-see_002dcode_002drange-1"></a>
<div class="format">
<pre class="format-preformatted"><code class="code">see-code-range</code> ( <i class="i">addr1 addr2 &ndash;  </i>) gforth-0.7 &ldquo;see-code-range&rdquo;
</pre></div>
<p>[<i class="i">addr1</i>,<i class="i">addr2</i>) ( <i class="i">addr1</i> &lt;= and &lt; <i class="i">addr2</i> )の範囲のコードを
<code class="code">see-code</code> のように逆コンパイルします。
</p>


<p>例として、 以下について考えてみましょう:
</p>
<div class="example">
<pre class="example-preformatted">: foo x f@ fsin drop over ;
</pre></div>

<p>この例は特に役に立つわけではありませんが、 さまざまなコード生成の違いを示しています。  これを AMD64 の <code class="code">gforth-fast</code>
でコンパイルし、 <code class="code">see-code foo</code> を使用すると以下の出力が得られます(訳注: OSのコマンドラインから、
<code class="code">gforth</code> ではなくて <code class="code">gforth-fast</code> で起動する):
</p>
<div class="example">
<pre class="example-preformatted">$7FD0CEE8C510 lit f@     1-&gt;1 
$7FD0CEE8C518 x
$7FD0CEE8C520 f@
7FD0CEB51697:   movsd   [r12],xmm15
7FD0CEB5169D:   mov     rax,$00[r13]
7FD0CEB516A1:   sub     r12,$08
7FD0CEB516A5:   add     r13,$18
7FD0CEB516A9:   movsd   xmm15,[rax]
7FD0CEB516AE:   mov     rcx,-$08[r13]
7FD0CEB516B2:   jmp     ecx
$7FD0CEE8C528 fsin
$7FD0CEE8C530 drop    1-&gt;0 
7FD0CEB516B4:   add     r13,$08
$7FD0CEE8C538 over    0-&gt;1 
7FD0CEB516B8:   mov     r8,$10[r15]
7FD0CEB516BC:   add     r13,$08
$7FD0CEE8C540 ;s    1-&gt;1 
7FD0CEB516C0:   mov     r10,[rbx]
7FD0CEB516C3:   add     rbx,$08
7FD0CEB516C7:   lea     r13,$08[r10]
7FD0CEB516CB:   mov     rcx,-$08[r13]
7FD0CEB516CF:   jmp     ecx
</pre></div>

<p>まず、 コンポーネント <code class="code">lit</code> と <code class="code">f@</code>
を含む静的命令融合(superinstruction)のスレッド化コード・セルが表示されます。 それは、 レジスター内の 1 つのデータ・スタック項目
(<code class="code">1-&gt;1</code>) で始まり・終わります。 )。 これに、<code class="code">lit</code> の引数 <code class="code">x</code> のセルと、 命令融合の
<code class="code">f@</code> コンポーネントのセルが続きます。 後者のセルは使用されませんが、 Gforth 内部の理由により存在します。
</p>
<p>その次に、 命令融合 <code class="code">lit f@</code> に対して動的に生成されたネイティブ・コードを表示します。 注意: アドレスを比較するとわかるように、
このネイティブ・コードはメモリー内のスレッド化コードと混合されていない(not mixed)ことに注意してください。
</p>
<p>ここに表示されているネイティブ・コードを理解するには、以下のレジスターについて知っておくべきです:<br>スレッド化コードの命令ポインターは
<code class="code">r13</code><br>データ・スタック・ポインターは <code class="code">r15</code><br>最初(TOS)のデータ・スタック・レジスターは <code class="code">r8</code>
(データ・スタックのTOS、 つまり、 レジスターにデータ・スタック項目が 1 つある場合、 スタックのTOSがそこに存在します)<br>リターン・スタック
ポインターは <code class="code">rbx</code><br>FP スタック・ポインターは <code class="code">r12</code><br>FP スタックの先頭(TOS)は
<code class="code">xmm15</code><br>注意: レジスターの割り当てはエンジンによって異なるため、
コード表示においては異なるレジスターの割り当てが表示される場合があることに注意してください。
</p>
<p><code class="code">lit f@</code> の動的ネイティブ・コードは、 ディスパッチ・ジャンプ(dispatch jump;別名 NEXT)(訳注:
古典的には内部インタープリターへ制御を戻すためのジャンプ)で終了します。 これは、 定義内の次のワード <code class="code">fsin</code>
のネイティブ・コードは動的に生成しないためです。
</p>
<p>次に、 <code class="code">fsin</code> のスレッド化コード・セルが表示されます。  このワードには動的に生成されるネイティブ・コードはなく、
<code class="code">see-code</code> では静的ネイティブ・コードは表示されません(<code class="code">fsin</code> の静的ネイティブ・コードを確認したければ
<code class="code">see fsin</code>)。  <code class="code">gforth-fast</code> 内の静的ネイティブ・コードを含むすべてのワードと同様、
データ・スタック表現への影響は <code class="code">1-&gt;1</code> (<code class="code">gforth</code> エンジンでは <code class="code">0-&gt;0</code>) です。 しかし、
これは表示されません。
</p>
<p>次に、 <code class="code">drop</code> のスレッド化コード・セルが表示されます。 ここで使用されるネイティブ・コード版のバリエーションは、 レジスター内の 1
つのデータ・スタック項目で始まり、 レジスター内の 0 個のデータ スタック項目で終わります(<code class="code">1-&gt;0</code>)。  この後に
<code class="code">drop</code> のこのバリエーションのネイティブ・コードが続きます。 ここのネイティブ・コードは次のワードのコードに続くため、 ここには
NEXT はありません。
</p>
<p>次に、 <code class="code">over</code> のスレッド化コード・セルと、 その後に <code class="code">0-&gt;1</code>
バリエーションで動的に生成されたネイティブ・コードが表示されます。
</p>
<p>最後に、 <code class="code">;s</code>  のスレッド化されたネイティブ・コード(<code class="code">foo</code> 内の <code class="code">;</code>
用にコンパイルされたプリミティブ)が表示されます。 <code class="code">;s</code> は制御フローを実行する(制御フローからリターンする)ため、 NEXT
で終了する必要があります。
</p>
</div>
<hr>
<div class="nav-panel">
<p>
Next: <a href="Examining-data.html">Examining data and code</a>, Previous: <a href="Locating-exception-source.html">Locating exception source</a>, Up: <a href="Programming-Tools.html">Programming Tools</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Word-Index.html" title="Index" rel="index">Index</a>]</p>
</div>



</body>
</html>
