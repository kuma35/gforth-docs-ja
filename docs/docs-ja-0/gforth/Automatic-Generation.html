<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!-- Created by GNU Texinfo 6.8, https://www.gnu.org/software/texinfo/ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<!-- このマニュアルは、 標準 Forth 言語の高速で移植可能な実装である Gforth (バージョン 0.7.9_20240418,
April 18, 2024)用です。 これはリファレンス・マニュアルとして機能しますが、 Forth の概要と Forth
チュートリアルも含まれています。

Authors: Bernd Paysan, Anton Ertl, Gerald Wodni Copyright (C) 1995,
1996, 1997, 1998, 2000, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010,
2011, 2012, 2013, 2014,2015,2016,2017,2018,2019,2020,2021,2022,2023 Free
Software Foundation, Inc.

Permission is granted to copy, distribute and/or modify this document under
the terms of the GNU Free Documentation License, Version 1.1 or any later
version published by the Free Software Foundation; with no Invariant
Sections, with the Front-Cover texts being "A GNU Manual," and with the
Back-Cover Texts as in (a) below.  A copy of the license is included in the
section entitled "GNU Free Documentation License."

(a) The FSF's Back-Cover Text is: "You have freedom to copy and modify this
GNU Manual, like GNU software.  Copies published by the Free Software
Foundation raise funds for GNU development." -->
<title>Automatic Generation (Gforth マニュアル)</title>

<meta name="description" content="Automatic Generation (Gforth マニュアル)">
<meta name="keywords" content="Automatic Generation (Gforth マニュアル)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<meta name="viewport" content="width=device-width,initial-scale=1">

<link href="index.html" rel="start" title="Top">
<link href="Word-Index.html" rel="index" title="Word Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Primitives.html" rel="up" title="Primitives">
<link href="TOS-Optimization.html" rel="next" title="TOS Optimization">
<link href="Primitives.html" rel="prev" title="Primitives">
<style type="text/css">
<!--
a.copiable-anchor {visibility: hidden; text-decoration: none; line-height: 0em}
a.summary-letter {text-decoration: none}
blockquote.indentedblock {margin-right: 0em}
div.display {margin-left: 3.2em}
div.example {margin-left: 3.2em}
kbd {font-style: oblique}
pre.display {font-family: inherit}
pre.format {font-family: inherit}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
span.nolinebreak {white-space: nowrap}
span.roman {font-family: initial; font-weight: normal}
span.sansserif {font-family: sans-serif; font-weight: normal}
span:hover a.copiable-anchor {visibility: visible}
ul.no-bullet {list-style: none}
-->
</style>
<link rel="stylesheet" type="text/css" href="gforth.css">


</head>

<body lang="en">
<div class="subsection" id="Automatic-Generation">
<div class="header">
<p>
Next: <a href="TOS-Optimization.html" accesskey="n" rel="next">TOS Optimization</a>, Previous: <a href="Primitives.html" accesskey="p" rel="prev">Primitives</a>, Up: <a href="Primitives.html" accesskey="u" rel="up">Primitives</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Word-Index.html" title="Index" rel="index">Index</a>]</p>
</div>
<hr>
<span id="Automatic-Generation-1"></span><h4 class="subsection">15.3.1 Automatic Generation</h4>
<span id="index-primitives_002c-automatic-generation"></span>

<span id="index-prims2x_002efs"></span>

<p>プリミティブは移植可能な言語(portable language)で実装されているため、 最早プリミティブの数を最小限に抑える必要はありません。 逆に、
多くのプリミティブを持つことには速度という利点があります。 プリミティブでのエラーの数を減らし、 プリミティブのプログラミングを容易にするために、
プリミティブ・ジェネレーター (<samp>prims2x.fs</samp> 別名 Vmgen see <a data-manual="vmgen" href="../vmgen/index.html#Top">Introduction</a> in <cite>Vmgen</cite>)というツールを提供しており、 それは、 スタック効果の表記からプリミティブの
C言語コードの大部分(場合によってはすべて)を自動的に生成します。  プリミティブのソースの形式は以下のとおりです:
</p>
<span id="index-primitive-source-format"></span>
<div class="format">
<pre class="format"><i>Forth-name</i>  ( <i>stack-effect</i> )        <i>category</i>    [<i>pronounc.</i>]
[<code>&quot;&quot;</code><i>glossary entry</i><code>&quot;&quot;</code>]
<i>C code</i>
[<code>:</code>
<i>Forth code</i>]
</pre></div>

<p>角括弧(brackets)内の項目はオプションです。
カテゴリ(category)と用語集(glossary)のフィールドはドキュメントを生成するためにあり、 Forth コードは GNU C
を持たないマシンでの手動実装のためにあります。 たとえば、 プリミティブ <code>+</code> のソースは以下のとおりです:
</p><div class="example">
<pre class="example">+    ( n1 n2 -- n )   core    plus
n = n1+n2;
</pre></div>

<p>これは仕様のように見えますが、 実際には <code>n = n1+n2</code> は C言語のコードです。 私たちのプリミティブ生成ツールは、
スタック効果の表記から多くの情報を抽出します<a id="DOCF38" href="#FOOT38"><sup>38</sup></a>: それらは、 スタックからポップされた項目とスタックにプッシュされた項目の数、 その型、
および C言語のコード内で参照される名前 です。 その次に、 各プリミティブの C言語コードの prelude と postlude を生成します。
<code>+</code> の最終的な C言語コードは以下のようになります:
</p>
<div class="example">
<pre class="example">I_plus: /* + ( n1 n2 -- n ) */  /* label, stack effect */
/*  */                          /* documentation */
NAME(&quot;+&quot;)                       /* debugging output (with -DDEBUG) */
{
DEF_CA                          /* definition of variable ca (indirect threading) */
Cell n1;                        /* definitions of variables */
Cell n2;
Cell n;
NEXT_P0;                        /* NEXT part 0 */
n1 = (Cell) sp[1];              /* input */
n2 = (Cell) TOS;
sp += 1;                        /* stack adjustment */
{
n = n1+n2;                      /* C code taken from the source */
}
NEXT_P1;                        /* NEXT part 1 */
TOS = (Cell)n;                  /* output */
NEXT_P2;                        /* NEXT part 2 */
}
</pre></div>

<p>これは長くて非効率に見えますが、 GNU C コンパイラーは非常に適切に最適化して、 例えば R3000 や HP RISC マシンなどで
<code>+</code> に最適なコードを生成します。 <code>n</code> 達を定義してもコードは生成されませんし、 また、
それら中間ストレージとして使用してもコストはかかりません。
</p>
<p>この例では示されていない他の最適化もあります。 単純な変数間の代入は通常はコストがかかりません(コピー伝播)。 スタック項目の 1
つがプリミティブによって使用されていない場合(<code>drop</code> など)、
コンパイラーはスタックのその部分の負荷を削除します(デッド・コードの削除)。 一方、 コンパイラーが実行しない処理もいくつかあり、 そのため、 それらは
<samp>prims2x.fs</samp> によって実行されます。 コンパイラは、 スタック項目を元の場所に格納するコードを最適化しません(例:
<code>over</code>).
</p>
<p>プリミティブのプログラミングは通常は簡単ですが、 最も顕著な <code>?dup</code> だけでなく、 <code>NEXT</code>
に(常に)フローが流れていかないワードについても、 プログラマがジェネレーターのアクションを考慮する必要があるケースがいくつかあります。 
</p>
<p>詳細について(原文未記述)
</p>
</div>
<div class="footnote">
<hr>
<h4 class="footnotes-heading">Footnotes</h4>

<h5><a id="FOOT38" href="#DOCF38">(38)</a></h5>
<p>データと浮動小数点スタックが別々に存在する場合でも、1 つのスタック表記法を使用します。
個別の表記は、 統一された表記から簡単に生成できます。</p>
</div>



</body>
</html>
