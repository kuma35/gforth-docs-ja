<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!-- Created by GNU Texinfo 6.8, https://www.gnu.org/software/texinfo/ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<!-- このマニュアルは、 標準 Forth 言語の高速で移植可能な実装である Gforth (バージョン 0.7.9_20240418,
April 18, 2024)用です。 これはリファレンス・マニュアルとして機能しますが、 Forth の概要と Forth
チュートリアルも含まれています。

Authors: Bernd Paysan, Anton Ertl, Gerald Wodni Copyright (C) 1995,
1996, 1997, 1998, 2000, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010,
2011, 2012, 2013, 2014,2015,2016,2017,2018,2019,2020,2021,2022,2023 Free
Software Foundation, Inc.

Permission is granted to copy, distribute and/or modify this document under
the terms of the GNU Free Documentation License, Version 1.1 or any later
version published by the Free Software Foundation; with no Invariant
Sections, with the Front-Cover texts being "A GNU Manual," and with the
Back-Cover Texts as in (a) below.  A copy of the license is included in the
section entitled "GNU Free Documentation License."

(a) The FSF's Back-Cover Text is: "You have freedom to copy and modify this
GNU Manual, like GNU software.  Copies published by the Free Software
Foundation raise funds for GNU development." -->
<title>User-defined defining words with colon definitions (Gforth マニュアル)</title>

<meta name="description" content="User-defined defining words with colon definitions (Gforth マニュアル)">
<meta name="keywords" content="User-defined defining words with colon definitions (Gforth マニュアル)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<meta name="viewport" content="width=device-width,initial-scale=1">

<link href="index.html" rel="start" title="Top">
<link href="Word-Index.html" rel="index" title="Word Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="User_002ddefined-Defining-Words.html" rel="up" title="User-defined Defining Words">
<link href="User_002ddefined-defining-words-using-CREATE.html" rel="next" title="User-defined defining words using CREATE">
<link href="User_002ddefined-Defining-Words.html" rel="prev" title="User-defined Defining Words">
<style type="text/css">
<!--
a.copiable-anchor {visibility: hidden; text-decoration: none; line-height: 0em}
a.summary-letter {text-decoration: none}
blockquote.indentedblock {margin-right: 0em}
div.display {margin-left: 3.2em}
div.example {margin-left: 3.2em}
kbd {font-style: oblique}
pre.display {font-family: inherit}
pre.format {font-family: inherit}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
span.nolinebreak {white-space: nowrap}
span.roman {font-family: initial; font-weight: normal}
span.sansserif {font-family: sans-serif; font-weight: normal}
span:hover a.copiable-anchor {visibility: visible}
ul.no-bullet {list-style: none}
-->
</style>
<link rel="stylesheet" type="text/css" href="gforth.css">


</head>

<body lang="en">
<div class="subsubsection" id="User_002ddefined-defining-words-with-colon-definitions">
<div class="header">
<p>
Next: <a href="User_002ddefined-defining-words-using-CREATE.html" accesskey="n" rel="next">User-defined defining words using create</a>, Previous: <a href="User_002ddefined-Defining-Words.html" accesskey="p" rel="prev">User-defined Defining Words</a>, Up: <a href="User_002ddefined-Defining-Words.html" accesskey="u" rel="up">User-defined Defining Words</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Word-Index.html" title="Index" rel="index">Index</a>]</p>
</div>
<hr>
<span id="User_002ddefined-defining-words-with-colon-definitions-1"></span><h4 class="subsubsection">6.10.10.1 User-defined defining words with colon definitions</h4>

<p>既存の定義ワードをくるんで定義時コードを被せ、 そのシーケンスをコロン定義に入れることによって、 新しい定義ワードを作成できます。 
</p>

<p>たとえば、 定義の <i>xt</i> を指定してコロン定義に関する統計を収集するワード <code>stats</code> があり、
アプリケーション内のすべてのコロン定義で <code>stats</code> を呼び出す必要があるとします。 これには、 以下のように <code>:</code>
の新しいバージョンを定義して使用できます:
</p>
<div class="example">
<pre class="example">: stats
  ( xt -- ) DUP .&quot; (Gathering statistics for &quot; . .&quot; )&quot;
  ... ;  \ other code

: my: : latestxt postpone literal ['] stats compile, ;

my: foo + - ;
</pre></div>

<p><code>my:</code> を使用して <code>foo</code> を定義する場合、 以下のステップが実行されます:
</p>
<ul>
<li> <code>my:</code> が実行されます。
</li><li> 定義内の <code>:</code> (<code>my:</code> と <code>latestxt</code> の間にあるもの) が実行され、 <code>:</code> として、
いつもと同じことを行います。 名前ために入力ストリームをパースし、 名前 <code>foo</code> のディクショナリ・ヘッダーを構築し、
<code>state</code> をインタプリタ状態からコンパイル状態に切り替えます。
</li><li> <code>latestxt</code> というワードが実行されます。 定義中のワード(<code>foo</code>)の <i>xt</i> をスタックに置きます。
</li><li> <code>postpone literal</code> によって生成されたコードが実行されます。 これにより、 スタック上の値(<code>foo</code> の
<i>xt</i>)が <code>foo</code> のコード領域にリテラルとしてコンパイルされます。
</li><li> コード <code>['] stats</code> は、 <code>my:</code> の定義時に、 リテラルを <code>my:</code> の定義内にコンパイルします(訳注:
そして、 <code>my:</code> の実行時は <code>stats</code> の <i>xt</i> をスタックに積みます)。 そして、
<code>compile,</code> が実行されると、 <code>foo</code> のコード領域に、 上記に続けて <code>stats</code> の <i>xt</i>
をコンパイルします<a id="DOCF15" href="#FOOT15"><sup>15</sup></a>。
</li><li> この時点で、 <code>my:</code> の実行が完了し、 制御がテキスト・インタプリタに戻ります。 テキスト・インタプリタはコンパイル状態にあるため、
後続のテキスト <code>+ -</code> は <code>foo</code> の定義にコンパイルされ、 いつものように <code>;</code> によって定義が終了します。
</li></ul>

<p><code>see</code> を使用すると、 <code>my:</code> を使用して定義されたワードを逆コンパイルし、 それが通常の <code>:</code>
定義とどのように異なるかを確認できます。 例:
</p>
<div class="example">
<pre class="example">: bar + - ;  \ like foo but using : rather than my:
see bar
: bar
  + - ;
see foo
: foo
  `foo stats + - ;
</pre></div>

<p><code>`foo</code> は <code>['] foo</code> を記述する別の方法です。
</p>


</div>
<div class="footnote">
<hr>
<h4 class="footnotes-heading">Footnotes</h4>

<h5><a id="FOOT15" href="#DOCF15">(15)</a></h5>
<p>厳密に言えば、 <code>compile,</code> が <i>xt</i>
をコード領域内の何かに変換するために使用するメカニズムは実装に依存します。 スレッド実装は実行トークンを直接吐き出す場合がありますが、
別の実装はネイティブ・コード・シーケンスを吐き出す場合があります</p>
</div>



</body>
</html>
