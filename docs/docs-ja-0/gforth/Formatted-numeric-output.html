<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!-- Created by GNU Texinfo 6.8, https://www.gnu.org/software/texinfo/ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<!-- このマニュアルは、 標準 Forth 言語の高速で移植可能な実装である Gforth (バージョン 0.7.9_20240418,
April 18, 2024)用です。 これはリファレンス・マニュアルとして機能しますが、 Forth の概要と Forth
チュートリアルも含まれています。

Authors: Bernd Paysan, Anton Ertl, Gerald Wodni Copyright (C) 1995,
1996, 1997, 1998, 2000, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010,
2011, 2012, 2013, 2014,2015,2016,2017,2018,2019,2020,2021,2022,2023 Free
Software Foundation, Inc.

Permission is granted to copy, distribute and/or modify this document under
the terms of the GNU Free Documentation License, Version 1.1 or any later
version published by the Free Software Foundation; with no Invariant
Sections, with the Front-Cover texts being "A GNU Manual," and with the
Back-Cover Texts as in (a) below.  A copy of the license is included in the
section entitled "GNU Free Documentation License."

(a) The FSF's Back-Cover Text is: "You have freedom to copy and modify this
GNU Manual, like GNU software.  Copies published by the Free Software
Foundation raise funds for GNU development." -->
<title>Formatted numeric output (Gforth マニュアル)</title>

<meta name="description" content="Formatted numeric output (Gforth マニュアル)">
<meta name="keywords" content="Formatted numeric output (Gforth マニュアル)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<meta name="viewport" content="width=device-width,initial-scale=1">

<link href="index.html" rel="start" title="Top">
<link href="Word-Index.html" rel="index" title="Word Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Other-I_002fO.html" rel="up" title="Other I/O">
<link href="Floating_002dpoint-output.html" rel="next" title="Floating-point output">
<link href="Simple-numeric-output.html" rel="prev" title="Simple numeric output">
<style type="text/css">
<!--
a.copiable-anchor {visibility: hidden; text-decoration: none; line-height: 0em}
a.summary-letter {text-decoration: none}
blockquote.indentedblock {margin-right: 0em}
div.display {margin-left: 3.2em}
div.example {margin-left: 3.2em}
kbd {font-style: oblique}
pre.display {font-family: inherit}
pre.format {font-family: inherit}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
span.nolinebreak {white-space: nowrap}
span.roman {font-family: initial; font-weight: normal}
span.sansserif {font-family: sans-serif; font-weight: normal}
span:hover a.copiable-anchor {visibility: visible}
ul.no-bullet {list-style: none}
-->
</style>
<link rel="stylesheet" type="text/css" href="gforth.css">


</head>

<body lang="en">
<div class="subsection" id="Formatted-numeric-output">
<div class="header">
<p>
Next: <a href="Floating_002dpoint-output.html" accesskey="n" rel="next">Floating-point output</a>, Previous: <a href="Simple-numeric-output.html" accesskey="p" rel="prev">Simple numeric output</a>, Up: <a href="Other-I_002fO.html" accesskey="u" rel="up">Other I/O</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Word-Index.html" title="Index" rel="index">Index</a>]</p>
</div>
<hr>
<span id="Formatted-numeric-output-1"></span><h4 class="subsection">6.20.2 Formatted numeric output</h4>
<span id="index-formatted-numeric-output"></span>
<span id="index-pictured-numeric-output"></span>
<span id="index-numeric-output-_002d-formatted"></span>

<p>Forth は伝統的に、 整数の書式設定された出力に「表示数値出力」(<em>pictured numeric Output</em>)
と呼ばれる手法を使用しています。  この手法では、 数値から数字桁(digits)が抽出され(<code>base</code> で定義された現在の出力基数を使用
see <a href="Number-Conversion.html">Number Conversion</a>)、 ASCII コードに変換され、 メモリのスクラッチパッド領域(see <a href="core_002didef.html">Implementation-defined
options</a>)に構築される文字列の先頭に付加されます。 抽出プロセス中に、 文字列の先頭に任意の文字を追加できます。
完成した文字列はアドレスと長さによって指定され、 プログラム制御の下で操作(<code>TYPE</code> や、 コピーや、 変更)できます。
</p>
<p>前のセクションで説明したすべての整数出力ワード (see <a href="Simple-numeric-output.html">Simple numeric output</a>) は、 Gforth
では表示数値出力(pictured numeric output)を使用して実装されています。
</p>
<p>表示数値出力(pictured numeric output)について覚えておくべき 3 つの重要な点:
</p>
<ul>
<li> 常に2倍長整数を処理します。 1倍長整数を表示するには、 まず最初に2倍長に変換します (これを行う方法は see <a href="Double-precision.html">Double precision</a>)。
</li><li> 2倍長整数は常に符号無しであるかのように扱われます。 下記の例は、 符号付き数値を出力する方法を示しています。
</li><li> 文字列は右から左に構築されます。 最下位桁が最初です。
</li></ul>

<p>標準 Forth は、 <code>&lt;#</code> で空にして初期化し、 <code>#&gt;</code>
で結果文字列を取得する単一の出力バッファー(別名ホールド領域;hold area)をサポートします。
</p>
<p>Gforth はさらに、 このバッファーの入れ子になった使用をサポートしており、 たとえば、 ホールド領域を処理するコード内でデバッグ・トレーサー
<code>~~</code> からの出力を入れ子にすることができます。 <code>&lt;&lt;#</code> は新しい入れ子を開始し、  <code>#&gt;</code>
は結果文字列を生成し、 <code>#&gt;&gt;</code> は入れ子を解除します。 入れ子のホールド領域が再利用され、<code>#&gt;</code>
は次に外側の入れ子の文字列を生成します。  Gforth の高レベルの数値出力ワードはすべて <code>&lt;&lt;#</code> ... <code>#&gt;</code>
... <code>#&gt;&gt;</code> を使用し、 ホールド領域の他のユーザー内に入れ子にできます。
</p>
<span id="index-_003c_0023-_0028--_002d_002d--_0029-core"></span>
<span id="index-_003c_0023"></span>
<span id="index-_003c_0023-1"></span>
<div class="format">
<pre class="format"><code>&lt;#</code> ( <i>&ndash;  </i>) core &ldquo;less-number-sign&rdquo;
</pre></div>
<p>表示数値出力文字列を 初期化/クリア します(訳注: 表示数値出力用のポインターをホールド領域の末尾(初期値)に戻すだけ。 中身は消さない。)
</p>

<span id="index-_003c_003c_0023-_0028--_002d_002d--_0029-gforth_002d0_002e5"></span>
<span id="index-_003c_003c_0023"></span>
<span id="index-_003c_003c_0023-1"></span>
<div class="format">
<pre class="format"><code>&lt;&lt;#</code> ( <i>&ndash;  </i>) gforth-0.5 &ldquo;less-less-number-sign&rdquo;
</pre></div>
<p><code>#&gt;&gt;</code> で終わるホールド領域を開始します。 相互に入れ子にすることも、 <code>&lt;#</code> で入れ子にすることもできます。  注:
<code>&lt;&lt;#</code> と <code>#&gt;&gt;</code> を一致させないと、 最終的にホールド領域が不足します。 <code>&lt;#</code>
を使用してホールド領域を空にリセットできます。
</p>

<span id="index-_0023-_0028--ud1-_002d_002d-ud2--_0029-core"></span>
<span id="index-_0023"></span>
<span id="index-_0023-1"></span>
<div class="format">
<pre class="format"><code>#</code> ( <i>ud1 &ndash; ud2  </i>) core &ldquo;number-sign&rdquo;
</pre></div>
<p><code>&lt;&lt;#</code> と <code>#&gt;</code> の間で使用されます。  <var>ud1</var> の最下位桁(<code>base</code> による)を、
表示数値出力文字列の先頭に追加します。  <var>ud2</var> は <var>ud1/base</var>、 つまり残りの桁を表す数値です。
</p>

<span id="index-_0023s-_0028--ud-_002d_002d-0-0--_0029-core"></span>
<span id="index-_0023s"></span>
<span id="index-_0023s-1"></span>
<div class="format">
<pre class="format"><code>#s</code> ( <i>ud &ndash; 0 0  </i>) core &ldquo;number-sign-s&rdquo;
</pre></div>
<p><code>&lt;&lt;#</code> と <code>#&gt;</code> の間で使用されます。  <var>ud</var> のすべての数字を表示数値出力文字列の先頭に追加します。
<code>#s</code> は少なくとも 1 つの数字を変換します。 したがって、 <var>ud</var> が 0 の場合、 <code>#s</code>
は表示数値出力文字列の先頭に &lsquo;0&lsquo; を追加します。
</p>

<span id="index-hold-_0028--char-_002d_002d--_0029-core"></span>
<span id="index-hold"></span>
<span id="index-hold-1"></span>
<div class="format">
<pre class="format"><code>hold</code> ( <i>char &ndash;  </i>) core &ldquo;hold&rdquo;
</pre></div>
<p><code>&lt;&lt;#</code> と <code>#&gt;</code> の間で使用されます。 表示数値出力文字列の前に文字 <var>char</var> を追加します。
</p>

<span id="index-holds-_0028--addr-u-_002d_002d--_0029-core_002dext"></span>
<span id="index-holds"></span>
<span id="index-holds-1"></span>
<div class="format">
<pre class="format"><code>holds</code> ( <i>addr u &ndash;  </i>) core-ext &ldquo;holds&rdquo;
</pre></div>
<p><code>&lt;&lt;#</code> と <code>#&gt;</code> の間で使用されます。 表示数値出力文字列の前に文字列 <code>addr u</code> を追加します。
</p>

<span id="index-sign-_0028--n-_002d_002d--_0029-core"></span>
<span id="index-sign"></span>
<span id="index-sign-1"></span>
<div class="format">
<pre class="format"><code>sign</code> ( <i>n &ndash;  </i>) core &ldquo;sign&rdquo;
</pre></div>
<p><code>&lt;&lt;#</code> と <code>#&gt;</code> の間で使用されます。 <var>n</var> (1倍長整数) が負の場合、 表示数値出力文字列の先頭に
<code>-</code> を追加します。
</p>

<span id="index-_0023_003e-_0028--xd-_002d_002d-addr-u--_0029-core"></span>
<span id="index-_0023_003e"></span>
<span id="index-_0023_003e-1"></span>
<div class="format">
<pre class="format"><code>#&gt;</code> ( <i>xd &ndash; addr u  </i>) core &ldquo;number-sign-greater&rdquo;
</pre></div>
<p>変換対象(変換残りの)数値 <var>xd</var> を破棄し、 フォーマットされた文字列のアドレスと長さを示す <var>addr u</var> を返すことで、
表示数値出力文字列を完成させます。 標準のプログラムでは、 文字列内の文字を変更する場合があります。  ホールド領域は解放されません。
<code>#&gt;&gt;</code> を使用して <code>&lt;&lt;#</code> で始まるホールド領域を解放するか、 <code>&lt;#</code>
を使用してすべてのホールド領域を解放します。
</p>

<span id="index-_0023_003e_003e-_0028--_002d_002d--_0029-gforth_002d0_002e5"></span>
<span id="index-_0023_003e_003e"></span>
<span id="index-_0023_003e_003e-1"></span>
<div class="format">
<pre class="format"><code>#&gt;&gt;</code> ( <i>&ndash;  </i>) gforth-0.5 &ldquo;number-sign-greater-greater&rdquo;
</pre></div>
<p><code>&lt;&lt;#</code> で始まるホールド領域を解放します。
</p>


<p>以下に、 表示数値出力の使用例をいくつか示します:
</p>
<div class="example">
<pre class="example">: my-u. ( u -- )
  \ PNS(Pictured Number String)の最も単純な使用法。標準の u. のように振る舞います。
  0              \ 上記 u を 2倍長にする
  &lt;&lt;#            \ 変換開始
  #s             \ 全桁を変換
  #&gt;             \ 変換終了
  TYPE SPACE     \ 表示、続けて空白1つ
  #&gt;&gt; ;          \ ホールド領域を開放

: cents-only ( u -- )
  0              \ 上記 u を 2倍長整数に変換
  &lt;&lt;#            \ 変換開始
  # #            \ 最下位と最下位からの次の 2 桁のみ変換
  #&gt;             \ 変換完了。他の桁は破棄
  TYPE SPACE     \ 表示、続けて空白1つ
  #&gt;&gt; ;          \ ホールド領域を開放

: dollars-and-cents ( u -- )
  0              \ 上記 u を符号無し2倍長整数に変換
  &lt;&lt;#            \ 変換開始
  # #            \ 下位2桁を変換
  '.' hold       \ 小数点を打つ
  #s             \ 残りの桁を変換
  '$' hold       \ 通貨記号を打つ
  #&gt;             \ 変換完了
  TYPE SPACE     \ 表示、続けて空白1つ
  #&gt;&gt; ;          \ ホールド領域を開放

: my-. ( n -- )
  \ 負数も処理する標準の . のように振る舞う
  s&gt;d            \ 符号付き2倍長整数に変換
  swap over dabs \ 符号バイトを別途保存して数値は符号無し2倍長に
  &lt;&lt;#            \ 変換開始
  #s             \ 全桁を変換
  rot sign       \ 符号チェック。必要なら &quot;-&quot; 付加
  #&gt;             \ 変換完了
  TYPE SPACE     \ 表示、続けて空白1つ
  #&gt;&gt; ;          \ ホールド領域を開放

: account. ( n -- )
  \ (会計風出力)会計士はマイナス記号が嫌いで、
  \ 負の数には括弧を使用します
  s&gt;d            \ 符号付き2倍長整数に変換
  swap over dabs \ 符号バイトを別途保存して数値は符号無し2倍長に
  &lt;&lt;#            \ 変換開始
  2 pick         \ 符号バイトのコピーを得る
  0&lt; IF ')' hold THEN \ これが(あれば)出力の右端の文字
  #s             \ 全桁を変換
  rot            \ 符号バイトを得る
  0&lt; IF '(' hold THEN
  #&gt;             \ 変換完了
  TYPE SPACE     \ 表示、続けて空白1つ
  #&gt;&gt; ;          \ ホールド領域を開放

</pre></div>

<p>これらのワードの利用例をいくつか示します:
</p>
<div class="example">
<pre class="example">1 my-u. 1  ok
hex -1 my-u. decimal FFFFFFFFFFFFFFFF  ok
1 cents-only 01  ok
1234 cents-only 34  ok
2 dollars-and-cents  $0.02  ok
1234 dollars-and-cents  $12.34  ok
123 my-. 123  ok
-123 my-. -123  ok
123 account. 123  ok
-456 account. (456)  ok

</pre></div>

</div>
<hr>
<div class="header">
<p>
Next: <a href="Floating_002dpoint-output.html">Floating-point output</a>, Previous: <a href="Simple-numeric-output.html">Simple numeric output</a>, Up: <a href="Other-I_002fO.html">Other I/O</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Word-Index.html" title="Index" rel="index">Index</a>]</p>
</div>



</body>
</html>
