<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!-- Created by GNU Texinfo 6.8, https://www.gnu.org/software/texinfo/ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<!-- このマニュアルは、 標準 Forth 言語の高速で移植可能な実装である Gforth (バージョン 0.7.9_20240418,
April 18, 2024)用です。 これはリファレンス・マニュアルとして機能しますが、 Forth の概要と Forth
チュートリアルも含まれています。

Authors: Bernd Paysan, Anton Ertl, Gerald Wodni Copyright (C) 1995,
1996, 1997, 1998, 2000, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010,
2011, 2012, 2013, 2014,2015,2016,2017,2018,2019,2020,2021,2022,2023 Free
Software Foundation, Inc.

Permission is granted to copy, distribute and/or modify this document under
the terms of the GNU Free Documentation License, Version 1.1 or any later
version published by the Free Software Foundation; with no Invariant
Sections, with the Front-Cover texts being "A GNU Manual," and with the
Back-Cover Texts as in (a) below.  A copy of the license is included in the
section entitled "GNU Free Documentation License."

(a) The FSF's Back-Cover Text is: "You have freedom to copy and modify this
GNU Manual, like GNU software.  Copies published by the Free Software
Foundation raise funds for GNU development." -->
<title>Files Tutorial (Gforth マニュアル)</title>

<meta name="description" content="Files Tutorial (Gforth マニュアル)">
<meta name="keywords" content="Files Tutorial (Gforth マニュアル)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<meta name="viewport" content="width=device-width,initial-scale=1">

<link href="index.html" rel="start" title="Top">
<link href="Word-Index.html" rel="index" title="Word Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Tutorial.html" rel="up" title="Tutorial">
<link href="Interpretation-and-Compilation-Semantics-and-Immediacy-Tutorial.html" rel="next" title="Interpretation and Compilation Semantics and Immediacy Tutorial">
<link href="Floating-Point-Tutorial.html" rel="prev" title="Floating Point Tutorial">
<style type="text/css">
<!--
a.copiable-anchor {visibility: hidden; text-decoration: none; line-height: 0em}
a.summary-letter {text-decoration: none}
blockquote.indentedblock {margin-right: 0em}
div.display {margin-left: 3.2em}
div.example {margin-left: 3.2em}
kbd {font-style: oblique}
pre.display {font-family: inherit}
pre.format {font-family: inherit}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
span.nolinebreak {white-space: nowrap}
span.roman {font-family: initial; font-weight: normal}
span.sansserif {font-family: sans-serif; font-weight: normal}
span:hover a.copiable-anchor {visibility: visible}
ul.no-bullet {list-style: none}
-->
</style>
<link rel="stylesheet" type="text/css" href="gforth.css">


</head>

<body lang="en">
<div class="section" id="Files-Tutorial">
<div class="header">
<p>
Next: <a href="Interpretation-and-Compilation-Semantics-and-Immediacy-Tutorial.html" accesskey="n" rel="next">Interpretation and Compilation Semantics and Immediacy</a>, Previous: <a href="Floating-Point-Tutorial.html" accesskey="p" rel="prev">Floating Point</a>, Up: <a href="Tutorial.html" accesskey="u" rel="up">Forth Tutorial</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Word-Index.html" title="Index" rel="index">Index</a>]</p>
</div>
<hr>
<span id="Files-1"></span><h3 class="section">3.27 Files</h3>
<span id="index-files-tutorial"></span>

<p>このセクションでは、 Forth 内でファイルを使用する方法について簡単に説明します。 それは 5 つの簡単なステップに分かれています:
</p>
<ol>
<li> 入力用に ASCII テキスト・ファイルを開きます
</li><li> 出力用にファイルを開く
</li><li> 文字列が一致する (または他の条件が満たされる) まで入力ファイルを読み取ります
</li><li> 入力 (が変更されたかどうかに関係なく、) から数行を出力に書き込みます
</li><li> ファイルを閉じます。
</li></ol>

<p>こちらも参照ください: <a href="General-files.html">General files</a>
</p>
<ul class="section-toc">
<li><a href="#Open-file-for-input" accesskey="1">Open file for input</a></li>
<li><a href="#Create-file-for-output" accesskey="2">Create file for output</a></li>
<li><a href="#huairunoTe-Ding-noXing-wosukiyan" accesskey="3">ファイルの特定の行をスキャン</a></li>
<li><a href="#Copy-input-to-output" accesskey="4">Copy input to output</a></li>
<li><a href="#Close-files" accesskey="5">Close files</a></li>
</ul>
<div class="subsection" id="Open-file-for-input">
<h4 class="subsection">3.27.1 Open file for input</h4>

<div class="example">
<pre class="example">s&quot; foo.in&quot;  r/o open-file throw Value fd-in
</pre></div>

</div>
<div class="subsection" id="Create-file-for-output">
<h4 class="subsection">3.27.2 Create file for output</h4>

<div class="example">
<pre class="example">s&quot; foo.out&quot; w/o create-file throw Value fd-out
</pre></div>

<p>使用可能なファイル・モードは、 読み取り専用アクセスの場合は r/o 、 読み取り/書き込み アクセスの場合は r/w 、書き込み専用アクセスの場合は
w/o です。 必要に応じて、 読み取りと書き込みの両方のファイルを r/w で開くこともできます。 すべてのファイル用ワードはエラーコードを返します。
ほとんどのアプリケーションでは、 <code>throw</code> を使用してエラー・コードを外部のエラー・ハンドラーに渡すのが最善(best)です。
</p>
<p>開いたり(opening)割り当てたり(assigning)するためのワードが必要な場合は、 以下のように定義します:
</p>
<div class="example">
<pre class="example">0 Value fd-in
0 Value fd-out
: open-input ( addr u -- )  r/o open-file throw to fd-in ;
: open-output ( addr u -- )  w/o create-file throw to fd-out ;
</pre></div>

<p>使用例:
</p>
<div class="example">
<pre class="example">s&quot; foo.in&quot; open-input
s&quot; foo.out&quot; open-output
</pre></div>

</div>
<div class="subsection" id="huairunoTe-Ding-noXing-wosukiyan">
<h4 class="subsection">3.27.3 ファイルの特定の行をスキャン</h4>

<div class="example">
<pre class="example">256 Constant max-line
Create line-buffer  max-line 2 + allot

: scan-file ( addr u -- )
  begin
      line-buffer max-line fd-in read-line throw
  while
         &gt;r 2dup line-buffer r&gt; compare 0=
     until
  else
     drop
  then
  2drop ;
</pre></div>

<p><code>read-line ( addr u1 fd -- u2 flag ior )</code> は、 addr からのバッファーに最大 u1
バイトを読み取り、 読み取ったバイト数と、 ファイルの終わりに達した場合に false になるフラグと、 エラーコードを返します。
</p>
<p><code>compare ( addr1 u1 addr2 u2 -- n )</code> は 2 つの文字列を比較し、 両方の文字列が等しい場合は 0
を返します。 最初の文字列の方が字句的に大きい(lexically greater)場合は正の数値を返し、 2
番目の文字列の方が字句的に大きい(lexically greater)場合は負の数値を返します。
</p>
<p>このループは、 まだ見たことがないですよね。 このループは出口が2つあります。  <code>while</code>
はスタック上にある読み取ったバイト数で終了するため、 それを個別にクリーンアップする必要があります。 そのクリーンアップする部分は
<code>else</code> の後にあります。
</p>
<p>使用例:
</p>
<div class="example">
<pre class="example">s&quot; The text I search is here&quot; scan-file
</pre></div>

</div>
<div class="subsection" id="Copy-input-to-output">
<h4 class="subsection">3.27.4 Copy input to output</h4>

<div class="example">
<pre class="example">: copy-file ( -- )
  begin
      line-buffer max-line fd-in read-line throw
  while
      line-buffer swap fd-out write-line throw
  repeat 
  drop ;
</pre></div>

</div>
<div class="subsection" id="Close-files">
<h4 class="subsection">3.27.5 Close files</h4>

<div class="example">
<pre class="example">fd-in close-file throw
fd-out close-file throw
</pre></div>

<p>これも、同様に、 定義に組み込むことができます:
</p>
<div class="example">
<pre class="example">: close-input ( -- )  fd-in close-file throw ;
: close-output ( -- )  fd-out close-file throw ;
</pre></div>

<blockquote>
<p><b>研究課題(assignment):</b> <code>copy-file</code> を変更して、 2 行目が一致するまでコピーするようにするにはどうすればよいでしょうか？
セクションの開始行と終了行を指定して、 テキスト・ファイルのセクションを抽出するプログラムを作成できますか？
</p></blockquote>

</div>
</div>
<hr>
<div class="header">
<p>
Next: <a href="Interpretation-and-Compilation-Semantics-and-Immediacy-Tutorial.html">Interpretation and Compilation Semantics and Immediacy</a>, Previous: <a href="Floating-Point-Tutorial.html">Floating Point</a>, Up: <a href="Tutorial.html">Forth Tutorial</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Word-Index.html" title="Index" rel="index">Index</a>]</p>
</div>



</body>
</html>
