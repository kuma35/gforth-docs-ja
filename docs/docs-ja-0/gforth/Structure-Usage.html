<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!-- Created by GNU Texinfo 6.8, https://www.gnu.org/software/texinfo/ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<!-- このマニュアルは、 標準 Forth 言語の高速で移植可能な実装である Gforth (バージョン 0.7.9_20240418,
April 18, 2024)用です。 これはリファレンス・マニュアルとして機能しますが、 Forth の概要と Forth
チュートリアルも含まれています。

Authors: Bernd Paysan, Anton Ertl, Gerald Wodni Copyright (C) 1995,
1996, 1997, 1998, 2000, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010,
2011, 2012, 2013, 2014,2015,2016,2017,2018,2019,2020,2021,2022,2023 Free
Software Foundation, Inc.

Permission is granted to copy, distribute and/or modify this document under
the terms of the GNU Free Documentation License, Version 1.1 or any later
version published by the Free Software Foundation; with no Invariant
Sections, with the Front-Cover texts being "A GNU Manual," and with the
Back-Cover Texts as in (a) below.  A copy of the license is included in the
section entitled "GNU Free Documentation License."

(a) The FSF's Back-Cover Text is: "You have freedom to copy and modify this
GNU Manual, like GNU software.  Copies published by the Free Software
Foundation raise funds for GNU development." -->
<title>Structure Usage (Gforth マニュアル)</title>

<meta name="description" content="Structure Usage (Gforth マニュアル)">
<meta name="keywords" content="Structure Usage (Gforth マニュアル)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<meta name="viewport" content="width=device-width,initial-scale=1">

<link href="index.html" rel="start" title="Top">
<link href="Word-Index.html" rel="index" title="Word Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Structures.html" rel="up" title="Structures">
<link href="Structure-Naming-Convention.html" rel="next" title="Structure Naming Convention">
<link href="Why-explicit-structure-support_003f.html" rel="prev" title="Why explicit structure support?">
<style type="text/css">
<!--
a.copiable-anchor {visibility: hidden; text-decoration: none; line-height: 0em}
a.summary-letter {text-decoration: none}
blockquote.indentedblock {margin-right: 0em}
div.display {margin-left: 3.2em}
div.example {margin-left: 3.2em}
kbd {font-style: oblique}
pre.display {font-family: inherit}
pre.format {font-family: inherit}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
span.nolinebreak {white-space: nowrap}
span.roman {font-family: initial; font-weight: normal}
span.sansserif {font-family: sans-serif; font-weight: normal}
span:hover a.copiable-anchor {visibility: visible}
ul.no-bullet {list-style: none}
-->
</style>
<link rel="stylesheet" type="text/css" href="gforth.css">


</head>

<body lang="en">
<div class="subsection" id="Structure-Usage">
<div class="header">
<p>
Next: <a href="Structure-Naming-Convention.html" accesskey="n" rel="next">Structure Naming Convention</a>, Previous: <a href="Why-explicit-structure-support_003f.html" accesskey="p" rel="prev">Why explicit structure support?</a>, Up: <a href="Structures.html" accesskey="u" rel="up">Structures</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Word-Index.html" title="Index" rel="index">Index</a>]</p>
</div>
<hr>
<span id="Structure-Usage-1"></span><h4 class="subsection">6.23.2 Structure Usage</h4>
<span id="index-structure-usage"></span>

<span id="index-field-usage"></span>
<span id="index-struct-usage"></span>
<span id="index-end_002dstruct-usage"></span>
<p>以下のコマンドを使用して、 (データのない)リンク・リストの構造体を定義できます(訳注: これは構造体テンプレートを定義するだけです。
構造体変数とするには別途 <code>%alloc</code> 等する必要があります):
</p><div class="example">
<pre class="example">struct
    cell% field list-next
end-struct list%
</pre></div>

<p>スタック上のリスト・ノードのアドレスを使用して、 <code>list-next</code>
を使用して次のノードのアドレスを含むフィールドのアドレスを計算できます。 たとえば、 以下のようにしてリストの長さを決定できます:
</p>
<div class="example">
<pre class="example">: list-length ( list -- n )
\ &quot;list&quot; is a pointer to the first element of a linked list
\ &quot;n&quot; is the length of the list
    0 BEGIN ( list1 n1 )
        over
    WHILE ( list1 n1 )
        1+ swap list-next @ swap
    REPEAT
    nip ;
</pre></div>

<p><code>list% %allot</code> を使用すると、 ディクショナリー内にリスト・ノード用のメモリーを確保でき、 これにより、
リスト・ノードのアドレスがスタック上に残ります。ヒープ上で同様の割り当てを行うには、 <code>list% %alloc</code>
を使用できます(または、<code>allocate</code> のようなスタック効果(つまり、ior を使用)が欲しい場合は、 <code>list%
%allocate</code> を使用します)。 リスト・ノードのサイズは <code>list% %size</code> で取得でき、 そのセル・アライメントは
<code>list% %alignment</code> で取得できます。
</p>
<p>注意: 標準 Forth では、 <code>create</code> されたワードの本体は <code>aligned</code> されていますが、 必ずしも
<code>faligned</code> されている訳ではない事に注意してください。したがって、 以下のようにすると:
</p>
<div class="example">
<pre class="example">create &quot;name&quot; foo% %allot drop
</pre></div>

<p>この場合、 <code>foo%</code> に割り当てられたメモリーは、 <code>foo%</code>
に文字フィールドやセル・フィールドや2倍長整数フィールドのみが含まれている場合にのみ、 <code><em>name</em></code>
の本体から開始されることが保証されます。 したがって、 浮動小数点数が含まれる場合は、以下を使用することをお勧めします
</p>
<div class="example">
<pre class="example">foo% %allot constant &quot;name&quot;
</pre></div>

<span id="index-structures-containing-structures"></span>
<p>以下のように、 構造体 <code>foo%</code> を別の構造体のフィールドとして含めることができます:
</p><div class="example">
<pre class="example">struct
...
    foo% field ...
...
end-struct ...
</pre></div>

<span id="index-structure-extension"></span>
<span id="index-extended-records"></span>
<p>構造体をいちから構築する代わりに、 既存の構造体を拡張できます。 たとえば、 上記例で定義したような、
データのない単純なリンク・リストはほとんど役に立ちません。 これを以下のように、
整数の値を持つリンク・リストに拡張できます:<a id="DOCF31" href="#FOOT31"><sup>31</sup></a>
</p>
<div class="example">
<pre class="example">list%
    cell% field intlist-int
end-struct intlist%
</pre></div>

<p><code>intlist%</code> は、 <code>list-next</code> と <code>intlist-int</code> の 2
つのフィールドを持つ構造体です。
</p>
<span id="index-structures-containing-arrays"></span>
<p>以下のように、 <i>n</i> 要素の  <code>foo%</code> 型を含む配列型を指定できます:
</p>
<div class="example">
<pre class="example">foo% <i>n</i> *
</pre></div>

<p>この配列型は、 通常の型を使用できる場所であればどこでも使用できます(例: <code>field</code> を定義する場所や <code>%allot</code>
を使用するとき)。
</p>
<span id="index-first-field-optimization"></span>
<p>最初のフィールドは構造体のベース・アドレスにあり、 この、 最初のフィールドのワード(例:
<code>list-next</code>)は実際にはスタック上のアドレスを変更しません。 あなたは実行時間と領域の効率を考慮して、
最初のフィールドのワードを取り除きたいとと思うかもしれません。 しかし、 構造体パッケージがこの場合を最適化するため、 そのは必要ありません。
最初のフィールドのワードをコンパイルする場合、 コードは生成されません。 したがって、 読みやすさと保守性を考慮して、
最初のフィールドにアクセスするときにその最初のフィールドのワードは含めるべきです。
</p>

</div>
<div class="footnote">
<hr>
<h4 class="footnotes-heading">Footnotes</h4>

<h5><a id="FOOT31" href="#DOCF31">(31)</a></h5>
<p>この機能は「拡張レコード」(extended records)とも呼ばれます。 これは、
オベロン・プログラミング言語が成した主な革新です。 言い換えれば、 この機能を Modula-2 に追加することで、 Wirth は新しい言語を作成し、
新しいコンパイラの記述等を行いました。 この機能を Forth に追加するには、 数行のコードが必要なだけでした。</p>
</div>



</body>
</html>
