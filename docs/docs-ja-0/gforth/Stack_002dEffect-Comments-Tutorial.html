<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!-- Created by GNU Texinfo 6.8, https://www.gnu.org/software/texinfo/ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<!-- このマニュアルは、 標準 Forth 言語の高速で移植可能な実装である Gforth (バージョン 0.7.9_20240418,
April 18, 2024)用です。 これはリファレンス・マニュアルとして機能しますが、 Forth の概要と Forth
チュートリアルも含まれています。

Authors: Bernd Paysan, Anton Ertl, Gerald Wodni Copyright (C) 1995,
1996, 1997, 1998, 2000, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010,
2011, 2012, 2013, 2014,2015,2016,2017,2018,2019,2020,2021,2022,2023 Free
Software Foundation, Inc.

Permission is granted to copy, distribute and/or modify this document under
the terms of the GNU Free Documentation License, Version 1.1 or any later
version published by the Free Software Foundation; with no Invariant
Sections, with the Front-Cover texts being "A GNU Manual," and with the
Back-Cover Texts as in (a) below.  A copy of the license is included in the
section entitled "GNU Free Documentation License."

(a) The FSF's Back-Cover Text is: "You have freedom to copy and modify this
GNU Manual, like GNU software.  Copies published by the Free Software
Foundation raise funds for GNU development." -->
<title>Stack-Effect Comments Tutorial (Gforth マニュアル)</title>

<meta name="description" content="Stack-Effect Comments Tutorial (Gforth マニュアル)">
<meta name="keywords" content="Stack-Effect Comments Tutorial (Gforth マニュアル)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<meta name="viewport" content="width=device-width,initial-scale=1">

<link href="index.html" rel="start" title="Top">
<link href="Word-Index.html" rel="index" title="Word Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Tutorial.html" rel="up" title="Tutorial">
<link href="Types-Tutorial.html" rel="next" title="Types Tutorial">
<link href="Decompilation-Tutorial.html" rel="prev" title="Decompilation Tutorial">
<style type="text/css">
<!--
a.copiable-anchor {visibility: hidden; text-decoration: none; line-height: 0em}
a.summary-letter {text-decoration: none}
blockquote.indentedblock {margin-right: 0em}
div.display {margin-left: 3.2em}
div.example {margin-left: 3.2em}
kbd {font-style: oblique}
pre.display {font-family: inherit}
pre.format {font-family: inherit}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
span.nolinebreak {white-space: nowrap}
span.roman {font-family: initial; font-weight: normal}
span.sansserif {font-family: sans-serif; font-weight: normal}
span:hover a.copiable-anchor {visibility: visible}
ul.no-bullet {list-style: none}
-->
</style>
<link rel="stylesheet" type="text/css" href="gforth.css">


</head>

<body lang="en">
<div class="section" id="Stack_002dEffect-Comments-Tutorial">
<div class="header">
<p>
Next: <a href="Types-Tutorial.html" accesskey="n" rel="next">Types</a>, Previous: <a href="Decompilation-Tutorial.html" accesskey="p" rel="prev">Decompilation</a>, Up: <a href="Tutorial.html" accesskey="u" rel="up">Forth Tutorial</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Word-Index.html" title="Index" rel="index">Index</a>]</p>
</div>
<hr>
<span id="Stack_002dEffect-Comments"></span><h3 class="section">3.11 Stack-Effect Comments</h3>
<span id="index-stack_002deffect-comments_002c-tutorial"></span>
<span id="index-_002d_002d_002c-tutorial"></span>
<p>慣例により、 定義名の後のコメントはスタック効果を説明します。 &lsquo;<samp>--</samp>&rsquo; の前の部分は、 定義の実行前のスタックの状態、
つまりコロン定義に渡されるパラメータを説明します。 &lsquo;<samp>--</samp>&rsquo; の後ろの部分は、 定義の実行後のスタックの状態、 つまり定義の実行結果です。
スタック・コメントには、 定義がアクセス、 または、変更する、 (訳注: 定義の外部から見える、 )スタック項目のみを記述します。
</p>
<p>たとえ スタック効果が <code>( -- )</code> (訳注: スタックに何の効果も及ぼさない)であっても、 あなたは、
すべての定義に正しいスタック効果を記述するべきです。 また、 より複雑なワードには説明的なコメントを追加する必要があります(通常、 これは
<code>:</code> の後ろに続けます)。 これを行わないと、 あなたコードの行動は解読不能になります(なぜなら、 とある定義を理解するためには、
全ての定義を辿るハメになるから)。
</p>
<blockquote>
<p><b>研究課題(assignment):</b> 例えば <code>swap</code> のスタック効果は、 <code>x1 x2 -- x2 x1</code> のように記述できます。 同様に、 <code>-</code> や
<code>drop</code> や <code>dup</code> や <code>over</code> や <code>rot</code> や <code>nip</code> や
<code>tuck</code> のスタック効果を書いてみましょう。 ヒント: 書けたら、
このマニュアルに書いてあるスタック効果と合っているかどうかチェックしましょう(see <a href="Word-Index.html">Word Index</a>)。
</p></blockquote>

<p>プログラマーは、 コロン定義内のさまざまな場所に、 その場所のスタックの内容を説明するコメント(スタック・コメント)を挿入することがあります。 つまり、
スタック効果コメントの最初の部分のようなものです。 例えば以下のようなのです
</p>
<div class="example">
<pre class="example">: cubed ( n -- n^3 )
   dup squared  ( n n^2 ) * ;
</pre></div>

<p>この場合、 ワードが十分に単純であるため、 スタック・コメントは割と余計です。 あなたが、
読みやすさを高めるためにそのようなコメントを追加することが良いと思った場合、
ワードをいくつかの単純なワードにファクタリング(因数分解)することも検討する必要があります(see <a href="Factoring-Tutorial.html">Factoring</a>)。 ファクタリングにより、 通常はスタック・コメントが不要になります。 ただし、
あなたが結果としてリファクタリングしないことに決めた場合は、 そのようなコメントがある方が、 無いよりも良いです。
</p>
<p>標準や、 このマニュアルや、 多くのプログラムの、 スタック効果およびスタック・コメント内のスタック項目の名前は、 Fortran
やハンガリアン記法と同様に、 型プレフィックスによって型を指定します。 最も頻繁に使用されるプレフィックスは以下のとおりです:
</p>
<dl compact="compact">
<dt><span><code>n</code></span></dt>
<dd><p>符号付き整数
</p></dd>
<dt><span><code>u</code></span></dt>
<dd><p>符号なし整数
</p></dd>
<dt><span><code>c</code></span></dt>
<dd><p>文字(character)
</p></dd>
<dt><span><code>f</code></span></dt>
<dd><p>二値フラグ(Boolean flags)。 つまり <code>false</code> または <code>true</code>
</p></dd>
<dt><span><code>a-addr,a-</code></span></dt>
<dd><p>セル揃えアドレス(Cell-aligned address)
</p></dd>
<dt><span><code>c-addr,c-</code></span></dt>
<dd><p>文字揃えアドレス(Char-aligned address)(注意: Windows NT では文字(char)は 2
バイトになる場合があることに注意)
</p></dd>
<dt><span><code>xt</code></span></dt>
<dd><p>実行トークン(Execution token)。 セルと同一サイズ
</p></dd>
<dt><span><code>w,x</code></span></dt>
<dd><p>セル(cell)。 セルには整数またはアドレスを含めることができます。 通常は 32ビットまたは 64 ビットまたは 16
ビットを必要とします(プラットフォームと Forth システムによって異なります)。 cell は一般には machine word
として知られていますが、 Forth では <em>word</em> という用語はすでに別の意味を持っています。
</p></dd>
<dt><span><code>d</code></span></dt>
<dd><p>符号付き2倍長整数(signed double-cell integer)
</p></dd>
<dt><span><code>ud</code></span></dt>
<dd><p>符号無し2倍長整数(unsigned double-cell integer)
</p></dd>
<dt><span><code>r</code></span></dt>
<dd><p>浮動小数点数(Float)(FP スタック上に置かれる)
</p></dd>
</dl>

<p>より完全なリストは <a href="Notation.html">Notation</a> にあります。
</p>
<blockquote>
<p><b>研究課題(assignment):</b> あなたがここまでで記述したすべての定義に対してスタック効果コメントを記述してみましょう。
</p></blockquote>


</div>



</body>
</html>
