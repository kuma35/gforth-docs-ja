<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!-- Created by GNU Texinfo 6.8, https://www.gnu.org/software/texinfo/ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<!-- このマニュアルは、 標準 Forth 言語の高速で移植可能な実装である Gforth (バージョン 0.7.9_20240418,
April 18, 2024)用です。 これはリファレンス・マニュアルとして機能しますが、 Forth の概要と Forth
チュートリアルも含まれています。

Authors: Bernd Paysan, Anton Ertl, Gerald Wodni Copyright (C) 1995,
1996, 1997, 1998, 2000, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010,
2011, 2012, 2013, 2014,2015,2016,2017,2018,2019,2020,2021,2022,2023 Free
Software Foundation, Inc.

Permission is granted to copy, distribute and/or modify this document under
the terms of the GNU Free Documentation License, Version 1.1 or any later
version published by the Free Software Foundation; with no Invariant
Sections, with the Front-Cover texts being "A GNU Manual," and with the
Back-Cover Texts as in (a) below.  A copy of the license is included in the
section entitled "GNU Free Documentation License."

(a) The FSF's Back-Cover Text is: "You have freedom to copy and modify this
GNU Manual, like GNU software.  Copies published by the Free Software
Foundation raise funds for GNU development." -->
<title>The Text Interpreter (Gforth マニュアル)</title>

<meta name="description" content="The Text Interpreter (Gforth マニュアル)">
<meta name="keywords" content="The Text Interpreter (Gforth マニュアル)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<meta name="viewport" content="width=device-width,initial-scale=1">

<link href="index.html" rel="start" title="Top">
<link href="Word-Index.html" rel="index" title="Word Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Words.html" rel="up" title="Words">
<link href="The-Input-Stream.html" rel="next" title="The Input Stream">
<link href="Compiling-words.html" rel="prev" title="Compiling words">
<style type="text/css">
<!--
a.copiable-anchor {visibility: hidden; text-decoration: none; line-height: 0em}
a.summary-letter {text-decoration: none}
blockquote.indentedblock {margin-right: 0em}
div.display {margin-left: 3.2em}
div.example {margin-left: 3.2em}
kbd {font-style: oblique}
pre.display {font-family: inherit}
pre.format {font-family: inherit}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
span.nolinebreak {white-space: nowrap}
span.roman {font-family: initial; font-weight: normal}
span.sansserif {font-family: sans-serif; font-weight: normal}
span:hover a.copiable-anchor {visibility: visible}
ul.no-bullet {list-style: none}
-->
</style>
<link rel="stylesheet" type="text/css" href="gforth.css">


</head>

<body lang="en">
<div class="section" id="The-Text-Interpreter">
<div class="header">
<p>
Next: <a href="The-Input-Stream.html" accesskey="n" rel="next">The Input Stream</a>, Previous: <a href="Compiling-words.html" accesskey="p" rel="prev">Compiling words</a>, Up: <a href="Words.html" accesskey="u" rel="up">Forth Words</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Word-Index.html" title="Index" rel="index">Index</a>]</p>
</div>
<hr>
<span id="The-Text-Interpreter-1"></span><h3 class="section">6.14 The Text Interpreter</h3>
<span id="index-interpreter-_002d-outer"></span>
<span id="index-text-interpreter-2"></span>
<span id="index-outer-interpreter-2"></span>



<p>テキスト・インタプリタ(text interpreter)は、 現在の入力デバイスからの入力を処理する無限ループです。
インタプリタの実装上でコンパイルされた Forth コードを実行する内部インタプリタ(inner
interpreter)(see <a href="Engine.html">Engine</a>)とは対照的に、 これは外部インタプリタ(outer
interpreter)とも呼ばれます<a id="DOCF24" href="#FOOT24"><sup>24</sup></a>。
</p>
<span id="index-interpret-state"></span>
<span id="index-compile-state"></span>
<p>テキスト・インタプリタは、 インタプリタ状態(<em>interpret state</em>) と コンパイル状態(<em>compile
state</em>)の 2 つの状態のいずれかで動作します。 現在の状態は、 それにふさわしい名前の変数である <code>state</code>
によって定義されます。
</p>
<p>このセクションでは、 テキスト・インタプリタがインタプリタ状態にあるときに、
ユーザー入力デバイス(キーボード)からの入力処理についてどのように振る舞うかについて説明することから始めます。 これは Forth
システムが動き始めた時のモードです。
</p>
<span id="index-input-buffer"></span>
<span id="index-terminal-input-buffer"></span>
<p>テキスト・インタプリタは、 入力バッファ(<em>input
buffer</em>)<a id="DOCF25" href="#FOOT25"><sup>25</sup></a>と呼ばれるメモリ領域で動作します。 この領域には、
<tt class="key">RET</tt> キーを押したときにキーボードからの入力が保存され、 入力バッファの先頭から開始して、
先頭の空白文字達(デリミタ(<em>delimiters</em>)と呼ばれる)をスキップし、 空白文字、
またはバッファの終わりに達するまで文字列(空白以外の文字のシーケンス)をパースします。 文字列をパースした後、 以下の2つの試行を行います:
</p>
<span id="index-dictionary"></span>
<ul>
<li> 定義のディクショナリ(<em>dictionary</em>)内でその文字列を検索します。 その文字列が見つかった場合、 その文字列は、
とある定義(<em>definition</em>)(ワード(<em>word</em>)とも呼ばれる)を指し示していて、 そして、 ディクショナリ検索機能は、
テキスト・インタプリタがそのワードのインタプリタ機能(<em>interpretation
semantics</em>)を実行できるようにするための情報を返します。 ほとんどの場合、 これは、 単にそのワードが execute
されることを意味します。
</li><li> 文字列がディクショナリに見つからない場合、 テキスト・インタプリタは <a href="Number-Conversion.html">Number Conversion</a> で説明されているルールを使用して、
文字列を数値として処理しようと試みます。 文字列が現在の基数で有効な数値を表す場合、 その数値はパラメータ・スタック(整数の場合はデータ・スタック、
浮動小数点数の場合は浮動小数点スタック)にプッシュされます。
</li></ul>

<p>上記両方の試行が失敗した場合、 テキスト・インタプリタは入力バッファの残りを破棄し、 そして、 エラー・メッセージを発行して、そして、
さらなる入力を待ちます。 いずれかの試行が成功すると、 テキスト・インタプリタは入力バッファ全体が処理されるまでパース処理を繰り返し、
全体が処理された時点でステータス・メッセージ &ldquo;<code> ok</code>&rdquo; を出力し、 そして、 さらなる入力を待ちます。
</p>

<span id="index-parse-area"></span>
<p>テキスト・インタプリタは、 <code>&gt;IN</code> (&ldquo;to-in&rdquo;(トゥーイン)と発音します)と呼ばれる変数を更新することにより、
入力バッファ内の位置を追跡します。  <code>&gt;IN</code> の値は 0 で始まり、 入力バッファの先頭からのオフセットが 0 であることを示します。
オフセット <code>&gt;IN @</code> から入力バッファの末尾までの領域は、 パース領域(<em>parse
area</em>)と呼ばれます<a id="DOCF26" href="#FOOT26"><sup>26</sup></a>。 以下の例は、 テキスト・インタプリタが入力バッファをパースする際に
<code>&gt;IN</code> がどのように変化するかを示しています:
</p>
<div class="example">
<pre class="example">: remaining source &gt;in @ /string
  cr .&quot; -&gt;&quot; type .&quot; &lt;-&quot; ; immediate 

1 2 3 remaining + remaining . 

: foo 1 2 3 remaining swap remaining ;
</pre></div>

<p>これらの結果はそれぞれ以下のようになります:
</p>
<div class="example">
<pre class="example">-&gt;+ remaining .&lt;-
-&gt;.&lt;-5  ok

-&gt;swap remaining ;-&lt;
-&gt;;&lt;-  ok
</pre></div>

<span id="index-parsing-words-2"></span>
<p><code>&gt;IN</code> の値は、 テキスト・インタプリタによって実行される入力バッファ内のワードによって変更することもできます。  これは、
ワードがテキスト・インタプリタをだまして、 入力バッファの一節をスキップしたり<a id="DOCF27" href="#FOOT27"><sup>27</sup></a>、 一節を 2
回パースしたりすることができることを意味します。 例:
</p>
<div class="example">
<pre class="example">: lat .&quot; &lt;&lt;foo&gt;&gt;&quot; ;
: flat .&quot; &lt;&lt;bar&gt;&gt;&quot; &gt;IN DUP @ 3 - SWAP ! ;
</pre></div>

<p><code>flat</code> が実行されると、 以下の出力が生成されます<a id="DOCF28" href="#FOOT28"><sup>28</sup></a>(訳注:ユーザーが flat と打ち込と、 入力バッファには flat があり、 ワード flat
の実行が初まったときは &gt;IN は flatの t の次を指している。 そこから 3 戻ると &gt;IN が 指すのは flat の l で、
そこからテキスト・インタプリタがパースを再開すると、 テキスト・インタプリタに見えるのは lat である。 よって lat が実行されて &lt;&lt;foo&gt;&gt;
が出力される):
</p>
<div class="example">
<pre class="example">&lt;&lt;bar&gt;&gt;&lt;&lt;foo&gt;&gt;
</pre></div>

<p>この手法を使用すると、 ワードのパースにおける相互運用性の問題(interoperability problems)の一部を回避できます。 もちろん、
ワードのパースは可能な限り避けた方が良いです。
</p>
<p>テキスト・インタプリタの振る舞いに関する 2 つの重要な注意事項:
</p>
<ul>
<li> 入力バッファからの追加の文字達をパースする前に、 各入力文字列の処理を完了させます。
</li><li> 入力バッファを読み取り専用領域(region)として扱います(そして、 コードも同様に読み取り専用でなければなりません)。
</li></ul>

<p>テキスト・インタプリタがコンパイル状態にある場合、 その振る舞いは以下のように変化します:
</p>
<ul>
<li> パースされた文字列がディクショナリ内で見つかった場合、 テキスト・インタプリタはそのワードのコンパイル機能(<em>compilation
semantics</em>)を実行します。 ほとんどの場合、これは単にそのワードの実行機能(execution
semantics)が現在の定義に追加されることを意味します。
</li><li> 数値が検出されると、 パラメータ・スタックにプッシュされるのではなく、 現在の定義に(リテラルとして)コンパイルされます。
</li><li> エラーが発生した場合、 <code>state</code> が変更され、 テキスト・インタプリタはインタプリタ状態に戻ります。
</li><li> キーボードから行が入力されるたびに、 Gforth は &ldquo; <code>ok</code>&rdquo; ではなく &ldquo;<code> compiled</code>&rdquo; を出力します。
</li></ul>

<span id="index-text-interpreter-_002d-input-sources"></span>
<p>テキスト・インタプリタがキーボード以外の入力デバイスを使用している場合、 その振る舞いは以下のように変化します:
</p>
<ul>
<li> パース領域が空の場合、 テキスト・インタプリタは入力源(input source)から入力バッファを補充(refill)しようとします。
入力源を使い尽くすと、 入力源は以前の入力源に戻ります。
</li><li> パース領域が空になるたびに &ldquo;<code> ok</code>&rdquo; や &ldquo;<code> compiled</code>&rdquo; メッセージは出力されません。
</li><li> エラーが発生した場合、 入力源はユーザー入力デバイスに戻されます。
</li></ul>

<p>これについて詳しくは、 <a href="Input-Sources.html">Input Sources</a> をご覧ください。
</p>
<span id="index-_003ein-_0028--_002d_002d-addr--_0029-core"></span>
<span id="index-_003ein"></span>
<span id="index-_003ein-1"></span>
<div class="format">
<pre class="format"><code>&gt;in</code> ( <i>&ndash; addr  </i>) core &ldquo;to-in&rdquo;
</pre></div>
<p><code>uvar</code> 変数 &ndash; <i>a-addr</i> は、 入力バッファの先頭からパース領域の先頭までの char
オフセットを格納するセルへのアドレスです。
</p>

<span id="index-source-_0028--_002d_002d-addr-u--_0029-core"></span>
<span id="index-source"></span>
<span id="index-source-1"></span>
<div class="format">
<pre class="format"><code>source</code> ( <i>&ndash; addr u  </i>) core &ldquo;source&rdquo;
</pre></div>
<p>現在の入力バッファのアドレス <i>addr</i> と長さ <i>u</i> を返します
</p>


<span id="index-tib-_0028--_002d_002d-addr--_0029-core_002dext_002dobsolescent"></span>
<span id="index-tib"></span>
<span id="index-tib-1"></span>
<div class="format">
<pre class="format"><code>tib</code> ( <i>&ndash; addr  </i>) core-ext-obsolescent &ldquo;t-i-b&rdquo;
</pre></div>

<span id="index-_0023tib-_0028--_002d_002d-addr--_0029-core_002dext_002dobsolescent"></span>
<span id="index-_0023tib"></span>
<span id="index-_0023tib-1"></span>
<div class="format">
<pre class="format"><code>#tib</code> ( <i>&ndash; addr  </i>) core-ext-obsolescent &ldquo;number-t-i-b&rdquo;
</pre></div>
<p><code>uvar</code> 変数 &ndash; <i>a-addr</i> は、 端末の入力バッファ内の文字数を含むセルのアドレスです。
OBSOLESCENT(時代遅れ): 代わりに <code>source</code> を使ってください。
</p>


<span id="index-interpret-_0028--_002e_002e_002e-_002d_002d-_002e_002e_002e--_0029-gforth_002d0_002e2"></span>
<span id="index-interpret"></span>
<span id="index-interpret-1"></span>
<div class="format">
<pre class="format"><code>interpret</code> ( <i>... &ndash; ...  </i>) gforth-0.2 &ldquo;interpret&rdquo;
</pre></div>



<ul class="section-toc">
<li><a href="Input-Sources.html" accesskey="1">Input Sources</a></li>
<li><a href="Number-Conversion.html" accesskey="2">Number Conversion</a></li>
<li><a href="Interpret_002fCompile-states.html" accesskey="3">Interpret/Compile states</a></li>
<li><a href="Interpreter-Directives.html" accesskey="4">Interpreter Directives</a></li>
<li><a href="Recognizers.html" accesskey="5">Recognizers</a></li>
<li><a href="Text-Interpreter-Hooks.html" accesskey="6">Text Interpreter Hooks</a></li>
</ul>
</div>
<div class="footnote">
<hr>
<h4 class="footnotes-heading">Footnotes</h4>

<h5><a id="FOOT24" href="#DOCF24">(24)</a></h5>
<p>このセクションは <a href="Introducing-the-Text-Interpreter.html">Introducing the Text Interpreter</a>
の拡大バージョンです</p>
<h5><a id="FOOT25" href="#DOCF25">(25)</a></h5>
<p>テキスト・インタプリタがキーボードからの入力を処理している時、
このメモリ領域はターミナル入力バッファ(<em>terminal input buffer</em> (TIB))と呼ばれ、 (既に廃止されていますが)
ワード <code>TIB</code> および ワード <code>#TIB</code> によってアドレス指定されます</p>
<h5><a id="FOOT26" href="#DOCF26">(26)</a></h5>
<p>言い換えると、 テキスト・インタプリタは、 パース領域が空になるまで、
パース領域からの文字列をパースすることによって、 入力バッファの内容を処理します</p>
<h5><a id="FOOT27" href="#DOCF27">(27)</a></h5>
<p>これがワードのパースの仕組みです</p>
<h5><a id="FOOT28" href="#DOCF28">(28)</a></h5>
<p>研究課題: <code>3</code> を <code>4</code>
に置き換えたらどうなるでしょうか？</p>
</div>
<hr>
<div class="header">
<p>
Next: <a href="The-Input-Stream.html">The Input Stream</a>, Previous: <a href="Compiling-words.html">Compiling words</a>, Up: <a href="Words.html">Forth Words</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Word-Index.html" title="Index" rel="index">Index</a>]</p>
</div>



</body>
</html>
