<!DOCTYPE html>
<html>
<!-- Created by GNU Texinfo 7.1, https://www.gnu.org/software/texinfo/ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<!-- このマニュアルは、 仮想マシン・インタープリタ・ジェネレーターである Vmgen (バージョン
0.7.9_20240418、April 18, 2024) 用です

Author: Anton Ertl Copyright © 2002,2003,2005,2007,2008,2019 Free
Software Foundation, Inc.

Permission is granted to copy, distribute and/or modify this document under
the terms of the GNU Free Documentation License, Version 1.2 or any later
version published by the Free Software Foundation; with no Invariant
Sections, with the Front-Cover texts being "A GNU Manual," and with the
Back-Cover Texts as in (a) below.  A copy of the license is included in the
section entitled "GNU Free Documentation License."

(a) The FSF's Back-Cover Text is: "You have freedom to copy and modify this
GNU Manual, like GNU software.  Copies published by the Free Software
Foundation raise funds for GNU development." -->
<title>Superinstructions (Vmgen (Gforth 0.7.9_20240418))</title>

<meta name="description" content="Superinstructions (Vmgen (Gforth 0.7.9_20240418))">
<meta name="keywords" content="Superinstructions (Vmgen (Gforth 0.7.9_20240418))">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<meta name="viewport" content="width=device-width,initial-scale=1">

<link href="index.html" rel="start" title="Top">
<link href="Index.html" rel="index" title="Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Input-File-Format.html" rel="up" title="Input File Format">
<link href="Store-Optimization.html" rel="next" title="Store Optimization">
<link href="Simple-instructions.html" rel="prev" title="Simple instructions">
<style type="text/css">
<!--
a.copiable-link {visibility: hidden; text-decoration: none; line-height: 0em}
div.example {margin-left: 3.2em}
span:hover a.copiable-link {visibility: visible}
-->
</style>


</head>

<body lang="en">
<div class="section-level-extent" id="Superinstructions">
<div class="nav-panel">
<p>
Next: <a href="Store-Optimization.html" accesskey="n" rel="next">Store Optimization</a>, Previous: <a href="Simple-instructions.html" accesskey="p" rel="prev">Simple instructions</a>, Up: <a href="Input-File-Format.html" accesskey="u" rel="up">Input File Format</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Index.html" title="Index" rel="index">Index</a>]</p>
</div>
<hr>
<h3 class="section" id="Superinstructions-1"><span>6.3 Superinstructions<a class="copiable-link" href="#Superinstructions-1"> &para;</a></span></h3>
<a class="index-entry-id" id="index-superinstructions_002c-defining"></a>
<a class="index-entry-id" id="index-defining-superinstructions"></a>

<p>注意: (静的な)スーパー命令(superinstructions)にあまり多くの作業を費やさないでください。 Vmgen の将来のバージョンでは、
動的スーパー命令がサポートされる予定で(Ian Piumarta and Fabio Riccardi, <cite class="cite">Optimizing Direct
Threaded Code by Selective Inlining</cite>, PLDI&rsquo;98 参照)、
静的スーパー命令の利点ははるかに少なくなっています(暫定的な結果は、 係数 1.1 の高速化)。
</p>
<p>以下にスーパー命令(superinstruction)定義の例を示します:
</p>
<div class="example">
<pre class="example-preformatted">lit_sub = lit sub
</pre></div>

<p><code class="code">lit_sub</code> is the name of the superinstruction, and <code class="code">lit</code> and
<code class="code">sub</code> are its components.  This superinstruction performs the same
action as the sequence <code class="code">lit</code> and <code class="code">sub</code>.  It is generated
automatically by the VM code generation functions whenever that sequence
occurs, so if you want to use this superinstruction, you just need to add
this definition (and even that can be partially automatized, see <a class="pxref" href="VM-profiler.html">VM profiler</a>).
</p>
<a class="index-entry-id" id="index-prefixes-of-superinstructions"></a>
<p>Vmgen requires that the component instructions are simple instructions
defined before superinstructions using the components.  Currently, Vmgen
also requires that all the subsequences at the start of a superinstruction
(prefixes) must be defined as superinstruction before the superinstruction.
I.e., if you want to define a superinstruction
</p>
<div class="example">
<pre class="example-preformatted">foo4 = load add sub mul
</pre></div>

<p>you first have to define <code class="code">load</code>, <code class="code">add</code>, <code class="code">sub</code> and <code class="code">mul</code>,
plus
</p>
<div class="example">
<pre class="example-preformatted">foo2 = load add
foo3 = load add sub
</pre></div>

<p>Here, <code class="code">sumof4</code> is the longest prefix of <code class="code">sumof5</code>, and
<code class="code">sumof3</code> is the longest prefix of <code class="code">sumof4</code>.
</p>
<p>Note that Vmgen assumes that only the code it generates accesses stack
pointers, the instruction pointer, and various stack items, and it performs
optimizations based on this assumption.  Therefore, VM instructions where
your C code changes the instruction pointer should only be used as last
component; a VM instruction where your C code accesses a stack pointer
should not be used as component at all.  Vmgen does not check these
restrictions, they just result in bugs in your interpreter.
</p>
<a class="index-entry-id" id="index-include_002dskipped_002dinsts"></a>
<p>The Vmgen flag <code class="code">include-skipped-insts</code> influences superinstruction code
generation.  Currently there is no support in the peephole optimizer for
both variations, so leave this flag alone for now.
</p>
</div>
<hr>
<div class="nav-panel">
<p>
Next: <a href="Store-Optimization.html">Store Optimization</a>, Previous: <a href="Simple-instructions.html">Simple instructions</a>, Up: <a href="Input-File-Format.html">Input File Format</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Index.html" title="Index" rel="index">Index</a>]</p>
</div>



</body>
</html>
