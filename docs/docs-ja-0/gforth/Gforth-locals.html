<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!-- Created by GNU Texinfo 6.8, https://www.gnu.org/software/texinfo/ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<!-- このマニュアルは、 標準 Forth 言語の高速で移植可能な実装である Gforth (バージョン 0.7.9_20240418,
April 18, 2024)用です。 これはリファレンス・マニュアルとして機能しますが、 Forth の概要と Forth
チュートリアルも含まれています。

Authors: Bernd Paysan, Anton Ertl, Gerald Wodni Copyright (C) 1995,
1996, 1997, 1998, 2000, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010,
2011, 2012, 2013, 2014,2015,2016,2017,2018,2019,2020,2021,2022,2023 Free
Software Foundation, Inc.

Permission is granted to copy, distribute and/or modify this document under
the terms of the GNU Free Documentation License, Version 1.1 or any later
version published by the Free Software Foundation; with no Invariant
Sections, with the Front-Cover texts being "A GNU Manual," and with the
Back-Cover Texts as in (a) below.  A copy of the license is included in the
section entitled "GNU Free Documentation License."

(a) The FSF's Back-Cover Text is: "You have freedom to copy and modify this
GNU Manual, like GNU software.  Copies published by the Free Software
Foundation raise funds for GNU development." -->
<title>Gforth locals (Gforth マニュアル)</title>

<meta name="description" content="Gforth locals (Gforth マニュアル)">
<meta name="keywords" content="Gforth locals (Gforth マニュアル)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<meta name="viewport" content="width=device-width,initial-scale=1">

<link href="index.html" rel="start" title="Top">
<link href="Word-Index.html" rel="index" title="Word Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Locals.html" rel="up" title="Locals">
<link href="Standard-Forth-locals.html" rel="next" title="Standard Forth locals">
<link href="Locals.html" rel="prev" title="Locals">
<style type="text/css">
<!--
a.copiable-anchor {visibility: hidden; text-decoration: none; line-height: 0em}
a.summary-letter {text-decoration: none}
blockquote.indentedblock {margin-right: 0em}
div.display {margin-left: 3.2em}
div.example {margin-left: 3.2em}
kbd {font-style: oblique}
pre.display {font-family: inherit}
pre.format {font-family: inherit}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
span.nolinebreak {white-space: nowrap}
span.roman {font-family: initial; font-weight: normal}
span.sansserif {font-family: sans-serif; font-weight: normal}
span:hover a.copiable-anchor {visibility: visible}
ul.no-bullet {list-style: none}
-->
</style>
<link rel="stylesheet" type="text/css" href="gforth.css">


</head>

<body lang="en">
<div class="subsection" id="Gforth-locals">
<div class="header">
<p>
Next: <a href="Standard-Forth-locals.html" accesskey="n" rel="next">Standard Forth locals</a>, Previous: <a href="Locals.html" accesskey="p" rel="prev">Locals</a>, Up: <a href="Locals.html" accesskey="u" rel="up">Locals</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Word-Index.html" title="Index" rel="index">Index</a>]</p>
</div>
<hr>
<span id="Gforth-locals-1"></span><h4 class="subsection">6.22.1 Gforth locals</h4>
<span id="index-Gforth-locals"></span>
<span id="index-locals_002c-Gforth-style"></span>

<p>ローカル変数は以下のように定義できます
</p>
<div class="example">
<pre class="example">{: local1 local2 ... -- comment :}
</pre></div>
<p>or
</p><div class="example">
<pre class="example">{: local1 local2 ... :}
</pre></div>
<p>or
</p><div class="example">
<pre class="example">{: local1 local2 ... | ulocal0 ulocal1 -- comment :}
</pre></div>

<p>例えば、 以下のように使います
</p><div class="example">
<pre class="example">: max {: n1 n2 -- n3 :}
 n1 n2 &gt; if
   n1
 else
   n2
 endif ;
</pre></div>

<p>The similarity of locals definitions with stack comments is intended. A
locals definition often replaces the stack comment of a word. The order of
the locals corresponds to the order in a stack comment and everything after
the <code>--</code> is really a comment.
</p>
<p>This similarity has one disadvantage: It is too easy to confuse locals
declarations with stack comments, causing bugs and making them hard to
find. However, this problem can be avoided by appropriate coding
conventions: Do not use both notations in the same program. If you do, they
should be distinguished using additional means, e.g. by position.
</p>
<span id="index-types-of-locals"></span>
<span id="index-locals-types"></span>
<p>The name of the local may be preceded by a type specifier, e.g., <code>F:</code>
for a floating point value:
</p>
<div class="example">
<pre class="example">: CX* {: F: Ar F: Ai F: Br F: Bi -- Cr Ci :}
\ 複素数の掛け算
 Ar Br f* Ai Bi f* f-
 Ar Bi f* Ai Br f* f+ ;
</pre></div>

<span id="index-flavours-of-locals"></span>
<span id="index-locals-flavours"></span>
<span id="index-value_002dflavoured-locals"></span>
<span id="index-varue_002dflavoured-locals"></span>
<span id="index-variable_002dflavoured-locals"></span>
<p>Gforth currently supports cells (<code>W:</code>, <code>WA:</code>, <code>W^</code>), doubles
(<code>D:</code>, <code>DA:</code>, <code>D^</code>), floats (<code>F:</code>, <code>FA:</code>,
<code>F^</code>), characters (<code>C:</code>, <code>CA:</code>, <code>C^</code>), and xts
(<code>xt:</code>, <code>xta:</code>) in several flavours:
</p>
<dl compact="compact">
<dt><span><em>valueフレーバー(value-flavoured)</em></span></dt>
<dd><p>(see <a href="Values.html">Values</a>) A value-flavoured local (defined with <code>W:</code>, <code>D:</code>
etc.) produces its value and can be changed with <code>TO</code>.
</p>
</dd>
<dt><span><em>varue-flavoured</em></span></dt>
<dd><p>(see <a href="Varues.html">Varues</a>) A varue-flavoured local <i>l</i> (defined with <code>WA:</code>
etc.) behaves exactly like a value-flavoured local, except that you can use
<code>addr <i>l</i></code> to get its address (which becomes invalid when the
variable&rsquo;s scope is left).  Currently there is no performance difference,
but in the long run value-flavoured locals will be significantly faster,
because they can reside in registers.
</p>
</dd>
<dt><span><em>variable-flavoured</em></span></dt>
<dd><p>(see <a href="Variables.html">Variables</a>) A variable-flavoured local (defined with <code>W^</code> etc.)
produces its address (which becomes invalid when the variable&rsquo;s scope is
left).  E.g., the standard word <code>emit</code> can be defined in terms of
<code>type</code> like this:
</p>
<div class="example">
<pre class="example">: emit {: C^ char* -- :}
    char* 1 type ;
</pre></div>

</dd>
<dt><span><em>deferフレーバー(defer-flavoured)</em></span></dt>
<dd><p>(see <a href="Deferred-Words.html">Deferred Words</a>) (<code>XT:</code> または <code>XTA:</code> と指定した) defer
フレーバーのローカル変数 xt を <code>execute</code> します。 <code>action-of</code> を使用すると、 defer
フレーバーのローカル変数から xt を取得できます。  ローカル変数が <code>xta:</code> で定義されている場合、 <code>addr</code>
を使用して、 xt が保存されているアドレス(ローカル変数のスコープの終わりまで有効)を取得できます。  たとえば、 標準のワード
<code>execute</code> は、 以下のように defer フレーバーのローカル変数で定義できます:
</p>
<div class="example">
<pre class="example">: execute {: xt: x -- :}
  x ;
</pre></div>

</dd>
</dl>

<span id="index-default-type-of-locals"></span>
<span id="index-locals_002c-default-type"></span>
<p>A local without type specifier is a <code>W:</code> local.  You can allow or
disallow the use of <code>addr</code> with:
</p>
<span id="index-default_002dwa_003a-_0028--_002d_002d--_0029-gforth_002dexperimental"></span>
<span id="index-default_002dwa_003a"></span>
<span id="index-default_002dwa_003a-1"></span>
<div class="format">
<pre class="format"><code>default-wa:</code> ( <i>&ndash;  </i>) gforth-experimental &ldquo;default-wa:&rdquo;
</pre></div>
<p>Allow <code>addr</code> on locals defined without a type specifyer.  On other
words, define locals without a type specifyer using <code>wa:</code>.
</p>

<span id="index-default_002dw_003a-_0028--_002d_002d--_0029-gforth_002dexperimental"></span>
<span id="index-default_002dw_003a"></span>
<span id="index-default_002dw_003a-1"></span>
<div class="format">
<pre class="format"><code>default-w:</code> ( <i>&ndash;  </i>) gforth-experimental &ldquo;default-w:&rdquo;
</pre></div>
<p>Forbid <code>addr</code> on locals defined without a type specifyer.  On other
words, define locals without a type specifyer using <code>w:</code>.
</p>


<span id="index-locals-initialization"></span>
<span id="index-initialization-of-locals"></span>
<p>All flavours of locals are initialized with values from the data or (for FP
locals) FP stack, with the exception being locals defined behind <code>|</code>:
Gforth initializes them to 0; some Forth systems leave them uninitialized.
</p>
<span id="index-data-structure-locals"></span>
<p>Gforth supports the square bracket notation for local buffers and data
structures.  These locals are similar to variable-flavored locals, the size
is specified as a constant expression.  A declaration looks <code><i>name</i>[
<i>size</i> ]</code>.  The Forth expression <code><i>size</i></code> is evaluated during
declaration, it must have the stack effect <code>( -- +n )</code>, giving the size
in bytes.  The square bracket <code>[</code> is part of the defined name.
</p>
<p>Local data structures are initialized by copying <i>size</i> bytes from an
address passed on the stack; uninitialized local data structures (after
<code>|</code> in the declaration) are not erased, they just contain whatever data
there was on the locals stack before.
</p>
<p>Example:
</p>
<div class="example">
<pre class="example">begin-structure test-struct
  field: a1
  field: a2
end-structure

: test-local {: foo[ test-struct ] :}
    foo[ a1 !  foo[ a2 !
    foo[ test-struct dump ;
</pre></div>

<p>Gforth allows defining locals everywhere in a colon definition. This poses
the following questions:
</p>

<ul class="section-toc">
<li><a href="Locals-definition-words.html" accesskey="1">Locals definitions words</a></li>
<li><a href="Where-are-locals-visible-by-name_003f.html" accesskey="2">Where are locals visible by name?</a></li>
<li><a href="How-long-do-locals-live_003f.html" accesskey="3">How long do locals live?</a></li>
<li><a href="Locals-programming-style.html" accesskey="4">Locals programming style</a></li>
<li><a href="Locals-implementation.html" accesskey="5">Locals implementation</a></li>
<li><a href="Closures.html" accesskey="6">Closures</a></li>
</ul>
</div>
<hr>
<div class="header">
<p>
Next: <a href="Standard-Forth-locals.html">Standard Forth locals</a>, Previous: <a href="Locals.html">Locals</a>, Up: <a href="Locals.html">Locals</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Word-Index.html" title="Index" rel="index">Index</a>]</p>
</div>



</body>
</html>
