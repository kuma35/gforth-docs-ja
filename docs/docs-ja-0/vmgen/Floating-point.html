<!DOCTYPE html>
<html>
<!-- Created by GNU Texinfo 7.1, https://www.gnu.org/software/texinfo/ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<!-- このマニュアルは、 仮想マシン・インタープリタ・ジェネレーターである Vmgen (バージョン
0.7.9_20240418、April 18, 2024) 用です

Author: Anton Ertl Copyright © 2002,2003,2005,2007,2008,2019 Free
Software Foundation, Inc.

Permission is granted to copy, distribute and/or modify this document under
the terms of the GNU Free Documentation License, Version 1.2 or any later
version published by the Free Software Foundation; with no Invariant
Sections, with the Front-Cover texts being "A GNU Manual," and with the
Back-Cover Texts as in (a) below.  A copy of the license is included in the
section entitled "GNU Free Documentation License."

(a) The FSF's Back-Cover Text is: "You have freedom to copy and modify this
GNU Manual, like GNU software.  Copies published by the Free Software
Foundation raise funds for GNU development." -->
<title>Floating point (Vmgen (Gforth 0.7.9_20240418))</title>

<meta name="description" content="Floating point (Vmgen (Gforth 0.7.9_20240418))">
<meta name="keywords" content="Floating point (Vmgen (Gforth 0.7.9_20240418))">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<meta name="viewport" content="width=device-width,initial-scale=1">

<link href="index.html" rel="start" title="Top">
<link href="Index.html" rel="index" title="Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Hints.html" rel="up" title="Hints">
<link href="Hints.html" rel="prev" title="Hints">
<style type="text/css">
<!--
a.copiable-link {visibility: hidden; text-decoration: none; line-height: 0em}
span:hover a.copiable-link {visibility: visible}
-->
</style>


</head>

<body lang="en">
<div class="section-level-extent" id="Floating-point">
<div class="nav-panel">
<p>
Previous: <a href="Hints.html" accesskey="p" rel="prev">Hints</a>, Up: <a href="Hints.html" accesskey="u" rel="up">Hints</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Index.html" title="Index" rel="index">Index</a>]</p>
</div>
<hr>
<h3 class="section" id="Floating-point-1"><span>9.1 Floating point<a class="copiable-link" href="#Floating-point-1"> &para;</a></span></h3>

<p>How should you deal with floating point values? Should you use the same
stack as for integers/pointers, or a different one? This section discusses
this issue with a view on execution speed.
</p>
<p>The simpler approach is to use a separate floating-point stack.  This allows
you to choose FP value size without considering the size of the
integers/pointers, and you avoid a number of performance problems.  The main
downside is that this needs an FP stack pointer (and that may not fit in the
register file on the 386 arhitecture, costing some performance, but
comparatively little if you take the other option into account).  If you use
a separate FP stack (with stack pointer <code class="code">fp</code>), using an fpTOS is
helpful on most machines, but some spill the fpTOS register into memory, and
fpTOS should not be used there.
</p>
<p>The other approach is to share one stack (pointed to by, say, <code class="code">sp</code>)
between integer/pointer and floating-point values.  This is ok if you do not
use <code class="code">spTOS</code>.  If you do use <code class="code">spTOS</code>, the compiler has to decide
whether to put that variable into an integer or a floating point register,
and the other type of operation becomes quite expensive on most machines
(because moving values between integer and FP registers is quite
expensive).  If a value of one type has to be synthesized out of two values
of the other type (<code class="code">double</code> types), things are even more interesting.
</p>
<p>One way around this problem would be to not use the <code class="code">spTOS</code> supported
by Vmgen, but to use explicit top-of-stack variables (one for integers, one
for FP values), and having a kind of accumulator+stack architecture (e.g.,
Ocaml bytecode uses this approach); however, this is a major change, and its
ramifications are not completely clear.
</p>
</div>
<hr>
<div class="nav-panel">
<p>
Previous: <a href="Hints.html">Hints</a>, Up: <a href="Hints.html">Hints</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Index.html" title="Index" rel="index">Index</a>]</p>
</div>



</body>
</html>
