<!DOCTYPE html>
<html>
<!-- Created by GNU Texinfo 7.1, https://www.gnu.org/software/texinfo/ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<!-- このマニュアルは、 標準 Forth 言語の高速で移植可能な実装である Gforth (バージョン 0.7.9_20240418,
April 18, 2024)用です。 これはリファレンス・マニュアルとして機能しますが、 Forth の概要と Forth
チュートリアルも含まれています。

Authors: Bernd Paysan, Anton Ertl, Gerald Wodni Copyright © 1995,
1996, 1997, 1998, 2000, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010,
2011, 2012, 2013, 2014,2015,2016,2017,2018,2019,2020,2021,2022,2023 Free
Software Foundation, Inc.

Permission is granted to copy, distribute and/or modify this document under
the terms of the GNU Free Documentation License, Version 1.1 or any later
version published by the Free Software Foundation; with no Invariant
Sections, with the Front-Cover texts being "A GNU Manual," and with the
Back-Cover Texts as in (a) below.  A copy of the license is included in the
section entitled "GNU Free Documentation License."

(a) The FSF's Back-Cover Text is: "You have freedom to copy and modify this
GNU Manual, like GNU software.  Copies published by the Free Software
Foundation raise funds for GNU development." -->
<title>Locals programming style (Gforth マニュアル)</title>

<meta name="description" content="Locals programming style (Gforth マニュアル)">
<meta name="keywords" content="Locals programming style (Gforth マニュアル)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<meta name="viewport" content="width=device-width,initial-scale=1">

<link href="index.html" rel="start" title="Top">
<link href="Word-Index.html" rel="index" title="Word Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Gforth-locals.html" rel="up" title="Gforth locals">
<link href="Locals-implementation.html" rel="next" title="Locals implementation">
<link href="How-long-do-locals-live_003f.html" rel="prev" title="How long do locals live?">
<style type="text/css">
<!--
a.copiable-link {visibility: hidden; text-decoration: none; line-height: 0em}
div.example {margin-left: 3.2em}
span:hover a.copiable-link {visibility: visible}
-->
</style>
<link rel="stylesheet" type="text/css" href="gforth.css">


</head>

<body lang="en">
<div class="subsubsection-level-extent" id="Locals-programming-style">
<div class="nav-panel">
<p>
Next: <a href="Locals-implementation.html" accesskey="n" rel="next">Locals implementation</a>, Previous: <a href="How-long-do-locals-live_003f.html" accesskey="p" rel="prev">How long do locals live?</a>, Up: <a href="Gforth-locals.html" accesskey="u" rel="up">Gforth locals</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Word-Index.html" title="Index" rel="index">Index</a>]</p>
</div>
<hr>
<h4 class="subsubsection" id="Locals-programming-style-1"><span>6.22.1.4 Locals programming style<a class="copiable-link" href="#Locals-programming-style-1"> &para;</a></span></h4>
<a class="index-entry-id" id="index-locals-programming-style"></a>
<a class="index-entry-id" id="index-programming-style_002c-locals"></a>

<p>どこでもローカル変数を定義できる自由は、 プログラミング・スタイルを劇的に変える可能性を秘めています。 特に、
中間ストレージにリターン・スタックを使用する必要がなくなります。 さらに、 すべてのスタック操作(実行時に決定される引数を持つ <code class="code">PICK</code>
や <code class="code">ROLL</code> を除く)を排除できます。 スタック項目の順序が間違っている場合は、 すべてのスタック項目のローカル変数定義を記述し、
その次に、 あなたが必要とする順序で項目を書き込むだけです。
</p>
<p>これは少し突飛なように思えますし、 スタック操作を排除することが意識的なプログラミング目標になる可能性は低いです。 それでも、
ローカル変数を積極的に使用すれば、 スタック操作の数は大幅に減少します(例: <code class="code">max</code> (see <a class="pxref" href="Gforth-locals.html">Gforth locals</a>) を
<code class="code">max</code> の従来の実装と比較してみましょう)。
</p>
<p>これは、 ローカル変数の潜在的な利点の 1 つ、 つまり Forth プログラムを読みやすくすることを示しています。 もちろん、 この利点は、
プログラマがワードを長ったらしく書くための自由度を追加する訳ではなく、 ファクタリング(因数分解)の原則を尊重し続けた場合にのみ実現されます。
</p>
<a class="index-entry-id" id="index-single_002dassignment-style-for-locals"></a>
<p><code class="code">TO</code> の使用は可能な限り避けるべきです。  <code class="code">TO</code> がない場合、 すべてのvalueフレーバーのローカル変数には 1
つの代入しかなく、 関数型言語の多くの利点が Forth に当てはまります。 つまり、 プログラムの分析・最適化・読み取りが容易になります。
ローカル変数が何を表すかは定義から明らかであり、 後で別のものに変わることはありません。
</p>
<p>たとえば、 <code class="code">TO</code> を使用したローカル変数定義は以下のようになります:
</p><div class="example">
<pre class="example-preformatted">: strcmp {: addr1 u1 addr2 u2 -- n :}
 u1 u2 min 0
 ?do
   addr1 c@ addr2 c@ -
   ?dup-if
     unloop exit
   then
   addr1 char+ TO addr1
   addr2 char+ TO addr2
 loop
 u1 u2 - ;
</pre></div>
<p>ここで、 <code class="code">TO</code> は、 ループの反復ごとに <code class="code">addr1</code> と <code class="code">addr2</code> を更新するために使用されます。
<code class="code">strcmp</code> は、<code class="code">TO</code> の使用による可読性の問題の典型的な例です。  <code class="code">strcmp</code> を読み始めると、
<code class="code">addr1</code> が文字列の先頭を指していると考えるでしょう。 ループの終わり近くになって初めて、 それが何か別のものであることがわかります。
</p>
<p>これは、 現在の反復に適切な値で初期化される 2 つのローカル変数をループの開始時に定義することで回避できます。
</p><div class="example">
<pre class="example-preformatted">: strcmp {: addr1 u1 addr2 u2 -- n :}
 addr1 addr2
 u1 u2 min 0 
 ?do {: s1 s2 :}
   s1 c@ s2 c@ -
   ?dup-if
     unloop exit
   then
   s1 char+ s2 char+
 loop
 2drop
 u1 u2 - ;
</pre></div>
<p>ここで、 <code class="code">s1</code> がループの反復ごとに異なる値を持つことは最初から明らかです。
</p>
</div>



</body>
</html>
