<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!-- Created by GNU Texinfo 6.8, https://www.gnu.org/software/texinfo/ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<!-- このマニュアルは、 標準 Forth 言語の高速で移植可能な実装である Gforth (バージョン 0.7.9_20240418,
April 18, 2024)用です。 これはリファレンス・マニュアルとして機能しますが、 Forth の概要と Forth
チュートリアルも含まれています。

Authors: Bernd Paysan, Anton Ertl, Gerald Wodni Copyright (C) 1995,
1996, 1997, 1998, 2000, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010,
2011, 2012, 2013, 2014,2015,2016,2017,2018,2019,2020,2021,2022,2023 Free
Software Foundation, Inc.

Permission is granted to copy, distribute and/or modify this document under
the terms of the GNU Free Documentation License, Version 1.1 or any later
version published by the Free Software Foundation; with no Invariant
Sections, with the Front-Cover texts being "A GNU Manual," and with the
Back-Cover Texts as in (a) below.  A copy of the license is included in the
section entitled "GNU Free Documentation License."

(a) The FSF's Back-Cover Text is: "You have freedom to copy and modify this
GNU Manual, like GNU software.  Copies published by the Free Software
Foundation raise funds for GNU development." -->
<title>Memory Tutorial (Gforth マニュアル)</title>

<meta name="description" content="Memory Tutorial (Gforth マニュアル)">
<meta name="keywords" content="Memory Tutorial (Gforth マニュアル)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<meta name="viewport" content="width=device-width,initial-scale=1">

<link href="index.html" rel="start" title="Top">
<link href="Word-Index.html" rel="index" title="Word Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Tutorial.html" rel="up" title="Tutorial">
<link href="Characters-and-Strings-Tutorial.html" rel="next" title="Characters and Strings Tutorial">
<link href="Return-Stack-Tutorial.html" rel="prev" title="Return Stack Tutorial">
<style type="text/css">
<!--
a.copiable-anchor {visibility: hidden; text-decoration: none; line-height: 0em}
a.summary-letter {text-decoration: none}
blockquote.indentedblock {margin-right: 0em}
div.display {margin-left: 3.2em}
div.example {margin-left: 3.2em}
kbd {font-style: oblique}
pre.display {font-family: inherit}
pre.format {font-family: inherit}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
span.nolinebreak {white-space: nowrap}
span.roman {font-family: initial; font-weight: normal}
span.sansserif {font-family: sans-serif; font-weight: normal}
span:hover a.copiable-anchor {visibility: visible}
ul.no-bullet {list-style: none}
-->
</style>
<link rel="stylesheet" type="text/css" href="gforth.css">


</head>

<body lang="en">
<div class="section" id="Memory-Tutorial">
<div class="header">
<p>
Next: <a href="Characters-and-Strings-Tutorial.html" accesskey="n" rel="next">Characters and Strings</a>, Previous: <a href="Return-Stack-Tutorial.html" accesskey="p" rel="prev">Return Stack</a>, Up: <a href="Tutorial.html" accesskey="u" rel="up">Forth Tutorial</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Word-Index.html" title="Index" rel="index">Index</a>]</p>
</div>
<hr>
<span id="Memory-1"></span><h3 class="section">3.23 Memory</h3>
<span id="index-memory-access_002fallocation-tutorial"></span>

<p>以下使用してグローバル変数 <code>v</code> を作成できます:
</p>
<div class="example">
<pre class="example">variable v ( -- addr )
</pre></div>

<p><code>v</code> は、スタックにメモリー内の、とあるセルのアドレスをプッシュします。 このセルは <code>variable</code>
によって予約されています。 <code>!</code>(ストア)を使用してスタックからこのセルに値を保存し、
<code>@</code>(フェッチ)を使用して値をメモリーからスタックにロードできます:
</p>
<div class="example">
<pre class="example">v .
5 v ! .s
v @ .
</pre></div>

<p><code>dump</code> を使用すると、 メモリーの生のダンプ(メモリー・ダンプ)を確認できます:
</p>
<div class="example">
<pre class="example">v 1 cells .s dump
</pre></div>

<p><code>Cells ( n1 -- n2 )</code> は、 n1 個のセル が占めるバイト数(より一般的にはアドレス単位(address
units)(aus))を与えます。 そして、 あなたは、 さらに多くのメモリーを予約することもできます:
</p>
<div class="example">
<pre class="example">create v2 20 cells allot
v2 20 cells dump
</pre></div>

<p>変数のようなワード <code>v2</code> を作成し、 20 個の初期化されていないセルを予約します。 <code>v2</code>
によってプッシュされたアドレスは、 これら 20 個のセルの先頭を指します(see <a href="CREATE.html"><code>CREATE</code></a>)。 あなたは、 アドレス演算を使用して、
これらのセルにアクセスできます:
</p>
<div class="example">
<pre class="example">3 v2 5 cells + !
v2 20 cells dump
</pre></div>

<p><code>,</code> を使用してメモリーを予約 かつ 初期化できます:
</p>
<div class="example">
<pre class="example">create v3
  5 , 4 , 3 , 2 , 1 ,
v3 @ .
v3 cell+ @ .
v3 2 cells + @ .
v3 5 cells dump
</pre></div>

<blockquote>
<p><b>研究課題(assignment):</b> 最初のセルは <code>addr</code> 、 次のセルは <code>addr cell+</code> などとして、 <code>u</code>
個のセルの値の合計を計算する定義 <code>vsum ( addr u -- n )</code> を記述してみましょう。
</p></blockquote>

<p><code>variable</code> と <code>create</code> の違いは、<code>variable</code> がセルを割り当てる(allots)ことと、
標準 Forth では変数(variable)に追加のメモリーを割り当てることができないことです。
</p>
<p>新しいワードを作成せずにメモリーを予約することもできます:
</p>
<div class="example">
<pre class="example">here 10 cells allot .
here .
</pre></div>

<p>最初の <code>here</code> は(最初の <code>here</code> 時点の)ディクショナリー領域の後のアドレスをプッシュし、
メモリー領域の開始アドレスとして使い、 2 番目の <code>here</code> は(2 番目の <code>here</code>
時点の)ディクショナリー領域の後のアドレスをプッシュします。 この開始アドレスはどこかに保存する必要があります。 そうしないと、
あなたはこのメモリー領域を再度見つけるのが困難になります。
</p>
<p><code>Allot</code> はディクショナリー・メモリーを管理します。 ディクショナリー・メモリーには、 Gforth や他のほとんどの Forth
システムの、 ワードなどのシステムのデータ構造が含まれています。 これはスタックのように管理されます。
あなたは以下のようにして割り当て(<code>allot</code>)したメモリーを解放できます:
</p>
<div class="example">
<pre class="example">-10 cells allot
here .
</pre></div>

<p>注意: その合間に新しいワードを作成した場合、 それを実行できないことに注意してください(<code>allot</code> で作成されたメモリーが、
もはやディクショナリー「スタック」の頂上ではなくなるため)。
</p>
<p>その代わりに、 <code>allocate</code> や <code>free</code> を使用すると、 任意の順序でメモリを解放できます:
</p>
<div class="example">
<pre class="example">10 cells allocate throw .s
20 cells allocate throw .s
swap
free throw
free throw
</pre></div>

<p><code>throw</code> はエラー(メモリー不足など)を処理します。
</p>
<p>また、 <a href="https://www.complang.tuwien.ac.at/forth/garbage-collection.zip">ガベージ・コレクター</a> なら、 メモリーを明示的に解放(<code>free</code>)する必要がなくなります。
</p>
<p>こちらも参照ください: <a href="Memory.html">Memory</a>
</p>

</div>



</body>
</html>
