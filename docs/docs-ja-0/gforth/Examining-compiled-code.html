<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!-- Created by GNU Texinfo 6.8, https://www.gnu.org/software/texinfo/ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<!-- このマニュアルは、 標準 Forth 言語の高速で移植可能な実装である Gforth (バージョン 0.7.9_20240418,
April 18, 2024)用です。 これはリファレンス・マニュアルとして機能しますが、 Forth の概要と Forth
チュートリアルも含まれています。

Authors: Bernd Paysan, Anton Ertl, Gerald Wodni Copyright (C) 1995,
1996, 1997, 1998, 2000, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010,
2011, 2012, 2013, 2014,2015,2016,2017,2018,2019,2020,2021,2022,2023 Free
Software Foundation, Inc.

Permission is granted to copy, distribute and/or modify this document under
the terms of the GNU Free Documentation License, Version 1.1 or any later
version published by the Free Software Foundation; with no Invariant
Sections, with the Front-Cover texts being "A GNU Manual," and with the
Back-Cover Texts as in (a) below.  A copy of the license is included in the
section entitled "GNU Free Documentation License."

(a) The FSF's Back-Cover Text is: "You have freedom to copy and modify this
GNU Manual, like GNU software.  Copies published by the Free Software
Foundation raise funds for GNU development." -->
<title>Examining compiled code (Gforth マニュアル)</title>

<meta name="description" content="Examining compiled code (Gforth マニュアル)">
<meta name="keywords" content="Examining compiled code (Gforth マニュアル)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<meta name="viewport" content="width=device-width,initial-scale=1">

<link href="index.html" rel="start" title="Top">
<link href="Word-Index.html" rel="index" title="Word Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Programming-Tools.html" rel="up" title="Programming Tools">
<link href="Examining-data.html" rel="next" title="Examining data">
<link href="Locating-exception-source.html" rel="prev" title="Locating exception source">
<style type="text/css">
<!--
a.copiable-anchor {visibility: hidden; text-decoration: none; line-height: 0em}
a.summary-letter {text-decoration: none}
blockquote.indentedblock {margin-right: 0em}
div.display {margin-left: 3.2em}
div.example {margin-left: 3.2em}
kbd {font-style: oblique}
pre.display {font-family: inherit}
pre.format {font-family: inherit}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
span.nolinebreak {white-space: nowrap}
span.roman {font-family: initial; font-weight: normal}
span.sansserif {font-family: sans-serif; font-weight: normal}
span:hover a.copiable-anchor {visibility: visible}
ul.no-bullet {list-style: none}
-->
</style>
<link rel="stylesheet" type="text/css" href="gforth.css">


</head>

<body lang="en">
<div class="subsection" id="Examining-compiled-code">
<div class="header">
<p>
Next: <a href="Examining-data.html" accesskey="n" rel="next">Examining data and code</a>, Previous: <a href="Locating-exception-source.html" accesskey="p" rel="prev">Locating exception source</a>, Up: <a href="Programming-Tools.html" accesskey="u" rel="up">Programming Tools</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Word-Index.html" title="Index" rel="index">Index</a>]</p>
</div>
<hr>
<span id="Examining-compiled-code-1"></span><h4 class="subsection">6.26.4 Examining compiled code</h4>
<span id="index-compiled-code-examination"></span>

<p>そして最後に、 <code>see</code> とそのファミリーが、 コンパイル済のコードの表示を行います。  ソース・コード内の一部の内容は、
コンパイルされたコードには存在しません(書式設定やコメント等)。 しかし、 これは、 マクロや Gforth
の最適化機能によってどのようなスレッド化コード(threaded code)やネイティブ・コード(native
code)が生成されるかを確認するのに役立ちます。
</p>
<span id="index-see-_0028--_0022_003cspaces_003ename_0022-_002d_002d--_0029-tools"></span>
<span id="index-see"></span>
<span id="index-see-1"></span>
<div class="format">
<pre class="format"><code>see</code> ( <i>&quot;&lt;spaces&gt;name&quot; &ndash;  </i>) tools &ldquo;see&rdquo;
</pre></div>
<p>現在の検索順序(search order)を使用して <var>name</var> を <code>locate</code> します。 <code>locate</code>
できたら、 その定義を表示します。 これは定義を逆コンパイルすることで実現されるため、 書式は機械化され、
一部のソース情報(コメントや定義内のインタプリトされたシーケンスなど)は失われます。
</p>

<span id="index-xt_002dsee-_0028--xt-_002d_002d--_0029-gforth_002d0_002e2"></span>
<span id="index-xt_002dsee"></span>
<span id="index-xt_002dsee-1"></span>
<div class="format">
<pre class="format"><code>xt-see</code> ( <i>xt &ndash;  </i>) gforth-0.2 &ldquo;xt-see&rdquo;
</pre></div>
<p><i>xt</i> で表される定義を逆コンパイルします。
</p>

<span id="index-simple_002dsee-_0028--_0022name_0022-_002d_002d--_0029-gforth_002d0_002e6"></span>
<span id="index-simple_002dsee"></span>
<span id="index-simple_002dsee-1"></span>
<div class="format">
<pre class="format"><code>simple-see</code> ( <i>&quot;name&quot; &ndash;  </i>) gforth-0.6 &ldquo;simple-see&rdquo;
</pre></div>
<p>コロン定義 <i>name</i> を逆コンパイルして各セルごとに行表示し、 セルの意味を推測してそれを表示します。
</p>

<span id="index-xt_002dsimple_002dsee-_0028--xt-_002d_002d--_0029-gforth_002d1_002e0"></span>
<span id="index-xt_002dsimple_002dsee"></span>
<span id="index-xt_002dsimple_002dsee-1"></span>
<div class="format">
<pre class="format"><code>xt-simple-see</code> ( <i>xt &ndash;  </i>) gforth-1.0 &ldquo;xt-simple-see&rdquo;
</pre></div>
<p><code>simple-see</code> のようにコロン定義 <i>xt</i> を逆コンパイルします。
</p>

<span id="index-simple_002dsee_002drange-_0028--addr1-addr2-_002d_002d--_0029-gforth_002d0_002e6"></span>
<span id="index-simple_002dsee_002drange"></span>
<span id="index-simple_002dsee_002drange-1"></span>
<div class="format">
<pre class="format"><code>simple-see-range</code> ( <i>addr1 addr2 &ndash;  </i>) gforth-0.6 &ldquo;simple-see-range&rdquo;
</pre></div>
<p>[<i>addr1</i>,<i>addr2</i>) ( <i>addr1</i> &lt;= and &lt; <i>addr2</i> )の範囲のコードを
<code>simple-see</code>  のように逆コンパイルします
</p>

<span id="index-see_002dcode-_0028--_0022name_0022-_002d_002d--_0029-gforth_002d0_002e7"></span>
<span id="index-see_002dcode"></span>
<span id="index-see_002dcode-1"></span>
<div class="format">
<pre class="format"><code>see-code</code> ( <i>&quot;name&quot; &ndash;  </i>) gforth-0.7 &ldquo;see-code&rdquo;
</pre></div>
<p><code>simple-see</code> と似ていますが、 インライン化されたプリミティブの動的ネイティブ・コード(dynamic native
code)も表示されます。  静的命令融合(superinstructions)の場合、
最初のプリミティブではなくプリミティブ・シーケンスが表示されます(命令融合(superinstructions)の他のプリミティブも表示されます)。
ネイティブ・コードが生成されるプリミティブの場合、 最初と最後のレジスタ内のスタック項目の数が表示されます(たとえば、 <code>1-&gt;1</code> は、
最初と最後のレジスタに 1 つのスタック項目があることを意味します)。
ネイティブ・コードを使用した各プリミティブまたは命令融合(superinstructions)については、
インライン引数とコンポーネント・プリミティブが最初に表示され、 次にネイティブ・コードが表示されます。
</p>

<span id="index-xt_002dsee_002dcode-_0028--xt-_002d_002d--_0029-gforth_002d1_002e0"></span>
<span id="index-xt_002dsee_002dcode"></span>
<span id="index-xt_002dsee_002dcode-1"></span>
<div class="format">
<pre class="format"><code>xt-see-code</code> ( <i>xt &ndash;  </i>) gforth-1.0 &ldquo;xt-see-code&rdquo;
</pre></div>
<p>コロン定義 <i>xt</i> を <code>see-code</code> のように逆コンパイルします。
</p>

<span id="index-see_002dcode_002drange-_0028--addr1-addr2-_002d_002d--_0029-gforth_002d0_002e7"></span>
<span id="index-see_002dcode_002drange"></span>
<span id="index-see_002dcode_002drange-1"></span>
<div class="format">
<pre class="format"><code>see-code-range</code> ( <i>addr1 addr2 &ndash;  </i>) gforth-0.7 &ldquo;see-code-range&rdquo;
</pre></div>
<p>[<i>addr1</i>,<i>addr2</i>) ( <i>addr1</i> &lt;= and &lt; <i>addr2</i> )の範囲のコードを
<code>see-code</code> のように逆コンパイルします。
</p>


<p>例として、 以下について考えてみましょう:
</p>
<div class="example">
<pre class="example">: foo x f@ fsin drop over ;
</pre></div>

<p>この例は特に役に立つわけではありませんが、 さまざまなコード生成の違いを示しています。  これを AMD64 の <code>gforth-fast</code>
でコンパイルし、 <code>see-code foo</code> を使用すると以下の出力が得られます(訳注: OSのコマンドラインから、
<code>gforth</code> ではなくて <code>gforth-fast</code> で起動する):
</p>
<div class="example">
<pre class="example">$7FD0CEE8C510 lit f@     1-&gt;1 
$7FD0CEE8C518 x
$7FD0CEE8C520 f@
7FD0CEB51697:   movsd   [r12],xmm15
7FD0CEB5169D:   mov     rax,$00[r13]
7FD0CEB516A1:   sub     r12,$08
7FD0CEB516A5:   add     r13,$18
7FD0CEB516A9:   movsd   xmm15,[rax]
7FD0CEB516AE:   mov     rcx,-$08[r13]
7FD0CEB516B2:   jmp     ecx
$7FD0CEE8C528 fsin
$7FD0CEE8C530 drop    1-&gt;0 
7FD0CEB516B4:   add     r13,$08
$7FD0CEE8C538 over    0-&gt;1 
7FD0CEB516B8:   mov     r8,$10[r15]
7FD0CEB516BC:   add     r13,$08
$7FD0CEE8C540 ;s    1-&gt;1 
7FD0CEB516C0:   mov     r10,[rbx]
7FD0CEB516C3:   add     rbx,$08
7FD0CEB516C7:   lea     r13,$08[r10]
7FD0CEB516CB:   mov     rcx,-$08[r13]
7FD0CEB516CF:   jmp     ecx
</pre></div>

<p>まず、 コンポーネント <code>lit</code> と <code>f@</code>
を含む静的命令融合(superinstruction)のスレッド化コード・セルが表示されます。 それは、 レジスタ内の 1 つのデータ・スタック項目
(<code>1-&gt;1</code>) で始まり・終わります。 )。 これに、<code>lit</code> の引数 <code>x</code> のセルと、 命令融合の
<code>f@</code> コンポーネントのセルが続きます。 後者のセルは使用されませんが、 Gforth 内部の理由により存在します。
</p>
<p>その次に、 命令融合 <code>lit f@</code> に対して動的に生成されたネイティブ・コードを表示します。 注意: アドレスを比較するとわかるように、
このネイティブ・コードはメモリ内のスレッド化コードと混合されていない(not mixed)ことに注意してください。
</p>
<p>ここに表示されているネイティブ・コードを理解するには、以下のレジスタについて知っておくべきです:<br>スレッド化コードの命令ポインタは
<code>r13</code><br>データ・スタック・ポインタは <code>r15</code><br>最初(TOS)のデータ・スタック・レジスタは <code>r8</code>
(データ・スタックのTOS、 つまり、 レジスタにデータ・スタック項目が 1 つある場合、 スタックのTOSがそこに存在します)<br>リターン・スタック
ポインタは <code>rbx</code><br>FP スタック・ポインタは <code>r12</code><br>FP スタックの先頭(TOS)は
<code>xmm15</code><br>注意: レジスタの割り当てはエンジンによって異なるため、
コード表示においては異なるレジスタの割り当てが表示される場合があることに注意してください。
</p>
<p><code>lit f@</code> の動的ネイティブ・コードは、 ディスパッチ・ジャンプ(dispatch jump;別名 NEXT)(訳注:
古典的には内部インタプリタへ制御を戻すためのジャンプ)で終了します。 これは、 定義内の次のワード <code>fsin</code>
のネイティブ・コードは動的に生成しないためです。
</p>
<p>次に、 <code>fsin</code> のスレッド化コード・セルが表示されます。  このワードには動的に生成されるネイティブ・コードはなく、
<code>see-code</code> では静的ネイティブ・コードは表示されません(<code>fsin</code> の静的ネイティブ・コードを確認したければ
<code>see fsin</code>)。  <code>gforth-fast</code> 内の静的ネイティブ・コードを含むすべてのワードと同様、
データ・スタック表現への影響は <code>1-&gt;1</code> (<code>gforth</code> エンジンでは <code>0-&gt;0</code>) です。 しかし、
これは表示されません。
</p>
<p>次に、 <code>drop</code> のスレッド化コード・セルが表示されます。 ここで使用されるネイティブ・コード版のバリエーションは、 レジスタ内の 1
つのデータ・スタック項目で始まり、 レジスタ内の 0 個のデータ スタック項目で終わります(<code>1-&gt;0</code>)。  この後に
<code>drop</code> のこのバリエーションのネイティブ・コードが続きます。 ここのネイティブ・コードは次のワードのコードに続くため、 ここには
NEXT はありません。
</p>
<p>次に、 <code>over</code> のスレッド化コード・セルと、 その後に <code>0-&gt;1</code>
バリエーションで動的に生成されたネイティブ・コードが表示されます。
</p>
<p>最後に、 <code>;s</code>  のスレッド化されたネイティブ・コード(<code>foo</code> 内の <code>;</code>
用にコンパイルされたプリミティブ)が表示されます。 <code>;s</code> は制御フローを実行する(制御フローからリターンする)ため、 NEXT
で終了する必要があります。
</p>
</div>
<hr>
<div class="header">
<p>
Next: <a href="Examining-data.html">Examining data and code</a>, Previous: <a href="Locating-exception-source.html">Locating exception source</a>, Up: <a href="Programming-Tools.html">Programming Tools</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Word-Index.html" title="Index" rel="index">Index</a>]</p>
</div>



</body>
</html>
