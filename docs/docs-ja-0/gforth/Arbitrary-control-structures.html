<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!-- Created by GNU Texinfo 6.8, https://www.gnu.org/software/texinfo/ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<!-- このマニュアルは、 標準 Forth 言語の高速で移植可能な実装である Gforth (バージョン 0.7.9_20240418,
April 18, 2024)用です。 これはリファレンス・マニュアルとして機能しますが、 Forth の概要と Forth
チュートリアルも含まれています。

Authors: Bernd Paysan, Anton Ertl, Gerald Wodni Copyright (C) 1995,
1996, 1997, 1998, 2000, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010,
2011, 2012, 2013, 2014,2015,2016,2017,2018,2019,2020,2021,2022,2023 Free
Software Foundation, Inc.

Permission is granted to copy, distribute and/or modify this document under
the terms of the GNU Free Documentation License, Version 1.1 or any later
version published by the Free Software Foundation; with no Invariant
Sections, with the Front-Cover texts being "A GNU Manual," and with the
Back-Cover Texts as in (a) below.  A copy of the license is included in the
section entitled "GNU Free Documentation License."

(a) The FSF's Back-Cover Text is: "You have freedom to copy and modify this
GNU Manual, like GNU software.  Copies published by the Free Software
Foundation raise funds for GNU development." -->
<title>Arbitrary control structures (Gforth マニュアル)</title>

<meta name="description" content="Arbitrary control structures (Gforth マニュアル)">
<meta name="keywords" content="Arbitrary control structures (Gforth マニュアル)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<meta name="viewport" content="width=device-width,initial-scale=1">

<link href="index.html" rel="start" title="Top">
<link href="Word-Index.html" rel="index" title="Word Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Control-Structures.html" rel="up" title="Control Structures">
<link href="Calls-and-returns.html" rel="next" title="Calls and returns">
<link href="General-control-structures-with-CASE.html" rel="prev" title="General control structures with CASE">
<style type="text/css">
<!--
a.copiable-anchor {visibility: hidden; text-decoration: none; line-height: 0em}
a.summary-letter {text-decoration: none}
blockquote.indentedblock {margin-right: 0em}
div.display {margin-left: 3.2em}
div.example {margin-left: 3.2em}
kbd {font-style: oblique}
pre.display {font-family: inherit}
pre.format {font-family: inherit}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
span.nolinebreak {white-space: nowrap}
span.roman {font-family: initial; font-weight: normal}
span.sansserif {font-family: sans-serif; font-weight: normal}
span:hover a.copiable-anchor {visibility: visible}
ul.no-bullet {list-style: none}
-->
</style>
<link rel="stylesheet" type="text/css" href="gforth.css">


</head>

<body lang="en">
<div class="subsection" id="Arbitrary-control-structures">
<div class="header">
<p>
Next: <a href="Calls-and-returns.html" accesskey="n" rel="next">Calls and returns</a>, Previous: <a href="General-control-structures-with-CASE.html" accesskey="p" rel="prev">General control structures with <code>case</code></a>, Up: <a href="Control-Structures.html" accesskey="u" rel="up">Control Structures</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Word-Index.html" title="Index" rel="index">Index</a>]</p>
</div>
<hr>
<span id="Arbitrary-control-structures-1"></span><h4 class="subsection">6.9.6 Arbitrary control structures</h4>
<span id="index-control-structures_002c-user_002ddefined"></span>

<span id="index-control_002dflow-stack"></span>
<p>Standard Forth permits and supports using control structures in a non-nested
way. Information about incomplete control structures is stored on the
control-flow stack. This stack may be implemented on the Forth data stack,
and this is what we have done in Gforth.
</p>
<span id="index-orig_002c-control_002dflow-stack-item"></span>
<span id="index-dest_002c-control_002dflow-stack-item"></span>
<p>An <i>orig</i> entry represents an unresolved forward branch, a <i>dest</i> entry
represents a backward branch target. A few words are the basis for building
any control structure possible (except control structures that need storage,
like calls, coroutines, and backtracking).
</p>

<span id="index-IF-_0028--compilation-_002d_002d-orig-_003b-run_002dtime-f-_002d_002d--_0029-core"></span>
<span id="index-IF"></span>
<span id="index-IF-1"></span>
<div class="format">
<pre class="format"><code>IF</code> ( <i>compilation &ndash; orig ; run-time f &ndash;  </i>) core &ldquo;IF&rdquo;
</pre></div>
<p>At run-time, if <i>f</i>=0, execution continues after the <code>THEN</code> (or
<code>ELSE</code>) that consumes the <i>orig</i>, otherwise right after the <code>IF</code>
(see <a href="Selection.html">Selection</a>).
</p>

<span id="index-AHEAD-_0028--compilation-_002d_002d-orig-_003b-run_002dtime-_002d_002d--_0029-tools_002dext"></span>
<span id="index-AHEAD"></span>
<span id="index-AHEAD-1"></span>
<div class="format">
<pre class="format"><code>AHEAD</code> ( <i>compilation &ndash; orig ; run-time &ndash;  </i>) tools-ext &ldquo;AHEAD&rdquo;
</pre></div>
<p>At run-time, execution continues after the <code>THEN</code> that consumes the
<i>orig</i>.
</p>

<span id="index-THEN-_0028--compilation-orig-_002d_002d-_003b-run_002dtime-_002d_002d--_0029-core"></span>
<span id="index-THEN"></span>
<span id="index-THEN-1"></span>
<div class="format">
<pre class="format"><code>THEN</code> ( <i>compilation orig &ndash; ; run-time &ndash;  </i>) core &ldquo;THEN&rdquo;
</pre></div>
<p>The <code>IF</code>, <code>AHEAD</code>, <code>ELSE</code> or <code>WHILE</code> that pushed
<i>orig</i> jumps right after the <code>THEN</code> (see <a href="Selection.html">Selection</a>).
</p>

<span id="index-BEGIN-_0028--compilation-_002d_002d-dest-_003b-run_002dtime-_002d_002d--_0029-core"></span>
<span id="index-BEGIN"></span>
<span id="index-BEGIN-1"></span>
<div class="format">
<pre class="format"><code>BEGIN</code> ( <i>compilation &ndash; dest ; run-time &ndash;  </i>) core &ldquo;BEGIN&rdquo;
</pre></div>
<p>The <code>UNTIL</code>, <code>AGAIN</code> or <code>REPEAT</code> that consumes the <i>dest</i>
jumps right behind the <code>BEGIN</code> (see <a href="Simple-Loops.html">Simple Loops</a>).
</p>

<span id="index-UNTIL-_0028--compilation-dest-_002d_002d-_003b-run_002dtime-f-_002d_002d--_0029-core"></span>
<span id="index-UNTIL"></span>
<span id="index-UNTIL-1"></span>
<div class="format">
<pre class="format"><code>UNTIL</code> ( <i>compilation dest &ndash; ; run-time f &ndash;  </i>) core &ldquo;UNTIL&rdquo;
</pre></div>
<p>At run-time, if <i>f</i>=0, execution continues after the <code>BEGIN</code> that
produced <i>dest</i>, otherwise right after the <code>UNTIL</code> (see <a href="Simple-Loops.html">Simple Loops</a>).
</p>

<span id="index-AGAIN-_0028--compilation-dest-_002d_002d-_003b-run_002dtime-_002d_002d--_0029-core_002dext"></span>
<span id="index-AGAIN"></span>
<span id="index-AGAIN-1"></span>
<div class="format">
<pre class="format"><code>AGAIN</code> ( <i>compilation dest &ndash; ; run-time &ndash;  </i>) core-ext &ldquo;AGAIN&rdquo;
</pre></div>
<p>At run-time, execution continues after the <code>BEGIN</code> that produced the
<i>dest</i> (see <a href="Simple-Loops.html">Simple Loops</a>).
</p>

<span id="index-CS_002dPICK-_0028--orig0_002fdest0-orig1_002fdest1-_002e_002e_002e-origu_002fdestu-u-_002d_002d-_002e_002e_002e-orig0_002fdest0--_0029-tools_002dext"></span>
<span id="index-CS_002dPICK"></span>
<span id="index-CS_002dPICK-1"></span>
<div class="format">
<pre class="format"><code>CS-PICK</code> ( <i>orig0/dest0 orig1/dest1 ... origu/destu u &ndash; ... orig0/dest0  </i>) tools-ext &ldquo;c-s-pick&rdquo;
</pre></div>

<span id="index-CS_002dROLL-_0028--destu_002forigu-_002e_002e-dest0_002forig0-u-_002d_002d-_002e_002e-dest0_002forig0-destu_002forigu--_0029-tools_002dext"></span>
<span id="index-CS_002dROLL"></span>
<span id="index-CS_002dROLL-1"></span>
<div class="format">
<pre class="format"><code>CS-ROLL</code> ( <i>destu/origu .. dest0/orig0 u &ndash; .. dest0/orig0 destu/origu  </i>) tools-ext &ldquo;c-s-roll&rdquo;
</pre></div>

<span id="index-CS_002dDROP-_0028--dest-_002d_002d--_0029-gforth_002d1_002e0"></span>
<span id="index-CS_002dDROP"></span>
<span id="index-CS_002dDROP-1"></span>
<div class="format">
<pre class="format"><code>CS-DROP</code> ( <i>dest &ndash;  </i>) gforth-1.0 &ldquo;CS-DROP&rdquo;
</pre></div>


<p>The Standard words <code>CS-PICK</code> and <code>CS-ROLL</code> allow you to manipulate
the control-flow stack in a portable way. Without them, you would need to
know how many stack items are occupied by a control-flow entry (many systems
use one cell. In Gforth they currently take three, but this may change in
the future).
</p>
<p><code>CS-PICK</code> can only pick a dest and <code>CS-DROP</code> can only drop a dest,
because an orig must be resolved exactly once.
</p>
<p>Some standard control structure words are built from these words:
</p>

<span id="index-ELSE-_0028--compilation-orig1-_002d_002d-orig2-_003b-run_002dtime-_002d_002d--_0029-core"></span>
<span id="index-ELSE"></span>
<span id="index-ELSE-1"></span>
<div class="format">
<pre class="format"><code>ELSE</code> ( <i>compilation orig1 &ndash; orig2 ; run-time &ndash;  </i>) core &ldquo;ELSE&rdquo;
</pre></div>
<p>At run-time, execution continues after the <code>THEN</code> that consumes the
<i>orig</i>; the <code>IF</code>, <code>AHEAD</code>, <code>ELSE</code> or <code>WHILE</code> that
pushed <i>orig1</i> jumps right after the <code>ELSE</code>.  (see <a href="Selection.html">Selection</a>).
</p>

<span id="index-WHILE-_0028--compilation-dest-_002d_002d-orig-dest-_003b-run_002dtime-f-_002d_002d--_0029-core"></span>
<span id="index-WHILE"></span>
<span id="index-WHILE-1"></span>
<div class="format">
<pre class="format"><code>WHILE</code> ( <i>compilation dest &ndash; orig dest ; run-time f &ndash;  </i>) core &ldquo;WHILE&rdquo;
</pre></div>
<p>At run-time, if <i>f</i>=0, execution continues after the <code>REPEAT</code> (or
<code>THEN</code> or <code>ELSE</code>) that consumes the <i>orig</i>, otherwise right
after the <code>WHILE</code> (see <a href="Simple-Loops.html">Simple Loops</a>).
</p>

<span id="index-REPEAT-_0028--compilation-orig-dest-_002d_002d-_003b-run_002dtime-_002d_002d--_0029-core"></span>
<span id="index-REPEAT"></span>
<span id="index-REPEAT-1"></span>
<div class="format">
<pre class="format"><code>REPEAT</code> ( <i>compilation orig dest &ndash; ; run-time &ndash;  </i>) core &ldquo;REPEAT&rdquo;
</pre></div>
<p>At run-time, execution continues after the <code>BEGIN</code> that produced the
<i>dest</i>; the <code>WHILE</code>, <code>IF</code>, <code>AHEAD</code> or <code>ELSE</code> that
pushed <i>orig</i> jumps right after the <code>REPEAT</code>.  (see <a href="Simple-Loops.html">Simple Loops</a>).
</p>



<p>Gforth adds some more control-structure words:
</p>

<span id="index-ENDIF-_0028--compilation-orig-_002d_002d-_003b-run_002dtime-_002d_002d--_0029-gforth_002d0_002e2"></span>
<span id="index-ENDIF"></span>
<span id="index-ENDIF-1"></span>
<div class="format">
<pre class="format"><code>ENDIF</code> ( <i>compilation orig &ndash; ; run-time &ndash;  </i>) gforth-0.2 &ldquo;ENDIF&rdquo;
</pre></div>
<p>Same as <code>THEN</code>.
</p>

<span id="index-_003fdup_002dIF-_0028--compilation-_002d_002d-orig-_003b-run_002dtime-n-_002d_002d-n_007c--_0029-gforth_002d0_002e2"></span>
<span id="index-_003fdup_002dIF"></span>
<span id="index-_003fdup_002dIF-1"></span>
<div class="format">
<pre class="format"><code>?dup-IF</code> ( <i>compilation &ndash; orig ; run-time n &ndash; n|  </i>) gforth-0.2 &ldquo;question-dupe-if&rdquo;
</pre></div>
<p>This is the preferred alternative to the idiom &quot;<code>?DUP IF</code>&quot;, since it
can be better handled by tools like stack checkers. Besides, it&rsquo;s faster.
</p>

<span id="index-_003fDUP_002d0_003d_002dIF-_0028--compilation-_002d_002d-orig-_003b-run_002dtime-n-_002d_002d-n_007c--_0029-gforth_002d0_002e2"></span>
<span id="index-_003fDUP_002d0_003d_002dIF"></span>
<span id="index-_003fDUP_002d0_003d_002dIF-1"></span>
<div class="format">
<pre class="format"><code>?DUP-0=-IF</code> ( <i>compilation &ndash; orig ; run-time n &ndash; n|  </i>) gforth-0.2 &ldquo;question-dupe-zero-equals-if&rdquo;
</pre></div>


<p>Another group of control structure words are:
</p>

<span id="index-case-_0028--compilation-_002d_002d-case_002dsys-_003b-run_002dtime-_002d_002d--_0029-core_002dext"></span>
<span id="index-case"></span>
<span id="index-case-1"></span>
<div class="format">
<pre class="format"><code>case</code> ( <i>compilation  &ndash; case-sys ; run-time  &ndash;  </i>) core-ext &ldquo;case&rdquo;
</pre></div>
<p>Start a <code>case</code> structure.
</p>

<span id="index-endcase-_0028--compilation-case_002dsys-_002d_002d-_003b-run_002dtime-x-_002d_002d--_0029-core_002dext"></span>
<span id="index-endcase"></span>
<span id="index-endcase-1"></span>
<div class="format">
<pre class="format"><code>endcase</code> ( <i>compilation case-sys &ndash; ; run-time x &ndash;  </i>) core-ext &ldquo;end-case&rdquo;
</pre></div>
<p>Finish the <code>case</code> structure; drop x, and continue behind the
<code>endcase</code>.  Dropping x is useful in the original <code>case</code> construct
(with only <code>of</code>s), but you may have to supply an x in other cases
(especially when using <code>?of</code>).
</p>

<span id="index-next_002dcase-_0028--compilation-case_002dsys-_002d_002d-_003b-run_002dtime-_002d_002d--_0029-gforth_002d1_002e0"></span>
<span id="index-next_002dcase"></span>
<span id="index-next_002dcase-1"></span>
<div class="format">
<pre class="format"><code>next-case</code> ( <i>compilation case-sys &ndash; ; run-time &ndash;  </i>) gforth-1.0 &ldquo;next-case&rdquo;
</pre></div>
<p>Restart the <code>case</code> loop by jumping to the matching <code>case</code>.  Note
that <code>next-case</code> does not drop a cell, unlike <code>endcase</code>.
</p>

<span id="index-of-_0028--compilation-_002d_002d-of_002dsys-_003b-run_002dtime-x1-x2-_002d_002d-_007cx1--_0029-core_002dext"></span>
<span id="index-of"></span>
<span id="index-of-1"></span>
<div class="format">
<pre class="format"><code>of</code> ( <i>compilation  &ndash; of-sys ; run-time x1 x2 &ndash; |x1  </i>) core-ext &ldquo;of&rdquo;
</pre></div>
<p>If x1=x2, continue (dropping both); otherwise, leave x1 on the stack and
jump behind <code>endof</code> or <code>contof</code>.
</p>

<span id="index-_003fof-_0028--compilation-_002d_002d-of_002dsys-_003b-run_002dtime-f-_002d_002d--_0029-gforth_002d1_002e0"></span>
<span id="index-_003fof"></span>
<span id="index-_003fof-1"></span>
<div class="format">
<pre class="format"><code>?of</code> ( <i>compilation  &ndash; of-sys ; run-time  f &ndash;  </i>) gforth-1.0 &ldquo;question-of&rdquo;
</pre></div>
<p>If f is true, continue; otherwise, jump behind <code>endof</code> or
<code>contof</code>.
</p>

<span id="index-endof-_0028--compilation-case_002dsys1-of_002dsys-_002d_002d-case_002dsys2-_003b-run_002dtime-_002d_002d--_0029-core_002dext"></span>
<span id="index-endof"></span>
<span id="index-endof-1"></span>
<div class="format">
<pre class="format"><code>endof</code> ( <i>compilation case-sys1 of-sys &ndash; case-sys2 ; run-time  &ndash;  </i>) core-ext &ldquo;end-of&rdquo;
</pre></div>
<p>Exit the enclosing <code>case</code> structure by jumping behind
<code>endcase</code>/<code>next-case</code>.
</p>

<span id="index-contof-_0028--compilation-case_002dsys1-of_002dsys-_002d_002d-case_002dsys2-_003b-run_002dtime-_002d_002d--_0029-gforth_002d1_002e0"></span>
<span id="index-contof"></span>
<span id="index-contof-1"></span>
<div class="format">
<pre class="format"><code>contof</code> ( <i>compilation case-sys1 of-sys &ndash; case-sys2 ; run-time  &ndash;  </i>) gforth-1.0 &ldquo;cont-of&rdquo;
</pre></div>
<p>Restart the <code>case</code> loop by jumping to the enclosing <code>case</code>.
</p>


<p>Internally, <i>of-sys</i> is an <code>orig</code>; and <i>case-sys</i> is a cell and
some stack-depth information, 0 or more <code>orig</code>s, and a <code>dest</code>.
</p>
<ul class="section-toc">
<li><a href="#Programming-Style" accesskey="1">Programming Style</a></li>
</ul>
<div class="subsubsection" id="Programming-Style">
<h4 class="subsubsection">6.9.6.1 Programming Style</h4>
<span id="index-control-structures-programming-style"></span>
<span id="index-programming-style_002c-arbitrary-control-structures"></span>

<p>In order to ensure readability we recommend that you do not create arbitrary
control structures directly, but define new control structure words for the
control structure you want and use these words in your program. For example,
instead of writing:
</p>
<div class="example">
<pre class="example">BEGIN
  ...
IF [ 1 CS-ROLL ]
  ...
AGAIN THEN
</pre></div>

<p>we recommend defining control structure words, e.g.,
</p>
<div class="example">
<pre class="example">: WHILE ( DEST -- ORIG DEST )
 POSTPONE IF
 1 CS-ROLL ; immediate

: REPEAT ( orig dest -- )
 POSTPONE AGAIN
 POSTPONE THEN ; immediate
</pre></div>

<p>and then using these to create the control structure:
</p>
<div class="example">
<pre class="example">BEGIN
  ...
WHILE
  ...
REPEAT
</pre></div>

<p>That&rsquo;s much easier to read, isn&rsquo;t it? Of course, <code>REPEAT</code> and
<code>WHILE</code> are predefined, so in this example it would not be necessary to
define them.
</p>
</div>
</div>
<hr>
<div class="header">
<p>
Next: <a href="Calls-and-returns.html">Calls and returns</a>, Previous: <a href="General-control-structures-with-CASE.html">General control structures with <code>case</code></a>, Up: <a href="Control-Structures.html">Control Structures</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Word-Index.html" title="Index" rel="index">Index</a>]</p>
</div>



</body>
</html>
