<!DOCTYPE html>
<html>
<!-- Created by GNU Texinfo 7.1, https://www.gnu.org/software/texinfo/ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<!-- このマニュアルは、 標準 Forth 言語の高速で移植可能な実装である Gforth (バージョン 0.7.9_20240418,
April 18, 2024)用です。 これはリファレンス・マニュアルとして機能しますが、 Forth の概要と Forth
チュートリアルも含まれています。

Authors: Bernd Paysan, Anton Ertl, Gerald Wodni Copyright © 1995,
1996, 1997, 1998, 2000, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010,
2011, 2012, 2013, 2014,2015,2016,2017,2018,2019,2020,2021,2022,2023 Free
Software Foundation, Inc.

Permission is granted to copy, distribute and/or modify this document under
the terms of the GNU Free Documentation License, Version 1.1 or any later
version published by the Free Software Foundation; with no Invariant
Sections, with the Front-Cover texts being "A GNU Manual," and with the
Back-Cover Texts as in (a) below.  A copy of the license is included in the
section entitled "GNU Free Documentation License."

(a) The FSF's Back-Cover Text is: "You have freedom to copy and modify this
GNU Manual, like GNU software.  Copies published by the Free Software
Foundation raise funds for GNU development." -->
<title>Execution Tokens Tutorial (Gforth マニュアル)</title>

<meta name="description" content="Execution Tokens Tutorial (Gforth マニュアル)">
<meta name="keywords" content="Execution Tokens Tutorial (Gforth マニュアル)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<meta name="viewport" content="width=device-width,initial-scale=1">

<link href="index.html" rel="start" title="Top">
<link href="Word-Index.html" rel="index" title="Word Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Tutorial.html" rel="up" title="Tutorial">
<link href="Exceptions-Tutorial.html" rel="next" title="Exceptions Tutorial">
<link href="Interpretation-and-Compilation-Semantics-and-Immediacy-Tutorial.html" rel="prev" title="Interpretation and Compilation Semantics and Immediacy Tutorial">
<style type="text/css">
<!--
a.copiable-link {visibility: hidden; text-decoration: none; line-height: 0em}
div.example {margin-left: 3.2em}
span:hover a.copiable-link {visibility: visible}
-->
</style>
<link rel="stylesheet" type="text/css" href="gforth.css">


</head>

<body lang="en">
<div class="section-level-extent" id="Execution-Tokens-Tutorial">
<div class="nav-panel">
<p>
Next: <a href="Exceptions-Tutorial.html" accesskey="n" rel="next">Exceptions</a>, Previous: <a href="Interpretation-and-Compilation-Semantics-and-Immediacy-Tutorial.html" accesskey="p" rel="prev">Interpretation and Compilation Semantics and Immediacy</a>, Up: <a href="Tutorial.html" accesskey="u" rel="up">Forth Tutorial</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Word-Index.html" title="Index" rel="index">Index</a>]</p>
</div>
<hr>
<h3 class="section" id="Execution-Tokens"><span>3.29 Execution Tokens<a class="copiable-link" href="#Execution-Tokens"> &para;</a></span></h3>
<a class="index-entry-id" id="index-execution-tokens-tutorial"></a>
<a class="index-entry-id" id="index-XT-tutorial"></a>

<p><code class="code">' word</code> は、 ワードの実行トークン(execution token)(XT)を提供します。 XT は、
ワードのインタープリター機能(interpretation semantics)表すセルです。 これは <code class="code">execute</code> で実行できます:
</p>
<div class="example">
<pre class="example-preformatted">' + .s
1 2 rot execute .
</pre></div>

<p>XT は C の関数ポインターに似ています。 ただし、 パラメータがスタックで渡されるため、もう少し柔軟になります:
</p>
<div class="example">
<pre class="example-preformatted">: map-array ( ... addr u xt -- ... )
\ addr で始まり u 個の要素を含む配列のすべての要素に対して
\ xt ( ... x -- ... ) を実行します
  { xt }
  cells over + swap ?do
    i @ xt execute
  1 cells +loop ;

create a 3 , 4 , 2 , -1 , 4 ,
a 5 ' . map-array .s
0 a 5 ' + map-array .

s&quot; max-n&quot; environment? drop .s \ 下記比較初期値用に整数最大値を得る
a 5 ' min map-array . \ 最初の要素は、 environment? で取得した整数最大値と比較
</pre></div>

<p>生成するより消費する要素が 1 つ多いワードの XT に対して map-array を使用できます。 理論的には、他の XT でも使用できますが、
スタック効果は配列のサイズに依存するため、理解するのが困難です。
</p>
<p>XT はセルサイズであるため、 メモリーに保存し、 他のセルと同様にスタック上で操作できます。 <code class="code">compile,</code> を使用して XT
をワードにコンパイルすることもできます:
</p>
<div class="example">
<pre class="example-preformatted">: foo1 ( n1 n2 -- n )
   [ ' + compile, ] ;
see foo1
</pre></div>

<p><code class="code">compile,</code> は標準ではコンパイル機能(compilation semantics)がないため、 上記は標準ではないけれども、 良い
Forth システムでは動作します。 うまくいかなかったモノついては、 以下を使用してください
</p>
<div class="example">
<pre class="example-preformatted">: [compile,] compile, ; immediate

: foo1 ( n1 n2 -- n )
   [ ' + ] [compile,] ;
see foo1
</pre></div>

<p><code class="code">'</code> は、 デフォルトでコンパイル機能(compilation semantics)を持つワードです。
そのワードのインタープリター機能(interpretation semantics)を実行すると、 その次のワードを構文解析(parse)します。
</p>
<div class="example">
<pre class="example-preformatted">: foo ( -- xt )
  ' ;
see foo
: bar ( ... &quot;word&quot; -- ... )
  ' execute ;
see bar
1 2 bar + .
</pre></div>

<p>コンパイル中にワードを解析(parse)し、 その XT をコンパイルして、 実行時にスタックにプッシュされるようにしたいことがよくあります。
<code class="code">[']</code> はこれを行います:
</p>
<div class="example">
<pre class="example-preformatted">: xt-+ ( -- xt )
  ['] + ;
see xt-+
1 2 xt-+ execute .
</pre></div>

<p>多くのプログラマーは、 <code class="code">'</code> とそれが解析(parse)するワードを 1 つの単位として認識し、 コンパイル時に <code class="code">[']</code>
のように動作することを期待し、 実際の動作に混乱する傾向があります。 あなたがもしそうなら、 Forth システムは <code class="code">'</code> を 1
つの単位として捉えているだけであり、
それが解析(parse)ワードであるとはまったく考えていないことを覚えておいてください(この問題でプログラマーの便宜を図る試みは、 通常、
さらにひどい落とし穴につながります。
<a class="uref" href="https://www.complang.tuwien.ac.at/papers/ertl98.ps.gz"><code class="code">State</code>-smartness&mdash;Why it is evil and How to Exorcise it</a>)。
</p>
<p>XT の作成および実行は、 インタープリターの状態には影響を受けないことに注意してください。 つまり、 コンパイル状態で <code class="code">'</code>
を実行した場合でも、 インタープリター機能(interpretation semantics)が得られます。 そして、 そこでの状態が何であれ、
<code class="code">execute</code> は XT によって表されるコード(つまり、<code class="code">'</code> で生成された XT
の場合はインタープリター機能(interpretation semantics))を実行します。
</p>
<p>こちらも参照ください: <a class="ref" href="Tokens-for-Words.html">Tokens for Words</a>
</p>

</div>
<hr>
<div class="nav-panel">
<p>
Next: <a href="Exceptions-Tutorial.html">Exceptions</a>, Previous: <a href="Interpretation-and-Compilation-Semantics-and-Immediacy-Tutorial.html">Interpretation and Compilation Semantics and Immediacy</a>, Up: <a href="Tutorial.html">Forth Tutorial</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Word-Index.html" title="Index" rel="index">Index</a>]</p>
</div>



</body>
</html>
