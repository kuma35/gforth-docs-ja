<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!-- Created by GNU Texinfo 6.8, https://www.gnu.org/software/texinfo/ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<!-- このマニュアルは、 標準 Forth 言語の高速で移植可能な実装である Gforth (バージョン 0.7.9_20240418,
April 18, 2024)用です。 これはリファレンス・マニュアルとして機能しますが、 Forth の概要と Forth
チュートリアルも含まれています。

Authors: Bernd Paysan, Anton Ertl, Gerald Wodni Copyright (C) 1995,
1996, 1997, 1998, 2000, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010,
2011, 2012, 2013, 2014,2015,2016,2017,2018,2019,2020,2021,2022,2023 Free
Software Foundation, Inc.

Permission is granted to copy, distribute and/or modify this document under
the terms of the GNU Free Documentation License, Version 1.1 or any later
version published by the Free Software Foundation; with no Invariant
Sections, with the Front-Cover texts being "A GNU Manual," and with the
Back-Cover Texts as in (a) below.  A copy of the license is included in the
section entitled "GNU Free Documentation License."

(a) The FSF's Back-Cover Text is: "You have freedom to copy and modify this
GNU Manual, like GNU software.  Copies published by the Free Software
Foundation raise funds for GNU development." -->
<title>Environmental Queries (Gforth マニュアル)</title>

<meta name="description" content="Environmental Queries (Gforth マニュアル)">
<meta name="keywords" content="Environmental Queries (Gforth マニュアル)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<meta name="viewport" content="width=device-width,initial-scale=1">

<link href="index.html" rel="start" title="Top">
<link href="Word-Index.html" rel="index" title="Word Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Words.html" rel="up" title="Words">
<link href="Files.html" rel="next" title="Files">
<link href="Word-Lists.html" rel="prev" title="Word Lists">
<style type="text/css">
<!--
a.copiable-anchor {visibility: hidden; text-decoration: none; line-height: 0em}
a.summary-letter {text-decoration: none}
blockquote.indentedblock {margin-right: 0em}
div.display {margin-left: 3.2em}
div.example {margin-left: 3.2em}
kbd {font-style: oblique}
pre.display {font-family: inherit}
pre.format {font-family: inherit}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
span.nolinebreak {white-space: nowrap}
span.roman {font-family: initial; font-weight: normal}
span.sansserif {font-family: sans-serif; font-weight: normal}
span:hover a.copiable-anchor {visibility: visible}
ul.no-bullet {list-style: none}
-->
</style>
<link rel="stylesheet" type="text/css" href="gforth.css">


</head>

<body lang="en">
<div class="section" id="Environmental-Queries">
<div class="header">
<p>
Next: <a href="Files.html" accesskey="n" rel="next">Files</a>, Previous: <a href="Word-Lists.html" accesskey="p" rel="prev">Word Lists</a>, Up: <a href="Words.html" accesskey="u" rel="up">Forth Words</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Word-Index.html" title="Index" rel="index">Index</a>]</p>
</div>
<hr>
<span id="Environmental-Queries-1"></span><h3 class="section">6.17 Environmental Queries</h3>
<span id="index-environmental-queries"></span>

<p>Forth-94 は、システム上で実行されているプログラムがシステムの特定の特性を判断する方法として「環境問い合わせ」(&ldquo;environmental
query&rdquo;)という概念を導入しました。  標準では、 システムが認識できるたくさんの文字列と、 それらを問い合わせする方法が指定されています。
</p>
<span id="index-environment_003f-_0028--c_002daddr-u-_002d_002d-false-_002f-_002e_002e_002e-true--_0029-core"></span>
<span id="index-environment_003f"></span>
<span id="index-environment_003f-1"></span>
<div class="format">
<pre class="format"><code>environment?</code> ( <i>c-addr u &ndash; false / ... true  </i>) core &ldquo;environment-query&rdquo;
</pre></div>
<p>文字列 <i>c-addr, u</i> を指定します。 文字列が認識されない場合は、 <code>false</code> フラグを返します。
それ以外の場合は、<code>true</code> フラグと、 問い合わせした文字列に関する(それ固有の)情報を返します。
</p>


<p>注意: 例えば <code>ADDRESS-UNIT-BITS</code> のドキュメントではスタック上に 1 つのセルを返すことが示されていますが、
<code>environment?</code> を使用して問い合わせすると、 文字列が認識されたことを示す <code>true</code>
フラグという追加の項目が返されることに注意してください。 <code>ADDRESS-UNIT-BITS</code> を問い合わせた場合、
<code>environment?</code> のスタック効果は <code>( c-addr u -- n true )</code> です。
</p>

<p>いくつかの環境問い合わせ(environmental query)はシステムの制限を取り扱います:
</p>
<span id="index-ADDRESS_002dUNIT_002dBITS-_0028--_002d_002d-n--_0029-environment"></span>
<span id="index-ADDRESS_002dUNIT_002dBITS"></span>
<span id="index-ADDRESS_002dUNIT_002dBITS-1"></span>
<div class="format">
<pre class="format"><code>ADDRESS-UNIT-BITS</code> ( <i>&ndash; n  </i>) environment &ldquo;ADDRESS-UNIT-BITS&rdquo;
</pre></div>
<p>1 つのアドレス単位のサイズ(ビット単位)。
</p>

<span id="index-MAX_002dCHAR-_0028--_002d_002d-u--_0029-environment"></span>
<span id="index-MAX_002dCHAR"></span>
<span id="index-MAX_002dCHAR-1"></span>
<div class="format">
<pre class="format"><code>MAX-CHAR</code> ( <i>&ndash; u  </i>) environment &ldquo;MAX-CHAR&rdquo;
</pre></div>
<p>文字セット内の任意の文字の最大値
</p>

<span id="index-_002fCOUNTED_002dSTRING-_0028--_002d_002d-n--_0029-environment"></span>
<span id="index-_002fCOUNTED_002dSTRING"></span>
<span id="index-_002fCOUNTED_002dSTRING-1"></span>
<div class="format">
<pre class="format"><code>/COUNTED-STRING</code> ( <i>&ndash; n  </i>) environment &ldquo;slash-counted-string&rdquo;
</pre></div>
<p>カウンタ付き文字列の最大サイズ(文字単位)。
</p>

<span id="index-_002fHOLD-_0028--_002d_002d-n--_0029-environment"></span>
<span id="index-_002fHOLD"></span>
<span id="index-_002fHOLD-1"></span>
<div class="format">
<pre class="format"><code>/HOLD</code> ( <i>&ndash; n  </i>) environment &ldquo;slash-hold&rdquo;
</pre></div>
<p>描写された数値文字列の出力バッファのサイズ(文字単位)。
</p>

<span id="index-_002fPAD-_0028--_002d_002d-n--_0029-environment"></span>
<span id="index-_002fPAD"></span>
<span id="index-_002fPAD-1"></span>
<div class="format">
<pre class="format"><code>/PAD</code> ( <i>&ndash; n  </i>) environment &ldquo;slash-pad&rdquo;
</pre></div>
<p><code>PAD</code> が指すスクラッチ領域のサイズ(文字数)。
</p>

<span id="index-CORE-_0028--_002d_002d-f--_0029-environment"></span>
<span id="index-CORE"></span>
<span id="index-CORE-1"></span>
<div class="format">
<pre class="format"><code>CORE</code> ( <i>&ndash; f  </i>) environment &ldquo;CORE&rdquo;
</pre></div>
<p>完全なコア・ワード・セットが存在する場合は true。 Gforth では常に当てはまります。
</p>

<span id="index-CORE_002dEXT-_0028--_002d_002d-f--_0029-environment"></span>
<span id="index-CORE_002dEXT"></span>
<span id="index-CORE_002dEXT-1"></span>
<div class="format">
<pre class="format"><code>CORE-EXT</code> ( <i>&ndash; f  </i>) environment &ldquo;CORE-EXT&rdquo;
</pre></div>
<p>完全なコア拡張ワード・セットが存在する場合は true。 Gforth では常に当てはまります。
</p>

<span id="index-FLOORED-_0028--_002d_002d-f--_0029-environment"></span>
<span id="index-FLOORED"></span>
<span id="index-FLOORED-1"></span>
<div class="format">
<pre class="format"><code>FLOORED</code> ( <i>&ndash; f  </i>) environment &ldquo;FLOORED&rdquo;
</pre></div>
<p>true ならば、 <code>/</code> などで、 フロア除算(floored division)を実行します。
</p>

<span id="index-MAX_002dN-_0028--_002d_002d-n--_0029-environment"></span>
<span id="index-MAX_002dN"></span>
<span id="index-MAX_002dN-1"></span>
<div class="format">
<pre class="format"><code>MAX-N</code> ( <i>&ndash; n  </i>) environment &ldquo;MAX-N&rdquo;
</pre></div>
<p>使用可能な符号付き整数の最大値。
</p>

<span id="index-MAX_002dU-_0028--_002d_002d-u--_0029-environment"></span>
<span id="index-MAX_002dU"></span>
<span id="index-MAX_002dU-1"></span>
<div class="format">
<pre class="format"><code>MAX-U</code> ( <i>&ndash; u  </i>) environment &ldquo;MAX-U&rdquo;
</pre></div>
<p>使用可能な符号なし整数の最大値。
</p>

<span id="index-MAX_002dD-_0028--_002d_002d-d--_0029-environment"></span>
<span id="index-MAX_002dD"></span>
<span id="index-MAX_002dD-1"></span>
<div class="format">
<pre class="format"><code>MAX-D</code> ( <i>&ndash; d  </i>) environment &ldquo;MAX-D&rdquo;
</pre></div>
<p>使用可能な符号付き2倍長数の最大値。
</p>

<span id="index-MAX_002dUD-_0028--_002d_002d-ud--_0029-environment"></span>
<span id="index-MAX_002dUD"></span>
<span id="index-MAX_002dUD-1"></span>
<div class="format">
<pre class="format"><code>MAX-UD</code> ( <i>&ndash; ud  </i>) environment &ldquo;MAX-UD&rdquo;
</pre></div>
<p>使用可能な符号なし2倍長数の最大値。
</p>

<span id="index-return_002dstack_002dcells-_0028--_002d_002d-n--_0029-environment"></span>
<span id="index-return_002dstack_002dcells"></span>
<span id="index-return_002dstack_002dcells-1"></span>
<div class="format">
<pre class="format"><code>return-stack-cells</code> ( <i>&ndash; n  </i>) environment &ldquo;return-stack-cells&rdquo;
</pre></div>
<p>リターン・スタックの最大サイズ(セル単位)。
</p>

<span id="index-stack_002dcells-_0028--_002d_002d-n--_0029-environment"></span>
<span id="index-stack_002dcells"></span>
<span id="index-stack_002dcells-1"></span>
<div class="format">
<pre class="format"><code>stack-cells</code> ( <i>&ndash; n  </i>) environment &ldquo;stack-cells&rdquo;
</pre></div>
<p>データ・スタックの最大サイズ(セル単位)。
</p>

<span id="index-floating_002dstack-_0028--_002d_002d-n--_0029-environment"></span>
<span id="index-floating_002dstack"></span>
<span id="index-floating_002dstack-1"></span>
<div class="format">
<pre class="format"><code>floating-stack</code> ( <i>&ndash; n  </i>) environment &ldquo;floating-stack&rdquo;
</pre></div>
<p><var>n</var> はゼロ以外で、 Gforth が深さ <var>n</var> の別個の浮動小数点スタックを維持していることを示しています。
</p>

<span id="index-_0023locals-_0028--_002d_002d-n--_0029-environment"></span>
<span id="index-_0023locals"></span>
<span id="index-_0023locals-1"></span>
<div class="format">
<pre class="format"><code>#locals</code> ( <i>&ndash; n  </i>) environment &ldquo;number-locals&rdquo;
</pre></div>
<p>定義内のローカル変数の最大数
</p>

<span id="index-wordlists-_0028--_002d_002d-n--_0029-environment"></span>
<span id="index-wordlists"></span>
<span id="index-wordlists-1"></span>
<div class="format">
<pre class="format"><code>wordlists</code> ( <i>&ndash; n  </i>) environment &ldquo;wordlists&rdquo;
</pre></div>
<p>検索順序スタック(the search order)で使用できるワード・リストの最大数
</p>

<span id="index-max_002dfloat-_0028--_002d_002d-r--_0029-environment"></span>
<span id="index-max_002dfloat"></span>
<span id="index-max_002dfloat-1"></span>
<div class="format">
<pre class="format"><code>max-float</code> ( <i>&ndash; r  </i>) environment &ldquo;max-float&rdquo;
</pre></div>
<p>使用可能な浮動小数点数の最大値(Gforth では最大の有限数(finite number)として実装)
</p>

<span id="index-XCHAR_002dENCODING-_0028--_002d_002d-addr-u--_0029-environment"></span>
<span id="index-XCHAR_002dENCODING"></span>
<span id="index-XCHAR_002dENCODING-1"></span>
<div class="format">
<pre class="format"><code>XCHAR-ENCODING</code> ( <i>&ndash; addr u  </i>) environment &ldquo;XCHAR-ENCODING&rdquo;
</pre></div>
<p>エンコーディングを表す印刷可能なASCII文字列を返し、 (あれば)、 優先されるMIME名、 または &ldquo;ISO-LATIN-1&rdquo; や
&ldquo;UTF-8&rdquo; のような <a href="http://www.iana.org/assignments/character-sets">http://www.iana.org/assignments/character-sets</a>
の名前を使用します。 ただし、&ldquo;ASCII&rdquo; の場合は、 エイリアスの &ldquo;ASCII&rdquo; を優先します。
</p>

<span id="index-MAX_002dXCHAR-_0028--_002d_002d-xchar--_0029-environment"></span>
<span id="index-MAX_002dXCHAR"></span>
<span id="index-MAX_002dXCHAR-1"></span>
<div class="format">
<pre class="format"><code>MAX-XCHAR</code> ( <i>&ndash; xchar  </i>) environment &ldquo;MAX-XCHAR&rdquo;
</pre></div>
<p>xchar の最大値。  これはエンコーディングによって異なります。
</p>

<span id="index-XCHAR_002dMAXMEM-_0028--_002d_002d-u--_0029-environment"></span>
<span id="index-XCHAR_002dMAXMEM"></span>
<span id="index-XCHAR_002dMAXMEM-1"></span>
<div class="format">
<pre class="format"><code>XCHAR-MAXMEM</code> ( <i>&ndash; u  </i>) environment &ldquo;XCHAR-MAXMEM&rdquo;
</pre></div>
<p>1 つの xchar によって消費される最大メモリをアドレス単位で返します。
</p>


<p>Forth-94 バージョンのワードセットの存在を確認するための環境問い合わせ(environemtal query)がいくつかあります。
当該文字列が存在する場合、 それらはすべて <code>( -- f )</code> のスタック効果を持ちます(つまり、 これらの問い合わせの
<code>environment?</code> のスタック効果は <code>( c-addr u -- false / f true )</code> です)。
</p>
<p><code>block block-ext double double-ext exception exception-ext facility
facility-ext file file-ext floating floating-ext locals locals-ext
memory-alloc memory-alloc-ext tools tools-ext search-order search-order-ext
string string-ext</code>
</p>
<p>上記ワードセットの問い合わせは、 ほとんど使用および実装されなかったため、 Forth-2012 ではこれらのワードセットの Forth-2012
バリエーションを問い合わせする方法が導入されませんでした。  代わりに、  <code>[defined]</code> (see <a href="Interpreter-Directives.html">Interpreter Directives</a>) を使用するというアイディアです。
</p>
<p>Forth-200x (次の標準に取り組むグループ。 このグループが作成するドキュメントも Forth-200x と呼ばれます)は、
提案された拡張機能(extension proposals)の変更が完了すると(CfV 段階)、
提案された拡張機能に対する拡張機能問い合わせ(extension query)を定義します。 そのため、 これらの提案を採用するプログラムは、
提案された拡張機能が適切かどうかを確認できます。 システムにはそれらがあり、 おそらくリファレンス実装(存在する場合)をロードします。
<code>environment?</code> がそのような問い合わせを見つけた場合、 <a href="www.forth200x.org">www.forth200x.org</a>
上の対応する提案がシステムに実装されます(ただし、 <code>environment?</code> の場合と同様、 存在しないモノは何も分かりません)。
これらの問い合わせにはスタック効果 <code>( -- )</code> があります。 つまり、 問い合わせに対して <code>environment?</code>
ではスタック効果 <code>( c-addr u -- false / true )</code> があり、 これはワードセット問い合わせよりも便利です。。
これらの提案の多くは Forth-2012 に組み込まれています。  拡張機能問い合わせも Forth
システム実装者の間で特に人気があるわけではないため、 <code>[define]</code> を使用する方が良いアプローチである可能性があります。
とにもかくにも、 Gforth は以下の拡張機能問い合わせ(extension query)を実装します:
</p>
<p><code>X:2value X:buffer X:deferred X:defined X:ekeys X:escaped-strings
X:extension-query X:fp-stack X:ftrunc X:fvalue X:locals X:n-to-r
X:number-prefixes X:parse-name X:required X:s-escape-quote X:s-to-f
X:structures X:synonym X:text-substitution X:throw-iors X:traverse-wordlist
X:xchar</code>
</p>
<p>さらに、 Gforth は以下の Gforth 固有の問い合わせを実装します:
</p>
<span id="index-gforth-_0028--_002d_002d-c_002daddr-u--_0029-gforth_002denvironment"></span>
<span id="index-gforth"></span>
<span id="index-gforth-1"></span>
<div class="format">
<pre class="format"><code>gforth</code> ( <i>&ndash; c-addr u  </i>) gforth-environment &ldquo;gforth&rdquo;
</pre></div>
<p>Gforth のこのバージョン(バージョン &gt; 0.3.0)のバージョン文字列を表す文字列。 さまざまなバージョンのバージョン文字列は、
辞書順(lexicographically)に並べることができることが保証されています。
</p>

<span id="index-os_002dclass-_0028--_002d_002d-c_002daddr-u--_0029-gforth_002denvironment"></span>
<span id="index-os_002dclass"></span>
<span id="index-os_002dclass-1"></span>
<div class="format">
<pre class="format"><code>os-class</code> ( <i>&ndash; c-addr u  </i>) gforth-environment &ldquo;os-class&rdquo;
</pre></div>
<p>ホスト・オペレーティング・システムを説明する文字列。
</p>

<span id="index-os_002dtype-_0028--_002d_002d-c_002daddr-u--_0029-gforth_002denvironment"></span>
<span id="index-os_002dtype"></span>
<span id="index-os_002dtype-1"></span>
<div class="format">
<pre class="format"><code>os-type</code> ( <i>&ndash; c-addr u  </i>) gforth-environment &ldquo;os-type&rdquo;
</pre></div>
<p>$host_os に等しい文字列
</p>


<p>標準の問い合わせでは、 環境問い合わせ(environmental query)に使用されるヘッダー・スペース(header space)が、
定義に使用されるヘッダー・スペースとは異なることが要求されます。
</p>
<p>通常、 Forth システムは、 環境問い合わせ(environmental query)「だけ」に使用されるワードリスト内に定義を作成することにより、
環境問い合わせをサポートします。 それが Gforth のやっていることです。
認知されている環境問い合わせのセットに定義を追加する標準的な方法はありませんが、 Gforth や、
ワードリスト・メカニズムを使用するその他のシステムでは、 環境問い合わせを受け入れるために使用されるワードリストは、
他のワードリストと同様に操作できます。
</p>
<span id="index-environment_002dwordlist-_0028--_002d_002d-wid--_0029-gforth_002d0_002e2"></span>
<span id="index-environment_002dwordlist"></span>
<span id="index-environment_002dwordlist-1"></span>
<div class="format">
<pre class="format"><code>environment-wordlist</code> ( <i>&ndash; wid  </i>) gforth-0.2 &ldquo;environment-wordlist&rdquo;
</pre></div>
<p><i>wid</i> は、 環境問い合わせ(environmental query)によって検索されるワードリストを識別します(SwiftForth および
VFX に存在)。
</p>

<span id="index-environment-_0028--_002d_002d--_0029-gforth_002d0_002e6"></span>
<span id="index-environment"></span>
<span id="index-environment-1"></span>
<div class="format">
<pre class="format"><code>environment</code> ( <i>&ndash;  </i>) gforth-0.6 &ldquo;environment&rdquo;
</pre></div>
<p><code>environment-wordlist</code> のボキャブラリ (Win32Forth および VFX に存在)。
</p>



<p>以下に、 環境問い合わせ(environmental query)の使用例をいくつか示します:
</p>
<div class="example">
<pre class="example">s&quot; address-unit-bits&quot; environment? 0=
[IF]
     cr .( environmental attribute address-units-bits unknown... ) cr
[ELSE]
     drop \ ensure balanced stack effect
[THEN]

\ 標準で throw を使うときにプログラムの冒頭でありそうなコード断片
\ 訳注: throw をサポートしていなければ <code>abort&quot;</code> に置き換え
s&quot; exception&quot; environment? [IF]
   0= [IF]
      : throw abort&quot; exception thrown&quot; ;
   [THEN]
[ELSE] \ we don't know, so make sure
   : throw abort&quot; exception thrown&quot; ;
[THEN]

s&quot; gforth&quot; environment? [IF] .( Gforth version ) TYPE
                        [ELSE] .( Not Gforth..) [THEN]

\ a program using v*
s&quot; gforth&quot; environment? [IF]
  s&quot; 0.5.0&quot; compare 0&lt; [IF] \ v* is a primitive since 0.5.0
   : v* ( f_addr1 nstride1 f_addr2 nstride2 ucount -- r )
     &gt;r swap 2swap swap 0e r&gt; 0 ?DO
       dup f@ over + 2swap dup f@ f* f+ over + 2swap
     LOOP
     2drop 2drop ; 
  [THEN]
[ELSE] \ 
  : v* ( f_addr1 nstride1 f_addr2 nstride2 ucount -- r )
  ...
[THEN]
</pre></div>

<p>以下は、  environment ワードリストに定義を追加する例です:
</p>
<div class="example">
<pre class="example">get-current environment-wordlist set-current
true constant block
true constant block-ext
set-current
</pre></div>

<p>以下のようにして、 environment ワードリストどのような定義があるかを確認できます:
</p>
<div class="example">
<pre class="example">environment-wordlist wordlist-words
</pre></div>


</div>
<hr>
<div class="header">
<p>
Next: <a href="Files.html">Files</a>, Previous: <a href="Word-Lists.html">Word Lists</a>, Up: <a href="Words.html">Forth Words</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Word-Index.html" title="Index" rel="index">Index</a>]</p>
</div>



</body>
</html>
