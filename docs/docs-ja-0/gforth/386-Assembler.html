<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!-- Created by GNU Texinfo 6.8, https://www.gnu.org/software/texinfo/ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<!-- このマニュアルは、 標準 Forth 言語の高速で移植可能な実装である Gforth (バージョン 0.7.9_20240418,
April 18, 2024)用です。 これはリファレンス・マニュアルとして機能しますが、 Forth の概要と Forth
チュートリアルも含まれています。

Authors: Bernd Paysan, Anton Ertl, Gerald Wodni Copyright (C) 1995,
1996, 1997, 1998, 2000, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010,
2011, 2012, 2013, 2014,2015,2016,2017,2018,2019,2020,2021,2022,2023 Free
Software Foundation, Inc.

Permission is granted to copy, distribute and/or modify this document under
the terms of the GNU Free Documentation License, Version 1.1 or any later
version published by the Free Software Foundation; with no Invariant
Sections, with the Front-Cover texts being "A GNU Manual," and with the
Back-Cover Texts as in (a) below.  A copy of the license is included in the
section entitled "GNU Free Documentation License."

(a) The FSF's Back-Cover Text is: "You have freedom to copy and modify this
GNU Manual, like GNU software.  Copies published by the Free Software
Foundation raise funds for GNU development." -->
<title>386 Assembler (Gforth マニュアル)</title>

<meta name="description" content="386 Assembler (Gforth マニュアル)">
<meta name="keywords" content="386 Assembler (Gforth マニュアル)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<meta name="viewport" content="width=device-width,initial-scale=1">

<link href="index.html" rel="start" title="Top">
<link href="Word-Index.html" rel="index" title="Word Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Assembler-and-Code-Words.html" rel="up" title="Assembler and Code Words">
<link href="AMD64-Assembler.html" rel="next" title="AMD64 Assembler">
<link href="Common-Disassembler.html" rel="prev" title="Common Disassembler">
<style type="text/css">
<!--
a.copiable-anchor {visibility: hidden; text-decoration: none; line-height: 0em}
a.summary-letter {text-decoration: none}
blockquote.indentedblock {margin-right: 0em}
div.display {margin-left: 3.2em}
div.example {margin-left: 3.2em}
kbd {font-style: oblique}
pre.display {font-family: inherit}
pre.format {font-family: inherit}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
span.nolinebreak {white-space: nowrap}
span.roman {font-family: initial; font-weight: normal}
span.sansserif {font-family: sans-serif; font-weight: normal}
span:hover a.copiable-anchor {visibility: visible}
ul.no-bullet {list-style: none}
-->
</style>
<link rel="stylesheet" type="text/css" href="gforth.css">


</head>

<body lang="en">
<div class="subsection" id="g_t386-Assembler">
<div class="header">
<p>
Next: <a href="AMD64-Assembler.html" accesskey="n" rel="next">AMD64 (x86_64) Assembler</a>, Previous: <a href="Common-Disassembler.html" accesskey="p" rel="prev">Common Disassembler</a>, Up: <a href="Assembler-and-Code-Words.html" accesskey="u" rel="up">Assembler and Code Words</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Word-Index.html" title="Index" rel="index">Index</a>]</p>
</div>
<hr>
<span id="g_t386-Assembler-1"></span><h4 class="subsection">6.29.4 386 Assembler</h4>

<p>Gforth に含まれる 386 アセンブラは Bernd Paysan によって書かれ、 GPL の下で入手可能で、 元々は bigFORTH
の一部でした。
</p>
<p>Gforth に含まれる 386 逆アセンブラは Andrew McKewan によって作成され、 パブリック・ドメインです。
</p>
<p>逆アセンブラは、 Intel のようなプレフィックス構文(Intel-like prefix syntax)でコードを表示します。
</p>
<p>アセンブラは、 AT&amp;T スタイルのパラメータ順序(つまり、宛先が最後;destination last)で後置構文(postfix
syntax)を使用します。
</p>
<p>アセンブラには、 Athlon のすべての命令、 つまり 486 コア命令や、Pentium および PPro
拡張機能や、浮動小数点、MMX、3Dnow! が含まれていますが、 ISSE は含まれていません。 これは、16 ビットおよび 32
ビットの統合アセンブラです。デフォルトは 32 ビットですが、 <code>.86</code> で 16 ビットに切り替え、<code>.386</code> で 32
ビットに戻すことができます。
</p>
<p>異なる操作サイズを切り替えるためのプレフィックスがいくつかあります。 バイト・アクセスの場合は <code>.b</code> 、 ワード・アクセスの場合は
<code>.w</code> 、 ダブルワード・アクセスの場合は <code>.d</code> です。 アドレッシング・モードは、 16 ビットアドレスの場合は
<code>.wa</code> 、32 ビットアドレスの場合は <code>.da</code> で切り替えることができます。 (<code>AL</code> など、
)バイト・レジスタ名のプレフィックスは必要ありません 。
</p>
<p>浮動小数点演算の場合、 プレフィックスは <code>.fs</code> (IEEE single)、<code>.fl</code> (IEEE
double)、<code>.fx</code> (extended)、<code>.fw</code> (word)、 <code>.fd</code> (double-word)、
<code>.fq</code> (quad-word)。  デフォルトは <code>.fx</code> であるため、 Gforth FP 値を扱うときは
<code>.fl</code> を明示的に指定する必要があります。
</p>
<p>MMX オペコードにはサイズのプレフィックスはなく、 Intel アセンブラと同じように記述されます。 メモリ間での移動の代わりに、 PLDQ/PLDD
と PSTQ/PSTD があります。
</p>
<p>レジスタには「e」接頭辞がありません。 32 ビット モードでも、 eax は ax と呼ばれます。  即値は、<code>#</code>
を接尾辞として付けることによって示されます(例: <code>3 #</code>)。  以下に、 さまざまな構文でのアドレス指定モードの例をいくつか示します:
</p>
<div class="example">
<pre class="example">Gforth          Intel (NASM)   AT&amp;T (gas)      Name
.w ax           ax             %ax             register (16 bit)
ax              eax            %eax            register (32 bit)
3 #             offset 3       $3              immediate
1000 #)         byte ptr 1000  1000            displacement
bx )            [ebx]          (%ebx)          base
100 di d)       100[edi]       100(%edi)       base+displacement
20 ax *4 i#)    20[eax*4]      20(,%eax,4)     (index*scale)+displacement
di ax *4 i)     [edi][eax*4]   (%edi,%eax,4)   base+(index*scale)
4 bx cx di)     4[ebx][ecx]    4(%ebx,%ecx)    base+index+displacement
12 sp ax *2 di) 12[esp][eax*2] 12(%esp,%eax,2) base+(index*scale)+displacement
</pre></div>

<p><code>D)</code> と <code>DI)</code> の代わりに <code>L)</code> と <code>LI)</code> を使用して、32 ビット
displacement フィールドを強制できます(後のパッチ適用に役立ちます)。
</p>
<p>いくつかの命令の例は以下のとおりです:
</p>
<div class="example">
<pre class="example">ax bx mov             \ move ebx,eax
3 # ax mov            \ mov eax,3
100 di d) ax mov      \ mov eax,100[edi]
4 bx cx di) ax mov    \ mov eax,4[ebx][ecx]
.w ax bx mov          \ mov bx,ax
</pre></div>

<p>バイナリ命令では以下の形式がサポートされています:
</p>
<div class="example">
<pre class="example">&lt;reg&gt; &lt;reg&gt; &lt;inst&gt;
&lt;n&gt; # &lt;reg&gt; &lt;inst&gt;
&lt;mem&gt; &lt;reg&gt; &lt;inst&gt;
&lt;reg&gt; &lt;mem&gt; &lt;inst&gt;
&lt;n&gt; # &lt;mem&gt; &lt;inst&gt;
</pre></div>

<p>シフト/ローテート の構文は以下のとおりです:
</p>
<div class="example">
<pre class="example">&lt;reg/mem&gt; 1 # shl \ shortens to shift without immediate
&lt;reg/mem&gt; 4 # shl
&lt;reg/mem&gt; cl shl
</pre></div>

<p>バイト・バージョンを取得するには、 (<code>movs</code> などの)文字列命令(string instructions)の前に <code>.b</code>
を付けます。
</p>
<p>制御構造ワードの <code>IF</code> や <code>UNTIL</code> などの前に、 次の条件のいずれかを指定する必要があります: <code>vs vc
u&lt; u&gt;= 0= 0&lt;&gt; u&lt;= u&gt; 0&lt; 0&gt;= ps pc &lt; &gt;= &lt;= &gt;</code> (注意: <code>code</code> ワードなど、 検索パス内で
<code>assembler</code> が <code>forth</code> の前にある場合、 これらのワードのほとんどは Forth
ワードの一部を隠してしまう事に注意してください)。  現在、 制御構造ワードは 1 つのスタック項目を使用しているため、 それらをいじるには
<code>cs-roll</code> の代わりに <code>roll</code> を使用する必要があります(<code>swap</code> などを使用することもできます)。
</p>
<p>Intel ABI (Linux で使用)に基づいて、<code>abi-code</code> ワードは <code>4 sp d)</code>
でデータ・スタック・ポインターを見つけ、 <code>8 sp d)</code> で FP スタック・ポインターのアドレスを見つけることができます;
データ・スタック・ポインタは <code>ax</code> で返されます。 <code>Ax</code> や <code>cx</code> や <code>dx</code>
は呼び出し元で保存されるため、 ワード内に値を保存する必要はありません。  <code>ret</code> を使用してワードから戻ることができます。
パラメータは呼び出し元によってクリーンアップされます。
</p>
<p>386 の <code>abi-code</code> ワードの例については、 <a href="Assembler-Definitions.html">Definitions in assembly language</a>
</p>

</div>
<hr>
<div class="header">
<p>
Next: <a href="AMD64-Assembler.html">AMD64 (x86_64) Assembler</a>, Previous: <a href="Common-Disassembler.html">Common Disassembler</a>, Up: <a href="Assembler-and-Code-Words.html">Assembler and Code Words</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Word-Index.html" title="Index" rel="index">Index</a>]</p>
</div>



</body>
</html>
