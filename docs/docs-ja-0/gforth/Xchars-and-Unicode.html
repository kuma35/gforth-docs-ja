<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!-- Created by GNU Texinfo 6.8, https://www.gnu.org/software/texinfo/ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<!-- このマニュアルは、 標準 Forth 言語の高速で移植可能な実装である Gforth (バージョン 0.7.9_20240418,
April 18, 2024)用です。 これはリファレンス・マニュアルとして機能しますが、 Forth の概要と Forth
チュートリアルも含まれています。

Authors: Bernd Paysan, Anton Ertl, Gerald Wodni Copyright (C) 1995,
1996, 1997, 1998, 2000, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010,
2011, 2012, 2013, 2014,2015,2016,2017,2018,2019,2020,2021,2022,2023 Free
Software Foundation, Inc.

Permission is granted to copy, distribute and/or modify this document under
the terms of the GNU Free Documentation License, Version 1.1 or any later
version published by the Free Software Foundation; with no Invariant
Sections, with the Front-Cover texts being "A GNU Manual," and with the
Back-Cover Texts as in (a) below.  A copy of the license is included in the
section entitled "GNU Free Documentation License."

(a) The FSF's Back-Cover Text is: "You have freedom to copy and modify this
GNU Manual, like GNU software.  Copies published by the Free Software
Foundation raise funds for GNU development." -->
<title>Xchars and Unicode (Gforth マニュアル)</title>

<meta name="description" content="Xchars and Unicode (Gforth マニュアル)">
<meta name="keywords" content="Xchars and Unicode (Gforth マニュアル)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<meta name="viewport" content="width=device-width,initial-scale=1">

<link href="index.html" rel="start" title="Top">
<link href="Word-Index.html" rel="index" title="Word Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Other-I_002fO.html" rel="up" title="Other I/O">
<link href="i18n-and-l10n.html" rel="next" title="i18n and l10n">
<link href="Pipes.html" rel="prev" title="Pipes">
<style type="text/css">
<!--
a.copiable-anchor {visibility: hidden; text-decoration: none; line-height: 0em}
a.summary-letter {text-decoration: none}
blockquote.indentedblock {margin-right: 0em}
div.display {margin-left: 3.2em}
div.example {margin-left: 3.2em}
kbd {font-style: oblique}
pre.display {font-family: inherit}
pre.format {font-family: inherit}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
span.nolinebreak {white-space: nowrap}
span.roman {font-family: initial; font-weight: normal}
span.sansserif {font-family: sans-serif; font-weight: normal}
span:hover a.copiable-anchor {visibility: visible}
ul.no-bullet {list-style: none}
-->
</style>
<link rel="stylesheet" type="text/css" href="gforth.css">


</head>

<body lang="en">
<div class="subsection" id="Xchars-and-Unicode">
<div class="header">
<p>
Next: <a href="i18n-and-l10n.html" accesskey="n" rel="next">国際化(I18n)とローカライズ</a>, Previous: <a href="Pipes.html" accesskey="p" rel="prev">Pipes</a>, Up: <a href="Other-I_002fO.html" accesskey="u" rel="up">Other I/O</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Word-Index.html" title="Index" rel="index">Index</a>]</p>
</div>
<hr>
<span id="Xchars-and-Unicode-1"></span><h4 class="subsection">6.20.10 Xchars and Unicode</h4>

<p>ASCII は英語(English language)にのみ適しています。 ただし、 ほとんどの西洋言語(western
languages)は、それぞれの少数の特殊文字をエンコードするには 1 バイトで十分であるため、 Forth
の枠組みにある程度適合します(ただし、常に同じエンコードを使用できるとは限りません。 ただし、 latin-1 が最も広く使用されています)。
他の言語の場合は、 異なる文字セットを使用する必要があり、その一部は可変幅です。  この問題に対処するために、
文字はスタック上ではユニコード・コードポイント(Unicode codepoints)として表され、 メモリ内では UTF-8
バイト文字列として表されることがよくあります。 ユニコード・コードポイントは、 多くの場合、 1 つのアプリケーション・ レベル(one
application-level character)の文字を表しますが、 ユニコードは、基本文字(base
letter)と結合発音記号(combining diacritical mark)など、
複数のコード・ポイントで構成される分解文字(combining diacritical mark)もサポートします。
</p>
<p>ユニコード・コードポイントはメモリ内の複数バイトを消費する可能性があるため、 ここで我々の用語をすり合わせしておきましょう: char
はメモリ内の生のバイト、 またはスタック上の 0 ～ 255 の範囲の値です。  xchar (extended char) は 1
つのコードポイントを表します。 これはメモリ内の 1 バイト以上で表され、 スタック上にはより大きな値が存在する可能性があります。  ASCII 文字は
char や xchar と同一です。 つまり、0 ～ 127 の範囲の値、 かつ、 メモリ内のその値を含む 1 バイトです。
</p>
<p>UTF-8 エンコードを使用する場合、 他のすべてのコードポイントは 1 文字あたり 1 バイト以上必要になります。  ほとんどの場合、
このような文字はメモリ内の文字列として扱うだけでよく、 以下のワード群を使用する必要はありませんが、 個々のコードポイントを処理したい場合は、
以下のワード群が役に立ちます。  現時点では、 分解文字(decomposed characters)を扱うためのワードはありません。
</p>
<p>xchar ワード群はいくつかのデータ型を追加します:
</p>
<ul>
<li> <var>xc</var> はスタック上の拡張文字(xchar)です。 これは 1 つのセルを占有し、 符号なしセルのサブセットです。  16
ビット・システムでは、 ユニコード文字セットの BMP サブセット (つまり、 コードポイント&lt;65536)のみがスタック上で表現できます。
アプリケーション文字(application characters)を常に文字列として表現すると、 この制限を回避できます。

</li><li> <var>xc-addr</var> はメモリ内の xchar のアドレスです。 アライメント要件は <var>c-addr</var> と同じです。  xchar
のメモリ表現はスタック表現とは異なり、 使用されるエンコーディングによって異なります。 xchar はメモリ内で可変数の char を使用できます。

</li><li> <var>xc-addr</var> <var>u</var> はメモリ内の xchar のバッファで、<var>xc-addr</var> で始まり <var>u</var> char
(つまり、 xchar ではなくバイト)の長さになります。

</li></ul>

<span id="index-xc_002dsize-_0028--xc-_002d_002d-u--_0029-xchar"></span>
<span id="index-xc_002dsize"></span>
<span id="index-xc_002dsize-1"></span>
<div class="format">
<pre class="format"><code>xc-size</code> ( <i>xc &ndash; u  </i>) xchar &ldquo;x-c-size&rdquo;
</pre></div>
<p>xchar <var>xc</var> のメモリ・サイズを char で計算します。
</p>

<span id="index-x_002dsize-_0028--xc_002daddr-u1-_002d_002d-u2--_0029-xchar"></span>
<span id="index-x_002dsize"></span>
<span id="index-x_002dsize-1"></span>
<div class="format">
<pre class="format"><code>x-size</code> ( <i>xc-addr u1 &ndash; u2  </i>) xchar &ldquo;x-size&rdquo;
</pre></div>
<p><var>xc-addr</var> に格納されている最初の xchar のメモリ・サイズを char で計算します。
</p>

<span id="index-xc_0040-_0028--xc_002daddr-_002d_002d-xc--_0029-xchar_002dext"></span>
<span id="index-xc_0040"></span>
<span id="index-xc_0040-1"></span>
<div class="format">
<pre class="format"><code>xc@</code> ( <i>xc-addr &ndash; xc  </i>) xchar-ext &ldquo;xc-fetch&rdquo;
</pre></div>
<p><var>xc-addr1</var> から xchar <var>xc</var> を取得します。
</p>

<span id="index-xc_0040_002b-_0028--xc_002daddr1-_002d_002d-xc_002daddr2-xc--_0029-xchar"></span>
<span id="index-xc_0040_002b"></span>
<span id="index-xc_0040_002b-1"></span>
<div class="format">
<pre class="format"><code>xc@+</code> ( <i>xc-addr1 &ndash; xc-addr2 xc  </i>) xchar &ldquo;x-c-fetch-plus&rdquo;
</pre></div>
<p><var>xc-addr1</var> から xchar <var>xc</var> を取得します。 <var>xc-addr2</var> は、 <var>xc</var>
の後ろの最初のメモリ位置を指します。
</p>

<span id="index-xc_0040_002b_003f-_0028--xc_002daddr1-u1-_002d_002d-xc_002daddr2-u2-xc--_0029-gforth_002dexperimental"></span>
<span id="index-xc_0040_002b_003f"></span>
<span id="index-xc_0040_002b_003f-1"></span>
<div class="format">
<pre class="format"><code>xc@+?</code> ( <i>xc-addr1 u1 &ndash; xc-addr2 u2 xc  </i>) gforth-experimental &ldquo;x-c-fetch-plus-query&rdquo;
</pre></div>
<p>文字列 <var>xc-addr1 u1</var> の最初の xchar <var>xc</var> を取得します。 <var>xc-addr2 u2</var> は
<var>xc</var> の後ろの残りの文字列です。
</p>

<span id="index-xc_0021_002b_003f-_0028--xc-xc_002daddr1-u1-_002d_002d-xc_002daddr2-u2-f--_0029-xchar"></span>
<span id="index-xc_0021_002b_003f"></span>
<span id="index-xc_0021_002b_003f-1"></span>
<div class="format">
<pre class="format"><code>xc!+?</code> ( <i>xc xc-addr1 u1 &ndash; xc-addr2 u2 f  </i>) xchar &ldquo;x-c-store-plus-query&rdquo;
</pre></div>
<p>xchar <var>xc</var> を、 アドレス <var>xc-addr1</var> で始まり <var>u1</var> 文字分の大きさであるバッファーに格納します。
<var>xc-addr2</var> は <var>xc</var> の後の最初のメモリ位置を指し、 <var>u2</var> はバッファの残りのサイズです。 xchar
<var>xc</var> がバッファーに収まった場合、 <var>f</var> は true、 それ以外の場合は <var>f</var> は false で
<var>xc-addr2</var> <var>u2</var> は <var>xc-addr1</var> <var>u1</var> と等しくなります。 <code>XC!+?</code>
はバッファー・オーバーフローに対して安全であるため、 <code>XC!+</code> よりも推奨されます。
</p>

<span id="index-xc_0021_002b-_0028--xc-xc_002daddr1-_002d_002d-xc_002daddr2--_0029-xchar"></span>
<span id="index-xc_0021_002b"></span>
<span id="index-xc_0021_002b-1"></span>
<div class="format">
<pre class="format"><code>xc!+</code> ( <i>xc xc-addr1 &ndash; xc-addr2  </i>) xchar &ldquo;x-c-store&rdquo;
</pre></div>
<p>xchar <var>xc</var> を <var>xc-addr1</var> に保存します。  <var>xc-addr2</var> は、
バッファ内の次の未使用アドレスです。 これは最大 4 バイトを書き込むため、 アドレスをバッファの末尾と照合するだけの場合は、
有用なデータの上書きを避けるために、 バッファの末尾の後に少なくとも 3 バイトの余裕(パディング)が必要であることに注意してください。
</p>

<span id="index-xchar_002b-_0028--xc_002daddr1-_002d_002d-xc_002daddr2--_0029-xchar"></span>
<span id="index-xchar_002b"></span>
<span id="index-xchar_002b-1"></span>
<div class="format">
<pre class="format"><code>xchar+</code> ( <i>xc-addr1 &ndash; xc-addr2  </i>) xchar &ldquo;x-char-plus&rdquo;
</pre></div>
<p><var>xc-addr1</var> に格納されている xchar のサイズをこのアドレスに加算し、 <var>xc-addr2</var> を与えます(訳注: つまり、
次の xchar 文字の位置を返す)
</p>

<span id="index-xchar_002d-_0028--xc_002daddr1-_002d_002d-xc_002daddr2--_0029-xchar_002dext"></span>
<span id="index-xchar_002d"></span>
<span id="index-xchar_002d-1"></span>
<div class="format">
<pre class="format"><code>xchar-</code> ( <i>xc-addr1 &ndash; xc-addr2  </i>) xchar-ext &ldquo;x-char-minus&rdquo;
</pre></div>
<p><var>xc-addr1</var> から xchar が見つかるまで逆方向に進み、 この xchar のサイズを <var>xc-addr2</var> に加算すると
<var>xc-addr1</var> になります。
</p>

<span id="index-_002bx_002fstring-_0028--xc_002daddr1-u1-_002d_002d-xc_002daddr2-u2--_0029-xchar_002dext"></span>
<span id="index-_002bx_002fstring"></span>
<span id="index-_002bx_002fstring-1"></span>
<div class="format">
<pre class="format"><code>+x/string</code> ( <i>xc-addr1 u1 &ndash; xc-addr2 u2  </i>) xchar-ext &ldquo;plus-x-slash-string&rdquo;
</pre></div>
<p>アドレス <var>xc-addr1</var> サイズ <var>u1</var> 文字で定義されたバッファーで xchar 1つ分だけ進めたアドレスを
<var>xc-addr2</var> に返します。 u2 は xchar 分だけ u1 より減ります(残り文字列長さです)。 u2 が 0
になったら末尾まで到達しています。 注意:  0 になってもそこで止まりません更に進んでしまうので注意(長さが負数になる)
</p>

<span id="index-x_005cstring_002d-_0028--xc_002daddr-u1-_002d_002d-xc_002daddr-u2--_0029-xchar_002dext"></span>
<span id="index-x_005cstring_002d"></span>
<span id="index-x_005cstring_002d-1"></span>
<div class="format">
<pre class="format"><code>x\string-</code> ( <i>xc-addr u1 &ndash; xc-addr u2  </i>) xchar-ext &ldquo;x-backslash-string-minus&rdquo;
</pre></div>
<p>バッファの最後から開始して、 アドレス <var>xc-addr</var> とサイズ <var>u1</var> (char単位) で定義されたバッファー内で 1
xchar ずつ後方に進みます。 <var>xc-addr</var> は変わらず、 <var>u2</var> は xchar 分ずつ短くなります。 注意: 0
になっても止まりません。そのまま長さが負数になっていきます。
</p>

<span id="index-_002dtrailing_002dgarbage-_0028--xc_002daddr-u1-_002d_002d-xc_002daddr-u2--_0029-xchar_002dext"></span>
<span id="index-_002dtrailing_002dgarbage"></span>
<span id="index-_002dtrailing_002dgarbage-1"></span>
<div class="format">
<pre class="format"><code>-trailing-garbage</code> ( <i>xc-addr u1 &ndash; xc-addr u2  </i>) xchar-ext &ldquo;minus-trailing-garbage&rdquo;
</pre></div>
<p><var>xc-addr</var> <var>u1</var> というバッファー内の最後の XCHAR を調べます &mdash; エンコードが正しく、 完全な文字を表す場合
<var>u2</var> は <var>u1</var> と等しいです。 それ以外の場合は <var>u2</var> は、 最後の(文字化けした) xchar
を除いた文字列を表します。
</p>

<span id="index-x_002dwidth-_0028--xc_002daddr-u-_002d_002d-n--_0029-xchar_002dext"></span>
<span id="index-x_002dwidth"></span>
<span id="index-x_002dwidth-1"></span>
<div class="format">
<pre class="format"><code>x-width</code> ( <i>xc-addr u &ndash; n  </i>) xchar-ext &ldquo;x-width&rdquo;
</pre></div>
<p>アドレス <var>xc-addr</var> 長さ <var>u</var> (char単位)の文字列に対して、同じ幅の等幅 ASCII 文字での文字数を <var>n</var>
に得ます。 等幅フォントを想定しています。 つまり文字の幅はいずれも ASCII 文字の幅の整数倍であると仮定します(訳注: 含まれる xchar
ごとにその表示幅を調べたのを積算して返します buf $@ type abcあdef ok  buf $@len . 9  ok  buf $@
x-width . 8  ok)
</p>

<span id="index-xkey-_0028--_002d_002d-xc--_0029-xchar"></span>
<span id="index-xkey"></span>
<span id="index-xkey-1"></span>
<div class="format">
<pre class="format"><code>xkey</code> ( <i>&ndash; xc  </i>) xchar &ldquo;x-key&rdquo;
</pre></div>
<p>端末から xchar を 1 つ読み取ります。 これにより、xchar の読み取りが完了するまでのすべての入力イベントが破棄されます(訳注:
ヒストリ操作は効いたので…全ての入力イベント…?)。
</p>

<span id="index-xc_002dwidth-_0028--xc-_002d_002d-n--_0029-xchar_002dext"></span>
<span id="index-xc_002dwidth"></span>
<span id="index-xc_002dwidth-1"></span>
<div class="format">
<pre class="format"><code>xc-width</code> ( <i>xc &ndash; n  </i>) xchar-ext &ldquo;x-c-width&rdquo;
</pre></div>
<p><var>xc</var> の幅は、通常の固定幅グリフ(fixed-width glyph)の幅の <var>n</var> 倍です。
</p>

<span id="index-xhold-_0028--xc-_002d_002d--_0029-xchar_002dext"></span>
<span id="index-xhold"></span>
<span id="index-xhold-1"></span>
<div class="format">
<pre class="format"><code>xhold</code> ( <i>xc &ndash;  </i>) xchar-ext &ldquo;x-hold&rdquo;
</pre></div>
<p><code>&lt;&lt;#</code> と <code>#&gt;</code> の間で使用されます。 表示数値出力文字列(pictured numeric output
string)の前に <var>xc</var> を追加します。  代替手段としては <code>holds</code> を使用することができます。
</p>

<span id="index-xc_002c-_0028--xchar-_002d_002d--_0029-xchar"></span>
<span id="index-xc_002c"></span>
<span id="index-xc_002c-1"></span>
<div class="format">
<pre class="format"><code>xc,</code> ( <i>xchar &ndash;  </i>) xchar &ldquo;x-c-comma&rdquo;
</pre></div>


</div>
<hr>
<div class="header">
<p>
Next: <a href="i18n-and-l10n.html">国際化(I18n)とローカライズ</a>, Previous: <a href="Pipes.html">Pipes</a>, Up: <a href="Other-I_002fO.html">Other I/O</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Word-Index.html" title="Index" rel="index">Index</a>]</p>
</div>



</body>
</html>
