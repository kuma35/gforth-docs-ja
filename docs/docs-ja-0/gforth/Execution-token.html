<!DOCTYPE html>
<html>
<!-- Created by GNU Texinfo 7.1, https://www.gnu.org/software/texinfo/ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<!-- このマニュアルは、 標準 Forth 言語の高速で移植可能な実装である Gforth (バージョン 0.7.9_20240418,
April 18, 2024)用です。 これはリファレンス・マニュアルとして機能しますが、 Forth の概要と Forth
チュートリアルも含まれています。

Authors: Bernd Paysan, Anton Ertl, Gerald Wodni Copyright © 1995,
1996, 1997, 1998, 2000, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010,
2011, 2012, 2013, 2014,2015,2016,2017,2018,2019,2020,2021,2022,2023 Free
Software Foundation, Inc.

Permission is granted to copy, distribute and/or modify this document under
the terms of the GNU Free Documentation License, Version 1.1 or any later
version published by the Free Software Foundation; with no Invariant
Sections, with the Front-Cover texts being "A GNU Manual," and with the
Back-Cover Texts as in (a) below.  A copy of the license is included in the
section entitled "GNU Free Documentation License."

(a) The FSF's Back-Cover Text is: "You have freedom to copy and modify this
GNU Manual, like GNU software.  Copies published by the Free Software
Foundation raise funds for GNU development." -->
<title>Execution token (Gforth マニュアル)</title>

<meta name="description" content="Execution token (Gforth マニュアル)">
<meta name="keywords" content="Execution token (Gforth マニュアル)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<meta name="viewport" content="width=device-width,initial-scale=1">

<link href="index.html" rel="start" title="Top">
<link href="Word-Index.html" rel="index" title="Word Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Tokens-for-Words.html" rel="up" title="Tokens for Words">
<link href="Name-token.html" rel="next" title="Name token">
<link href="Tokens-for-Words.html" rel="prev" title="Tokens for Words">
<style type="text/css">
<!--
a.copiable-link {visibility: hidden; text-decoration: none; line-height: 0em}
div.example {margin-left: 3.2em}
pre.format-preformatted {font-family: inherit}
span:hover a.copiable-link {visibility: visible}
-->
</style>
<link rel="stylesheet" type="text/css" href="gforth.css">


</head>

<body lang="en">
<div class="subsection-level-extent" id="Execution-token">
<div class="nav-panel">
<p>
Next: <a href="Name-token.html" accesskey="n" rel="next">Name token</a>, Previous: <a href="Tokens-for-Words.html" accesskey="p" rel="prev">Tokens for Words</a>, Up: <a href="Tokens-for-Words.html" accesskey="u" rel="up">Tokens for Words</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Word-Index.html" title="Index" rel="index">Index</a>]</p>
</div>
<hr>
<h4 class="subsection" id="Execution-token-1"><span>6.12.1 Execution token<a class="copiable-link" href="#Execution-token-1"> &para;</a></span></h4>

<a class="index-entry-id" id="index-xt-1"></a>
<a class="index-entry-id" id="index-execution-token-1"></a>
<p>実行トークン(<em class="dfn">execution token</em>)(<i class="i">xt</i>)はワードの振る舞いを表します。  <code class="code">execute</code> を使用して
xt で表される振る舞いを呼び出すことができ、 そして、 <code class="code">compile,</code> (see <a class="pxref" href="Macros.html">Macros</a>)
を使用してそれを現在の定義にコンパイルできます。 その他の使用法としては、 defer された ワード(see <a class="pxref" href="Deferred-Words.html">Deferred Words</a>)
があります。
</p>
<p>特に、 ワードのインタープリター機能(interpretation semantics)(別名 実行機能(execution
semantics))を表す「実行トークン」(execution token)があります<a class="footnote" id="DOCF21" href="#FOOT21"><sup>21</sup></a>。
</p>
<a class="index-entry-id" id="index-prefix-_0060"></a>
<a class="index-entry-id" id="index-_0060-prefix"></a>
<p>名前付きワード <i class="i">x</i> の場合、
<code class="code">`<i class="i">x</i></code>(訳注:アポストロフィではなくてバックスラッシュ)を使用してその実行トークンを取得できます:
</p>
<div class="example">
<pre class="example-preformatted">5 `. ( n xt )
execute ( )      \ execute the xt (i.e., &quot;.&quot;)
: foo `. execute ;
5 foo
</pre></div>

<a class="index-entry-id" id="index-tick-_0028_0027_0029"></a>
<p>しかしながら、 <code class="code">`</code> プレフィックスは Gforth 拡張であるため、 以下の標準 Forth のワードを使用する方が好ましいです:
</p>
<a class="index-entry-id" id="index-_0027-_0028-_0022name_0022-_002d_002d-xt-_0029-core"></a>
<a class="index-entry-id" id="index-_0027"></a>
<a class="index-entry-id" id="index-_0027-1"></a>
<div class="format">
<pre class="format-preformatted"><code class="code">'</code> ( <i class="i">&quot;name&quot; &ndash; xt  </i>) core &ldquo;tick&rdquo;
</pre></div>
<p><i class="i">xt</i> は <i class="i">name</i> のインタープリター機能(interpretation semantics)を表します。
ワードにインタープリター機能が無い場合、 <code class="code">-14 throw</code> を実行します。
</p>

<a class="index-entry-id" id="index-_005b_0027_005d-_0028-compilation_002e-_0022name_0022-_002d_002d-_003b-run_002dtime_002e-_002d_002d-xt-_0029-core"></a>
<a class="index-entry-id" id="index-_005b_0027_005d"></a>
<a class="index-entry-id" id="index-_005b_0027_005d-1"></a>
<div class="format">
<pre class="format-preformatted"><code class="code">[']</code> ( <i class="i">compilation. &quot;name&quot; &ndash; ; run-time. &ndash; xt  </i>) core &ldquo;bracket-tick&rdquo;
</pre></div>
<p><i class="i">xt</i> は <i class="i">name</i> のインタープリター機能(interpretation semantics)を表します。
ワードにインタープリター機能が無い場合、 <code class="code">-14 throw</code> を実行します。
</p>


<p>これらはパース・ワード(parsing words)であるため(なお、 <code class="code">`<i class="i">x</i></code>
は認識器(recognizer)によってリテラルとして扱われます)、
通訳(interpret)されたりコンパイルされたコードの振る舞いが直感的ではない場合があります:
</p>
<div class="example">
<pre class="example-preformatted">5 ' .   ( n xt ) 
execute ( -- )      \ execute the xt of .
\ 以下は意図したとおりに動きません:
\ : foo ' . ;
\ 5 foo execute
\ その代わりに以下のようにします:
: foo ['] . ;
5 foo execute    \ execute the xt of .
\ コロン定義内で ' を使った場合:
: bar ' execute ;
5 bar .          \ execute the xt of .
\ 訳注: 一見普段と変わらないように見えるが、
\       テキスト・インタープリターが . を実行するのではなく、
\       bar が その後ろのワードの xt を execute している。
\       よって bar の後ろを省略すると下記のようにエラーとなる
5 bar 
*the terminal*:10:6: error: Attempt to use zero-length string as a name
5 bar&gt;&gt;&gt;&lt;&lt;&lt;
</pre></div>

<p><code class="code">'</code> は実行時にパースするため、 <code class="code">bar</code> のようにコロン定義に置くと、
コロン定義内の次のワードを消費せずに実行時に次のワードが消費されます。  <code class="code">`<i class="i">x</i></code> と書かずにリテラル xt
をコロン定義に入れたい場合は、 <code class="code">['] <i class="i">x</i></code> と書きます。
</p>
<p>Gforth の <code class="code">`<i class="i">x</i></code> や <code class="code">'</code> や <code class="code">[']</code> は、 compile-only
ワードで使用すると警告(warn)します。 そのような使用法が、 異なる Forth システム間で移植できない可能性があるためです。
</p>
<p>ワードの immediate のバリエーションを定義することで、 この警告(warning)と移植性の問題を回避できます。 例:
</p>
<div class="example">
<pre class="example-preformatted">: if postpone if ; immediate
: test [ ' if execute ] .&quot; test&quot; then ;
</pre></div>

<p>結果として得られる実行トークンが <code class="code">execute</code> されたときは、 <code class="code">if</code> のコンパイル機能(compilation
semantics)を実行します。
</p>
<p>xt を取得するもう一つ方法は、 <code class="code">:noname</code> または <code class="code">latestxt</code> です(see <a class="pxref" href="Anonymous-Definitions.html">Anonymous Definitions</a>)。  匿名のワードの場合、 <code class="code">:noname</code> または <code class="code">latestxt</code> により、
そのワードが持つ唯一の振る舞い(実行機能(execution semantics)) の xt が得られますが、 名前付きワードの定義の後ろで
<code class="code">latestxt</code> を使用して、 その xt を取得することもできます。
</p>
<div class="example">
<pre class="example-preformatted">:noname .&quot; hello&quot; ;
execute
</pre></div>

<p>xt は 1 つのセルを占有し、 他のセルと同様に操作できます。
</p>
<p>標準 Forth では、 xt は単なる抽象データ型です(つまり、 xt を生成または消費する操作によって定義されます)。 (Gforth 1.0
以降の)具体的な実装は、 ワードの本体アドレス(昔は PFA だった)です。 Gforth 0.7 以前では、 xt
はコード・フィールド・アドレス(CFA は PFA の 2 セル前)として実装されていました。
</p>
<a class="index-entry-id" id="index-execute-_0028-xt-_002d_002d-_0029-core"></a>
<a class="index-entry-id" id="index-execute"></a>
<a class="index-entry-id" id="index-execute-1"></a>
<div class="format">
<pre class="format-preformatted"><code class="code">execute</code> ( <i class="i">xt &ndash; </i>) core &ldquo;execute&rdquo;
</pre></div>
<p>実行トークン <i class="i">xt</i> によって表される機能(semantics)を実行します。
</p>
<a class="index-entry-id" id="index-execute_002dexit-_0028-compilation-_002d_002d-_003b-run_002dtime-xt-nest_002dsys-_002d_002d-_0029-gforth_002d1_002e0"></a>
<a class="index-entry-id" id="index-execute_002dexit"></a>
<a class="index-entry-id" id="index-execute_002dexit-1"></a>
<div class="format">
<pre class="format-preformatted"><code class="code">execute-exit</code> ( <i class="i">compilation &ndash; ; run-time xt nest-sys &ndash;  </i>) gforth-1.0 &ldquo;execute-exit&rdquo;
</pre></div>
<p><code class="code">xt</code> を実行し、 末尾呼び出し最適化法(tail-call-optimized way)で現在の定義から戻ります。 戻りアドレス
<code class="code">nest-sys</code> とローカル変数(local)は、 <code class="code">xt</code> を execute
する前に割り当て解除(deallocate)されます。
</p>

<a class="index-entry-id" id="index-perform-_0028-a_002daddr-_002d_002d-_0029-gforth_002d0_002e2"></a>
<a class="index-entry-id" id="index-perform"></a>
<a class="index-entry-id" id="index-perform-1"></a>
<div class="format">
<pre class="format-preformatted"><code class="code">perform</code> ( <i class="i">a-addr &ndash; </i>) gforth-0.2 &ldquo;perform&rdquo;
</pre></div>
<p><code class="code">@ execute</code>.
</p>

<p><code class="code">Noop</code> は、 しばしば実行トークンのプレースホルダーとして使用されます:
</p>
<a class="index-entry-id" id="index-noop-_0028-_002d_002d-_0029-gforth_002d0_002e2"></a>
<a class="index-entry-id" id="index-noop"></a>
<a class="index-entry-id" id="index-noop-1"></a>
<div class="format">
<pre class="format-preformatted"><code class="code">noop</code> ( <i class="i">&ndash; </i>) gforth-0.2 &ldquo;noop&rdquo;
</pre></div>



</div>
<div class="footnotes-segment">
<hr>
<h4 class="footnotes-heading">Footnotes</h4>

<h5 class="footnote-body-heading"><a id="FOOT21" href="#DOCF21">(21)</a></h5>
<p>標準 Forth には、
インタープリター機能(interpretation semantics)が未定義のワード(例: <code class="code">r@</code>)や、
定義された実行機能(execution semantics)が無いワード(例: <code class="code">s&quot;</code>)や、 およびそのどちらも持たないワード(例:
<code class="code">if</code>)があります。 ただし、 インタープリター機能(interpretation semantics)と実行機能(execution
semantics)の両方が定義されている場合、 それらは同一でであるため、 それらを同一のものとして扱います</p>
</div>
<hr>
<div class="nav-panel">
<p>
Next: <a href="Name-token.html">Name token</a>, Previous: <a href="Tokens-for-Words.html">Tokens for Words</a>, Up: <a href="Tokens-for-Words.html">Tokens for Words</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Word-Index.html" title="Index" rel="index">Index</a>]</p>
</div>



</body>
</html>
