<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!-- Created by GNU Texinfo 6.8, https://www.gnu.org/software/texinfo/ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<!-- このマニュアルは、 標準 Forth 言語の高速で移植可能な実装である Gforth (バージョン 0.7.9_20240418,
April 18, 2024)用です。 これはリファレンス・マニュアルとして機能しますが、 Forth の概要と Forth
チュートリアルも含まれています。

Authors: Bernd Paysan, Anton Ertl, Gerald Wodni Copyright (C) 1995,
1996, 1997, 1998, 2000, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010,
2011, 2012, 2013, 2014,2015,2016,2017,2018,2019,2020,2021,2022,2023 Free
Software Foundation, Inc.

Permission is granted to copy, distribute and/or modify this document under
the terms of the GNU Free Documentation License, Version 1.1 or any later
version published by the Free Software Foundation; with no Invariant
Sections, with the Front-Cover texts being "A GNU Manual," and with the
Back-Cover Texts as in (a) below.  A copy of the license is included in the
section entitled "GNU Free Documentation License."

(a) The FSF's Back-Cover Text is: "You have freedom to copy and modify this
GNU Manual, like GNU software.  Copies published by the Free Software
Foundation raise funds for GNU development." -->
<title>General control structures with CASE (Gforth マニュアル)</title>

<meta name="description" content="General control structures with CASE (Gforth マニュアル)">
<meta name="keywords" content="General control structures with CASE (Gforth マニュアル)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<meta name="viewport" content="width=device-width,initial-scale=1">

<link href="index.html" rel="start" title="Top">
<link href="Word-Index.html" rel="index" title="Word Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Control-Structures.html" rel="up" title="Control Structures">
<link href="Arbitrary-control-structures.html" rel="next" title="Arbitrary control structures">
<link href="BEGIN-loops-with-multiple-exits.html" rel="prev" title="BEGIN loops with multiple exits">
<style type="text/css">
<!--
a.copiable-anchor {visibility: hidden; text-decoration: none; line-height: 0em}
a.summary-letter {text-decoration: none}
blockquote.indentedblock {margin-right: 0em}
div.display {margin-left: 3.2em}
div.example {margin-left: 3.2em}
kbd {font-style: oblique}
pre.display {font-family: inherit}
pre.format {font-family: inherit}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
span.nolinebreak {white-space: nowrap}
span.roman {font-family: initial; font-weight: normal}
span.sansserif {font-family: sans-serif; font-weight: normal}
span:hover a.copiable-anchor {visibility: visible}
ul.no-bullet {list-style: none}
-->
</style>
<link rel="stylesheet" type="text/css" href="gforth.css">


</head>

<body lang="en">
<div class="subsection" id="General-control-structures-with-CASE">
<div class="header">
<p>
Next: <a href="Arbitrary-control-structures.html" accesskey="n" rel="next">Arbitrary control structures</a>, Previous: <a href="BEGIN-loops-with-multiple-exits.html" accesskey="p" rel="prev"><code>Begin</code> loops with multiple exits</a>, Up: <a href="Control-Structures.html" accesskey="u" rel="up">Control Structures</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Word-Index.html" title="Index" rel="index">Index</a>]</p>
</div>
<hr>
<span id="General-control-structures-with-case"></span><h4 class="subsection">6.9.5 General control structures with <code>case</code></h4>
<span id="index-case-as-generalized-control-structure"></span>
<span id="index-general-control-structures-_0028case_0029"></span>

<p>Gforth は、 拡張 <code>case</code> を提供することで、 上で説明した複数出口ループの問題を解決する追加のオプションを提供します。 この拡張
<code>case</code> の移植可能な実装は <samp>compat/caseext.fs</samp> にあります。
</p>
<p>この拡張には 3 つの追加ワードがあります。  1 つ目は <code>?of</code> で、 <code>case</code>
内で(単なる同等性のテストではなく、)一般的なテストが可能です。 例:
</p>
<div class="example">
<pre class="example">: sgn ( n -- -1|0|1 )
  ( n ) case
    dup 0 &lt; ?of drop -1 endof
    dup 0 &gt; ?of drop 1  endof
    \ otherwise leave the 0 on the stack
  0 endcase ;
</pre></div>

<p>注意: <code>endcase</code> は値(a value)を drop することに注意してください。 これは <code>of</code>
ではほとんどうまいこと機能しますが、 <code>?of</code> ではたいていうまいこといかないので、 今回も <code>endcase</code> で drop
するための値として 0 をスタック置きます。  ここでは、 <code>sgn</code> に渡される n は、 いずれの <code>?of</code>
もトリガーしない場合返り値の 0 そのものになります。
</p>
<p>2 番目の追加ワードは <code>next-case</code> で、 これにより <code>case</code> をループに変えることができます。
出口が3つのループは以下のようになります:
</p>
<div class="example">
<pre class="example">case
  condition1 ?of exit-code1 endof
  condition2 ?of exit-code2 endof
  condition3 ?of exit-code3 endof
  ...
next-case
common code afterwards
</pre></div>

<p>ご覧のとおり、 これにより、 先程議論したバリエーションの両方の問題が解決されます(see <a href="BEGIN-loops-with-multiple-exits.html"><code>Begin</code> loops with multiple exits</a>)。 注意: <code>endcase</code> とは異なり、 <code>next-case</code> は値をドロップしないことに注意してください。
<a id="DOCF13" href="#FOOT13"><sup>13</sup></a>
</p>
<p>最後の追加ワードは <code>contof</code> です。 これは <code>endof</code> の代わりに使用され、
ループを終了する代わりに次の反復を開始します。 これは、 ダイクストラのガード付きコマンド 繰り返し: <i>do</i> と同様の方法で使用できます。 例:
</p>
<div class="example">
<pre class="example">: gcd ( n1 n2 -- n )
    case
        2dup &gt; ?of tuck - contof
        2dup &lt; ?of over - contof
    endcase ;
</pre></div>

<p>ここで、 2 つの <code>?of</code> はループを継続する異なる方法を持っています。 どちらの <code>?of</code> もトリガーされない場合、 2
つの数値は等しく、gcd(最大公約数) になります。  <code>Endcase</code> はそれらの 1 つを削除し、もう 1 つは n として残します。
</p>
<p>これらのワードを組み合わせることもできます。  以下は、 <code>endcase</code> を除く、 各 <code>case</code> ワードをそれぞれ 1
回使用する例です:
</p>
<div class="example">
<pre class="example">: collatz ( u -- )
    \ print the 3n+1 sequence starting at u until we reach 1
    case
        dup .
        1 of endof
        dup 1 and ?of 3 * 1+ contof
        2/
    next-case ;
</pre></div>

<p>この例では、 シーケンスの現在の値をスタックに保持します。  1 の場合、 <code>of</code> がトリガーされ、 値が削除され、 <code>case</code>
構造から去ります。 奇数の場合、 <code>?of</code> がトリガーされ、 3n+1 が計算され、 <code>contof</code> で次の反復が開始されます。
それ以外の場合、 数値が偶数の場合は 2 で除算され、 <code>next-case</code> でループが再開されます。
</p>
</div>
<div class="footnote">
<hr>
<h4 class="footnotes-heading">Footnotes</h4>

<h5><a id="FOOT13" href="#DOCF13">(13)</a></h5>
<p><code>next-case</code> は、 他の <code>case</code> ワード群とは異なり、
名前にハイフン(<code>-</code>)が含まれています。 VFX Forth には値をドロップする <code>nextcase</code>
があるので、これと区別するためです。</p>
</div>
<hr>
<div class="header">
<p>
Next: <a href="Arbitrary-control-structures.html">Arbitrary control structures</a>, Previous: <a href="BEGIN-loops-with-multiple-exits.html"><code>Begin</code> loops with multiple exits</a>, Up: <a href="Control-Structures.html">Control Structures</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Word-Index.html" title="Index" rel="index">Index</a>]</p>
</div>



</body>
</html>
