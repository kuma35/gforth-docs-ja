<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!-- Created by GNU Texinfo 6.8, https://www.gnu.org/software/texinfo/ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<!-- このマニュアルは、 標準 Forth 言語の高速で移植可能な実装である Gforth (バージョン 0.7.9_20240418,
April 18, 2024)用です。 これはリファレンス・マニュアルとして機能しますが、 Forth の概要と Forth
チュートリアルも含まれています。

Authors: Bernd Paysan, Anton Ertl, Gerald Wodni Copyright (C) 1995,
1996, 1997, 1998, 2000, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010,
2011, 2012, 2013, 2014,2015,2016,2017,2018,2019,2020,2021,2022,2023 Free
Software Foundation, Inc.

Permission is granted to copy, distribute and/or modify this document under
the terms of the GNU Free Documentation License, Version 1.1 or any later
version published by the Free Software Foundation; with no Invariant
Sections, with the Front-Cover texts being "A GNU Manual," and with the
Back-Cover Texts as in (a) below.  A copy of the license is included in the
section entitled "GNU Free Documentation License."

(a) The FSF's Back-Cover Text is: "You have freedom to copy and modify this
GNU Manual, like GNU software.  Copies published by the Free Software
Foundation raise funds for GNU development." -->
<title>Execution Tokens Tutorial (Gforth マニュアル)</title>

<meta name="description" content="Execution Tokens Tutorial (Gforth マニュアル)">
<meta name="keywords" content="Execution Tokens Tutorial (Gforth マニュアル)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<meta name="viewport" content="width=device-width,initial-scale=1">

<link href="index.html" rel="start" title="Top">
<link href="Word-Index.html" rel="index" title="Word Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Tutorial.html" rel="up" title="Tutorial">
<link href="Exceptions-Tutorial.html" rel="next" title="Exceptions Tutorial">
<link href="Interpretation-and-Compilation-Semantics-and-Immediacy-Tutorial.html" rel="prev" title="Interpretation and Compilation Semantics and Immediacy Tutorial">
<style type="text/css">
<!--
a.copiable-anchor {visibility: hidden; text-decoration: none; line-height: 0em}
a.summary-letter {text-decoration: none}
blockquote.indentedblock {margin-right: 0em}
div.display {margin-left: 3.2em}
div.example {margin-left: 3.2em}
kbd {font-style: oblique}
pre.display {font-family: inherit}
pre.format {font-family: inherit}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
span.nolinebreak {white-space: nowrap}
span.roman {font-family: initial; font-weight: normal}
span.sansserif {font-family: sans-serif; font-weight: normal}
span:hover a.copiable-anchor {visibility: visible}
ul.no-bullet {list-style: none}
-->
</style>
<link rel="stylesheet" type="text/css" href="gforth.css">


</head>

<body lang="en">
<div class="section" id="Execution-Tokens-Tutorial">
<div class="header">
<p>
Next: <a href="Exceptions-Tutorial.html" accesskey="n" rel="next">Exceptions</a>, Previous: <a href="Interpretation-and-Compilation-Semantics-and-Immediacy-Tutorial.html" accesskey="p" rel="prev">Interpretation and Compilation Semantics and Immediacy</a>, Up: <a href="Tutorial.html" accesskey="u" rel="up">Forth Tutorial</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Word-Index.html" title="Index" rel="index">Index</a>]</p>
</div>
<hr>
<span id="Execution-Tokens"></span><h3 class="section">3.29 Execution Tokens</h3>
<span id="index-execution-tokens-tutorial"></span>
<span id="index-XT-tutorial"></span>

<p><code>' word</code> は、 ワードの実行トークン(execution token)(XT)を提供します。 XT は、
ワードのインタプリタ機能(interpretation semantics)表すセルです。 これは <code>execute</code> で実行できます:
</p>
<div class="example">
<pre class="example">' + .s
1 2 rot execute .
</pre></div>

<p>XT は C の関数ポインタに似ています。 ただし、 パラメータがスタックで渡されるため、もう少し柔軟になります:
</p>
<div class="example">
<pre class="example">: map-array ( ... addr u xt -- ... )
\ addr で始まり u 個の要素を含む配列のすべての要素に対して
\ xt ( ... x -- ... ) を実行します
  { xt }
  cells over + swap ?do
    i @ xt execute
  1 cells +loop ;

create a 3 , 4 , 2 , -1 , 4 ,
a 5 ' . map-array .s
0 a 5 ' + map-array .

s&quot; max-n&quot; environment? drop .s \ 下記比較初期値用に整数最大値を得る
a 5 ' min map-array . \ 最初の要素は、 environment? で取得した整数最大値と比較
</pre></div>

<p>生成するより消費する要素が 1 つ多いワードの XT に対して map-array を使用できます。 理論的には、他の XT でも使用できますが、
スタック効果は配列のサイズに依存するため、理解するのが困難です。
</p>
<p>XT はセルサイズであるため、 メモリに保存し、 他のセルと同様にスタック上で操作できます。 <code>compile,</code> を使用して XT
をワードにコンパイルすることもできます:
</p>
<div class="example">
<pre class="example">: foo1 ( n1 n2 -- n )
   [ ' + compile, ] ;
see foo1
</pre></div>

<p><code>compile,</code> は標準ではコンパイル機能(compilation semantics)がないため、 上記は標準ではないけれども、 良い
Forth システムでは動作します。 うまくいかなかったモノついては、 以下を使用してください
</p>
<div class="example">
<pre class="example">: [compile,] compile, ; immediate

: foo1 ( n1 n2 -- n )
   [ ' + ] [compile,] ;
see foo1
</pre></div>

<p><code>'</code> は、 デフォルトでコンパイル機能(compilation semantics)を持つワードです。
そのワードのインタプリタ機能(interpretation semantics)を実行すると、 その次のワードを構文解析(parse)します。
</p>
<div class="example">
<pre class="example">: foo ( -- xt )
  ' ;
see foo
: bar ( ... &quot;word&quot; -- ... )
  ' execute ;
see bar
1 2 bar + .
</pre></div>

<p>コンパイル中にワードを解析(parse)し、 その XT をコンパイルして、 実行時にスタックにプッシュされるようにしたいことがよくあります。
<code>[']</code> はこれを行います:
</p>
<div class="example">
<pre class="example">: xt-+ ( -- xt )
  ['] + ;
see xt-+
1 2 xt-+ execute .
</pre></div>

<p>多くのプログラマーは、 <code>'</code> とそれが解析(parse)するワードを 1 つの単位として認識し、 コンパイル時に <code>[']</code>
のように動作することを期待し、 実際の動作に混乱する傾向があります。 あなたがもしそうなら、 Forth システムは <code>'</code> を 1
つの単位として捉えているだけであり、
それが解析(parse)ワードであるとはまったく考えていないことを覚えておいてください(この問題でプログラマーの便宜を図る試みは、 通常、
さらにひどい落とし穴につながります。
<a href="https://www.complang.tuwien.ac.at/papers/ertl98.ps.gz"><code>State</code>-smartness&mdash;Why it is evil and How to Exorcise it</a>)。
</p>
<p>XT の作成および実行は、 インタプリタの状態には影響を受けないことに注意してください。 つまり、 コンパイル状態で <code>'</code>
を実行した場合でも、 インタプリタ機能(interpretation semantics)が得られます。 そして、 そこでの状態が何であれ、
<code>execute</code> は XT によって表されるコード(つまり、<code>'</code> で生成された XT
の場合はインタプリタ機能(interpretation semantics))を実行します。
</p>
<p>こちらも参照ください: <a href="Tokens-for-Words.html">Tokens for Words</a>
</p>

</div>



</body>
</html>
