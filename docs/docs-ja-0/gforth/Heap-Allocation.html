<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!-- Created by GNU Texinfo 6.8, https://www.gnu.org/software/texinfo/ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<!-- このマニュアルは、 標準 Forth 言語の高速で移植可能な実装である Gforth (バージョン 0.7.9_20240418,
April 18, 2024)用です。 これはリファレンス・マニュアルとして機能しますが、 Forth の概要と Forth
チュートリアルも含まれています。

Authors: Bernd Paysan, Anton Ertl, Gerald Wodni Copyright (C) 1995,
1996, 1997, 1998, 2000, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010,
2011, 2012, 2013, 2014,2015,2016,2017,2018,2019,2020,2021,2022,2023 Free
Software Foundation, Inc.

Permission is granted to copy, distribute and/or modify this document under
the terms of the GNU Free Documentation License, Version 1.1 or any later
version published by the Free Software Foundation; with no Invariant
Sections, with the Front-Cover texts being "A GNU Manual," and with the
Back-Cover Texts as in (a) below.  A copy of the license is included in the
section entitled "GNU Free Documentation License."

(a) The FSF's Back-Cover Text is: "You have freedom to copy and modify this
GNU Manual, like GNU software.  Copies published by the Free Software
Foundation raise funds for GNU development." -->
<title>Heap Allocation (Gforth マニュアル)</title>

<meta name="description" content="Heap Allocation (Gforth マニュアル)">
<meta name="keywords" content="Heap Allocation (Gforth マニュアル)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<meta name="viewport" content="width=device-width,initial-scale=1">

<link href="index.html" rel="start" title="Top">
<link href="Word-Index.html" rel="index" title="Word Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Memory.html" rel="up" title="Memory">
<link href="Memory-Access.html" rel="next" title="Memory Access">
<link href="Dictionary-allocation.html" rel="prev" title="Dictionary allocation">
<style type="text/css">
<!--
a.copiable-anchor {visibility: hidden; text-decoration: none; line-height: 0em}
a.summary-letter {text-decoration: none}
blockquote.indentedblock {margin-right: 0em}
div.display {margin-left: 3.2em}
div.example {margin-left: 3.2em}
kbd {font-style: oblique}
pre.display {font-family: inherit}
pre.format {font-family: inherit}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
span.nolinebreak {white-space: nowrap}
span.roman {font-family: initial; font-weight: normal}
span.sansserif {font-family: sans-serif; font-weight: normal}
span:hover a.copiable-anchor {visibility: visible}
ul.no-bullet {list-style: none}
-->
</style>
<link rel="stylesheet" type="text/css" href="gforth.css">


</head>

<body lang="en">
<div class="subsection" id="Heap-Allocation">
<div class="header">
<p>
Next: <a href="Memory-Access.html" accesskey="n" rel="next">Memory Access</a>, Previous: <a href="Dictionary-allocation.html" accesskey="p" rel="prev">Dictionary allocation</a>, Up: <a href="Memory.html" accesskey="u" rel="up">Memory</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Word-Index.html" title="Index" rel="index">Index</a>]</p>
</div>
<hr>
<span id="Heap-allocation"></span><h4 class="subsection">6.7.3 Heap allocation</h4>
<span id="index-heap-allocation"></span>
<span id="index-dynamic-allocation-of-memory"></span>
<span id="index-memory_002dallocation-word-set"></span>

<span id="index-contiguous-regions-and-heap-allocation"></span>
<p>ヒープ割り当ては、 割り当てられたメモリの割り当て解除を任意の順序でサポートします。 ディクショナリの割り当ては影響を受けません(つまり、
連続領域(contiguous region)は終了しません)。 Gforth では、 これらのワードは標準の C ライブラリ呼び出しである
malloc() や free() や realloc() を使用して実装されます。
</p>
<p><code>allocate</code> または <code>resize</code> の 1 回の呼び出しによって生成されるメモリ領域は、 内部的に連続しています。
このような領域と他の領域(ヒープから割り当てられた他の領域を含む)との間には連続性はありません。
</p>
<span id="index-allocate-_0028--u-_002d_002d-a_005faddr-wior--_0029-memory"></span>
<span id="index-allocate"></span>
<span id="index-allocate-1"></span>
<div class="format">
<pre class="format"><code>allocate</code> ( <i>u &ndash; a_addr wior  </i>) memory &ldquo;allocate&rdquo;
</pre></div>
<p>連続したデータ空間を <i>u</i> アドレス単位分割り当てます。 データ空間の初期内容は未定義です。 割り当てが成功した場合、 <i>a-addr</i>
は割り当てられた領域の開始アドレスで、 <i>wior</i> は 0 になります。 割り当てが失敗した場合、 <i>a-addr</i> は未定義で、
<i>wior</i> ゼロ以外の I/O 結果コードです。
</p>

<span id="index-free-_0028--a_005faddr-_002d_002d-wior--_0029-memory"></span>
<span id="index-free"></span>
<span id="index-free-1"></span>
<div class="format">
<pre class="format"><code>free</code> ( <i>a_addr &ndash; wior  </i>) memory &ldquo;free&rdquo;
</pre></div>
<p><i>a-addr</i> で始まるデータ空間の領域をシステムに返します。  領域は元々 <code>allocate</code> または <code>resize</code>
を使用して取得されている必要があります。 操作が成功した場合、 <i>wior</i> は 0 になります。 操作が失敗した場合、 <i>wior</i>
はゼロ以外の I/O 結果コードになります。
</p>

<span id="index-resize-_0028--a_005faddr1-u-_002d_002d-a_005faddr2-wior--_0029-memory"></span>
<span id="index-resize"></span>
<span id="index-resize-1"></span>
<div class="format">
<pre class="format"><code>resize</code> ( <i>a_addr1 u &ndash; a_addr2 wior  </i>) memory &ldquo;resize&rdquo;
</pre></div>
<p><i>a-addr1</i> に割り当てられた領域のサイズを <i>u</i> アドレス単位に変更します。 但し内容を別の領域に移動する可能性があります。
<i>a-addr2</i> は、 結果の領域のアドレスです。  操作が成功した場合、 <i>wior</i> は 0 になります。 操作が失敗した場合、
<i>wior</i> はゼロ以外の I/O 結果コードになります。 <i>a-addr1</i> が 0 の場合、 Gforth の (非標準の )
<code>resize</code> は <i>u</i> アドレス単位の割り当てを行います。
</p>


<p>以下のワード達はメモリ・ブロックを扱うのに役立ちます:
</p>
<span id="index-save_002dmem-_0028--addr1-u-_002d_002d-addr2-u--_0029-gforth_002d0_002e2"></span>
<span id="index-save_002dmem"></span>
<span id="index-save_002dmem-1"></span>
<div class="format">
<pre class="format"><code>save-mem</code> ( <i>addr1 u &ndash; addr2 u  </i>) gforth-0.2 &ldquo;save-mem&rdquo;
</pre></div>
<p>指定のメモリ・ブロックをヒープ内で新しく割り当てられた領域にコピーします。
</p>

<span id="index-free_002dmem_002dvar-_0028--addr-_002d_002d--_0029-gforth_002dexperimental"></span>
<span id="index-free_002dmem_002dvar"></span>
<span id="index-free_002dmem_002dvar-1"></span>
<div class="format">
<pre class="format"><code>free-mem-var</code> ( <i>addr &ndash;  </i>) gforth-experimental &ldquo;free-mem-var&rdquo;
</pre></div>
<p>addr は、 メモリ範囲のアドレスとサイズを含む 2variable のアドレスです。 これはメモリを解放し、 2variable をクリアします。
</p>

<span id="index-extend_002dmem-_0028--addr1-u1-u-_002d_002d-addr-addr2-u2--_0029-gforth_002dexperimental"></span>
<span id="index-extend_002dmem"></span>
<span id="index-extend_002dmem-1"></span>
<div class="format">
<pre class="format"><code>extend-mem</code> ( <i>addr1 u1 u &ndash; addr addr2 u2  </i>) gforth-experimental &ldquo;extend-mem&rdquo;
</pre></div>
<p>u (アドレス単位)によってヒープから割り当てられたメモリ・ブロック addr1 u1 を拡張します。  (おそらく再割り当てされた)開始アドレスは
addr2 で、 その合計長さは u2 で、 拡張部分の開始アドレスは addr です(訳注: 例えば元々長さ10のブロックを5拡張すると( addr1
10 5 &ndash; addr2+10 addr2 10+5))
</p>



<p>$tring ワード群は、 メモリ・ブロックの処理にも使用できます。 See <a href="_0024tring-words.html">$tring words</a> (訳注: $tring (ダラー
tring)と String (エス string) とあることに注意)
</p>
<p>拡張可能なメモリ・バッファの場合は、 $trings または以下のワード群を使用できます。  <code>adjust-buffer</code>
で管理されるバッファに割り当てられたメモリは縮小できないため、
これまでに確認された最大サイズよりも小さいサイズにバッファを調整(adjust)するときはヒープ管理のオーバーヘッドは発生しません。
</p>
<span id="index-buffer_0025-_0028-_002d_002d-u1-u2--_0029-gforth_002dexperimental"></span>
<span id="index-buffer_0025"></span>
<span id="index-buffer_0025-1"></span>
<div class="format">
<pre class="format"><code>buffer%</code> ( <i>&ndash; u1 u2  </i>) gforth-experimental &ldquo;buffer%&rdquo;
</pre></div>
<p><i>u1</i> は アライメント(alignment)、 <i>u2</i> は バッファ・デスクリプタのサイズです。
</p>

<span id="index-init_002dbuffer-_0028--addr-_002d_002d--_0029-gforth_002dexperimental"></span>
<span id="index-init_002dbuffer"></span>
<span id="index-init_002dbuffer-1"></span>
<div class="format">
<pre class="format"><code>init-buffer</code> ( <i>addr &ndash;  </i>) gforth-experimental &ldquo;init-buffer&rdquo;
</pre></div>

<span id="index-adjust_002dbuffer-_0028--u-addr-_002d_002d--_0029-gforth_002dexperimental"></span>
<span id="index-adjust_002dbuffer"></span>
<span id="index-adjust_002dbuffer-1"></span>
<div class="format">
<pre class="format"><code>adjust-buffer</code> ( <i>u addr &ndash;  </i>) gforth-experimental &ldquo;adjust-buffer&rdquo;
</pre></div>
<p>addr の buffer% を長さ u に調整します。 これにより、 割り当てられた領域が拡大する可能性がありますが、
決して縮小されることはありません。
</p>


<p><code>2@</code> を使用すると、 このようなバッファの現在のアドレスと長さを取得できます。
</p>
<p>典型的な使い方:
</p>
<div class="example">
<pre class="example">create mybuf  buffer% %size allot  mybuf init-buffer
s&quot; frobnicate&quot; mybuf adjust-buffer  mybuf 2@ move
mybuf 2@ type
s&quot; foo&quot;        mybuf adjust-buffer  mybuf 2@ move
mybuf 2@ type
</pre></div>


</div>
<hr>
<div class="header">
<p>
Next: <a href="Memory-Access.html">Memory Access</a>, Previous: <a href="Dictionary-allocation.html">Dictionary allocation</a>, Up: <a href="Memory.html">Memory</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Word-Index.html" title="Index" rel="index">Index</a>]</p>
</div>



</body>
</html>
