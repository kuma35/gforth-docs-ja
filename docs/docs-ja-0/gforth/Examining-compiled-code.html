<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!-- Created by GNU Texinfo 6.8, https://www.gnu.org/software/texinfo/ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<!-- このマニュアルは、 標準 Forth 言語の高速で移植可能な実装である Gforth (バージョン 0.7.9_20240418,
April 18, 2024)用です。 これはリファレンス・マニュアルとして機能しますが、 Forth の概要と Forth
チュートリアルも含まれています。

Authors: Bernd Paysan, Anton Ertl, Gerald Wodni Copyright (C) 1995,
1996, 1997, 1998, 2000, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010,
2011, 2012, 2013, 2014,2015,2016,2017,2018,2019,2020,2021,2022,2023 Free
Software Foundation, Inc.

Permission is granted to copy, distribute and/or modify this document under
the terms of the GNU Free Documentation License, Version 1.1 or any later
version published by the Free Software Foundation; with no Invariant
Sections, with the Front-Cover texts being "A GNU Manual," and with the
Back-Cover Texts as in (a) below.  A copy of the license is included in the
section entitled "GNU Free Documentation License."

(a) The FSF's Back-Cover Text is: "You have freedom to copy and modify this
GNU Manual, like GNU software.  Copies published by the Free Software
Foundation raise funds for GNU development." -->
<title>Examining compiled code (Gforth マニュアル)</title>

<meta name="description" content="Examining compiled code (Gforth マニュアル)">
<meta name="keywords" content="Examining compiled code (Gforth マニュアル)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<meta name="viewport" content="width=device-width,initial-scale=1">

<link href="index.html" rel="start" title="Top">
<link href="Word-Index.html" rel="index" title="Word Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Programming-Tools.html" rel="up" title="Programming Tools">
<link href="Examining-data.html" rel="next" title="Examining data">
<link href="Locating-exception-source.html" rel="prev" title="Locating exception source">
<style type="text/css">
<!--
a.copiable-anchor {visibility: hidden; text-decoration: none; line-height: 0em}
a.summary-letter {text-decoration: none}
blockquote.indentedblock {margin-right: 0em}
div.display {margin-left: 3.2em}
div.example {margin-left: 3.2em}
kbd {font-style: oblique}
pre.display {font-family: inherit}
pre.format {font-family: inherit}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
span.nolinebreak {white-space: nowrap}
span.roman {font-family: initial; font-weight: normal}
span.sansserif {font-family: sans-serif; font-weight: normal}
span:hover a.copiable-anchor {visibility: visible}
ul.no-bullet {list-style: none}
-->
</style>
<link rel="stylesheet" type="text/css" href="gforth.css">


</head>

<body lang="en">
<div class="subsection" id="Examining-compiled-code">
<div class="header">
<p>
Next: <a href="Examining-data.html" accesskey="n" rel="next">Examining data and code</a>, Previous: <a href="Locating-exception-source.html" accesskey="p" rel="prev">Locating exception source</a>, Up: <a href="Programming-Tools.html" accesskey="u" rel="up">Programming Tools</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Word-Index.html" title="Index" rel="index">Index</a>]</p>
</div>
<hr>
<span id="Examining-compiled-code-1"></span><h4 class="subsection">6.26.4 Examining compiled code</h4>
<span id="index-compiled-code-examination"></span>

<p>And finally, <code>see</code> and friends show compiled code.  Some of the things
in the source code are not present in the compiled code (e.g., formatting
and comments), but this is useful to see what threaded code or native code
is produced by macros and Gforth&rsquo;s optimization features.
</p>
<span id="index-see-_0028--_0022_003cspaces_003ename_0022-_002d_002d--_0029-tools"></span>
<span id="index-see"></span>
<span id="index-see-1"></span>
<div class="format">
<pre class="format"><code>see</code> ( <i>&quot;&lt;spaces&gt;name&quot; &ndash;  </i>) tools &ldquo;see&rdquo;
</pre></div>
<p>Locate <var>name</var> using the current search order. Display the definition of
<var>name</var>. Since this is achieved by decompiling the definition, the
formatting is mechanised and some source information (comments, interpreted
sequences within definitions etc.) is lost.
</p>

<span id="index-xt_002dsee-_0028--xt-_002d_002d--_0029-gforth_002d0_002e2"></span>
<span id="index-xt_002dsee"></span>
<span id="index-xt_002dsee-1"></span>
<div class="format">
<pre class="format"><code>xt-see</code> ( <i>xt &ndash;  </i>) gforth-0.2 &ldquo;xt-see&rdquo;
</pre></div>
<p>Decompile the definition represented by <i>xt</i>.
</p>

<span id="index-simple_002dsee-_0028--_0022name_0022-_002d_002d--_0029-gforth_002d0_002e6"></span>
<span id="index-simple_002dsee"></span>
<span id="index-simple_002dsee-1"></span>
<div class="format">
<pre class="format"><code>simple-see</code> ( <i>&quot;name&quot; &ndash;  </i>) gforth-0.6 &ldquo;simple-see&rdquo;
</pre></div>
<p>Decompile the colon definition <i>name</i>, showing a line for each cell, and
try to guess a meaning for the cell, and show that.
</p>

<span id="index-xt_002dsimple_002dsee-_0028--xt-_002d_002d--_0029-gforth_002d1_002e0"></span>
<span id="index-xt_002dsimple_002dsee"></span>
<span id="index-xt_002dsimple_002dsee-1"></span>
<div class="format">
<pre class="format"><code>xt-simple-see</code> ( <i>xt &ndash;  </i>) gforth-1.0 &ldquo;xt-simple-see&rdquo;
</pre></div>
<p>Decompile the colon definition <i>xt</i> like <code>simple-see</code>
</p>

<span id="index-simple_002dsee_002drange-_0028--addr1-addr2-_002d_002d--_0029-gforth_002d0_002e6"></span>
<span id="index-simple_002dsee_002drange"></span>
<span id="index-simple_002dsee_002drange-1"></span>
<div class="format">
<pre class="format"><code>simple-see-range</code> ( <i>addr1 addr2 &ndash;  </i>) gforth-0.6 &ldquo;simple-see-range&rdquo;
</pre></div>
<p>Decompile code in [<i>addr1</i>,<i>addr2</i>) like <code>simple-see</code>
</p>

<span id="index-see_002dcode-_0028--_0022name_0022-_002d_002d--_0029-gforth_002d0_002e7"></span>
<span id="index-see_002dcode"></span>
<span id="index-see_002dcode-1"></span>
<div class="format">
<pre class="format"><code>see-code</code> ( <i>&quot;name&quot; &ndash;  </i>) gforth-0.7 &ldquo;see-code&rdquo;
</pre></div>
<p>Like <code>simple-see</code>, but also shows the dynamic native code for the
inlined primitives.  For static superinstructions, it shows the primitive
sequence instead of the first primitive (the other primitives of the
superinstruction are shown, too).  For primitives for which native code is
generated, it shows the number of stack items in registers at the beginning
and at the end (e.g., <code>1-&gt;1</code> means 1 stack item is in a register at the
start and at the end).  For each primitive or superinstruction with native
code, the inline arguments and component primitives are shown first, then
the native code.
</p>

<span id="index-xt_002dsee_002dcode-_0028--xt-_002d_002d--_0029-gforth_002d1_002e0"></span>
<span id="index-xt_002dsee_002dcode"></span>
<span id="index-xt_002dsee_002dcode-1"></span>
<div class="format">
<pre class="format"><code>xt-see-code</code> ( <i>xt &ndash;  </i>) gforth-1.0 &ldquo;xt-see-code&rdquo;
</pre></div>
<p>Decompile the colon definition <i>xt</i> like <code>see-code</code>.
</p>

<span id="index-see_002dcode_002drange-_0028--addr1-addr2-_002d_002d--_0029-gforth_002d0_002e7"></span>
<span id="index-see_002dcode_002drange"></span>
<span id="index-see_002dcode_002drange-1"></span>
<div class="format">
<pre class="format"><code>see-code-range</code> ( <i>addr1 addr2 &ndash;  </i>) gforth-0.7 &ldquo;see-code-range&rdquo;
</pre></div>
<p>Decompile code in [<i>addr1</i>,<i>addr2</i>) like <code>see-code</code>.
</p>


<p>As an example, consider:
</p>
<div class="example">
<pre class="example">: foo x f@ fsin drop over ;
</pre></div>

<p>This is not particularly useful, but it demonstrates the various code
generation differences.  Compiling this on <code>gforth-fast</code> on AMD64 and
then using <code>see-code foo</code> outputs:
</p>
<div class="example">
<pre class="example">$7FD0CEE8C510 lit f@     1-&gt;1 
$7FD0CEE8C518 x
$7FD0CEE8C520 f@
7FD0CEB51697:   movsd   [r12],xmm15
7FD0CEB5169D:   mov     rax,$00[r13]
7FD0CEB516A1:   sub     r12,$08
7FD0CEB516A5:   add     r13,$18
7FD0CEB516A9:   movsd   xmm15,[rax]
7FD0CEB516AE:   mov     rcx,-$08[r13]
7FD0CEB516B2:   jmp     ecx
$7FD0CEE8C528 fsin
$7FD0CEE8C530 drop    1-&gt;0 
7FD0CEB516B4:   add     r13,$08
$7FD0CEE8C538 over    0-&gt;1 
7FD0CEB516B8:   mov     r8,$10[r15]
7FD0CEB516BC:   add     r13,$08
$7FD0CEE8C540 ;s    1-&gt;1 
7FD0CEB516C0:   mov     r10,[rbx]
7FD0CEB516C3:   add     rbx,$08
7FD0CEB516C7:   lea     r13,$08[r10]
7FD0CEB516CB:   mov     rcx,-$08[r13]
7FD0CEB516CF:   jmp     ecx
</pre></div>

<p>First, you see a threaded-code cell for a static superinstruction with the
components <code>lit</code> and <code>f@</code>, starting and ending with one data
stack item in a register (<code>1-&gt;1</code>); this is followed by the cell for the
argument <code>x</code> of <code>lit</code>, and the cell for the <code>f@</code> component
of the superinstruction; the latter cell is not used, but is there for
Gforth-internal reasons.
</p>
<p>Next, the dynamically generated native code for the superinstruction
<code>lit f@</code> is shown; note that this native code is not mixed with the
threaded code in memory, as you can see by comparing the addresses.
</p>
<p>If you want to understand the native code shown here: the threaded-code
instruction pointer is in <code>r13</code>, the data stack pointer in <code>r15</code>;
the first data stack register is <code>r8</code> (i.e., the top of stack resides
there if there is one data stack item in a register); the return stack
pointer is in <code>rbx</code>, the FP stack pointer in <code>r12</code>, and the top of
the floating-pont stack in <code>xmm15</code>.  Note that the register assignments
vary between engines, so you may see a different register assignment for
this code.
</p>
<p>The dynamic native code for <code>lit f@</code> ends with a dispatch jump (aka
NEXT), because the code for the next word <code>fsin</code> in the definition is
not dynamically generated.
</p>
<p>Next, you see the threaded-code cell for <code>fsin</code>.  There is no
dynamically-generated native code for this word, and <code>see-code</code> does
not show the static native code for it (you can look at it with <code>see
fsin</code>).  Like all words with static native code in <code>gforth-fast</code>, the
effect on the data stack representation is <code>1-&gt;1</code> (for <code>gforth</code>,
<code>0-&gt;0</code>), but this is not shown.
</p>
<p>Next, you see the threaded-code cell for <code>drop</code>; the native-code
variant used here starts with one data stack item in registers, and ends
with zero data stack items in registers (<code>1-&gt;0</code>).  This is followed by
the native code for this variant of <code>drop</code>.  There is no NEXT here,
because the native code falls through to the code for the next word.
</p>
<p>Next, you see the threaded-code cell for <code>over</code> followed by the
dynamically-generated native code in the <code>0-&gt;1</code> variant.
</p>
<p>Finally, you see the threaded and native code for <code>;s</code> (the primitive
compiled for <code>;</code> in <code>foo</code>).  <code>;s</code> performs control flow (it
returns), so it has to end with a NEXT.
</p>
</div>
<hr>
<div class="header">
<p>
Next: <a href="Examining-data.html">Examining data and code</a>, Previous: <a href="Locating-exception-source.html">Locating exception source</a>, Up: <a href="Programming-Tools.html">Programming Tools</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Word-Index.html" title="Index" rel="index">Index</a>]</p>
</div>



</body>
</html>
