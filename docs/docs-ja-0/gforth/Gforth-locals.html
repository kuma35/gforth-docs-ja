<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!-- Created by GNU Texinfo 6.8, https://www.gnu.org/software/texinfo/ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<!-- このマニュアルは、 標準 Forth 言語の高速で移植可能な実装である Gforth (バージョン 0.7.9_20240418,
April 18, 2024)用です。 これはリファレンス・マニュアルとして機能しますが、 Forth の概要と Forth
チュートリアルも含まれています。

Authors: Bernd Paysan, Anton Ertl, Gerald Wodni Copyright (C) 1995,
1996, 1997, 1998, 2000, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010,
2011, 2012, 2013, 2014,2015,2016,2017,2018,2019,2020,2021,2022,2023 Free
Software Foundation, Inc.

Permission is granted to copy, distribute and/or modify this document under
the terms of the GNU Free Documentation License, Version 1.1 or any later
version published by the Free Software Foundation; with no Invariant
Sections, with the Front-Cover texts being "A GNU Manual," and with the
Back-Cover Texts as in (a) below.  A copy of the license is included in the
section entitled "GNU Free Documentation License."

(a) The FSF's Back-Cover Text is: "You have freedom to copy and modify this
GNU Manual, like GNU software.  Copies published by the Free Software
Foundation raise funds for GNU development." -->
<title>Gforth locals (Gforth マニュアル)</title>

<meta name="description" content="Gforth locals (Gforth マニュアル)">
<meta name="keywords" content="Gforth locals (Gforth マニュアル)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<meta name="viewport" content="width=device-width,initial-scale=1">

<link href="index.html" rel="start" title="Top">
<link href="Word-Index.html" rel="index" title="Word Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Locals.html" rel="up" title="Locals">
<link href="Standard-Forth-locals.html" rel="next" title="Standard Forth locals">
<link href="Locals.html" rel="prev" title="Locals">
<style type="text/css">
<!--
a.copiable-anchor {visibility: hidden; text-decoration: none; line-height: 0em}
a.summary-letter {text-decoration: none}
blockquote.indentedblock {margin-right: 0em}
div.display {margin-left: 3.2em}
div.example {margin-left: 3.2em}
kbd {font-style: oblique}
pre.display {font-family: inherit}
pre.format {font-family: inherit}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
span.nolinebreak {white-space: nowrap}
span.roman {font-family: initial; font-weight: normal}
span.sansserif {font-family: sans-serif; font-weight: normal}
span:hover a.copiable-anchor {visibility: visible}
ul.no-bullet {list-style: none}
-->
</style>
<link rel="stylesheet" type="text/css" href="gforth.css">


</head>

<body lang="en">
<div class="subsection" id="Gforth-locals">
<div class="header">
<p>
Next: <a href="Standard-Forth-locals.html" accesskey="n" rel="next">Standard Forth locals</a>, Previous: <a href="Locals.html" accesskey="p" rel="prev">Locals</a>, Up: <a href="Locals.html" accesskey="u" rel="up">Locals</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Word-Index.html" title="Index" rel="index">Index</a>]</p>
</div>
<hr>
<span id="Gforth-locals-1"></span><h4 class="subsection">6.22.1 Gforth locals</h4>
<span id="index-Gforth-locals"></span>
<span id="index-locals_002c-Gforth-style"></span>

<p>ローカル変数は以下のように定義できます
</p>
<div class="example">
<pre class="example">{: local1 local2 ... -- comment :}
</pre></div>
<p>or
</p><div class="example">
<pre class="example">{: local1 local2 ... :}
</pre></div>
<p>or
</p><div class="example">
<pre class="example">{: local1 local2 ... | ulocal0 ulocal1 -- comment :}
</pre></div>

<p>例えば、 以下のように使います
</p><div class="example">
<pre class="example">: max {: n1 n2 -- n3 :}
 n1 n2 &gt; if
   n1
 else
   n2
 endif ;
</pre></div>

<p>ローカル変数定義とスタック・コメントは、 類似するよう意図しています。 ローカル変数定義は、 多くの場合、 ワードのスタック・コメントを置き換えます。
ローカル変数の順序はスタック・コメント内の順序に対応し、 <code>--</code> 以降はすべて実際はコメントです。
</p>
<p>この類似性には 1 つ欠点があります。 ローカル変数宣言とスタック・コメントを混同しやすく、 バグが発生し、 見つけにくくなります。 ただし、
この問題は適切なコーディング規約によって回避できます。 同じプログラム内で両方の表記法を使用しないでください。 そうする場合は、
追加の手段を使用して区別する必要があります。 例えば、 場所によって区別します。
</p>
<span id="index-types-of-locals"></span>
<span id="index-locals-types"></span>
<p>ローカルの名前の前に型指定子を付けることができます。 たとえば、浮動小数点値の場合は <code>F:</code> です:
</p>
<div class="example">
<pre class="example">: CX* {: F: Ar F: Ai F: Br F: Bi -- Cr Ci :}
\ 複素数の掛け算
 Ar Br f* Ai Bi f* f-
 Ar Bi f* Ai Br f* f+ ;
</pre></div>

<span id="index-flavours-of-locals"></span>
<span id="index-locals-flavours"></span>
<span id="index-value_002dflavoured-locals"></span>
<span id="index-varue_002dflavoured-locals"></span>
<span id="index-variable_002dflavoured-locals"></span>
<p>Gforth は現在、 セル型指定子(<code>W:</code>, <code>WA:</code>, <code>W^</code>)や、 2倍長整数型指定子(<code>D:</code>,
<code>DA:</code>, <code>D^</code>)や、 浮動小数点数型指定子(<code>F:</code>, <code>FA:</code>, <code>F^</code>)と、
さまざまなフレーバーの xt 型指定子(<code>xt:</code>, <code>xta:</code>)、 をサポートしています:
</p>
<dl compact="compact">
<dt><span><em>valueフレーバー(value-flavoured)</em></span></dt>
<dd><p>(see <a href="Values.html">Values</a>) valueフレーバーのローカル変数(<code>W:</code>、 <code>D:</code> などで定義)はその値を生成し、
<code>TO</code> で変更できます。
</p>
</dd>
<dt><span><em>varueフレーバー(vaLue ではなくて vaRue)</em></span></dt>
<dd><p>(see <a href="Varues.html">Varues</a>) varueフレーバーのローカル変数 <i>foo</i> (<code>WA:</code> などで定義) は、 <code>addr
<i>foo</i></code> を使用してアドレスを取得できること(変数のスコープを離れると無効になります)を除いて、
valueフレーバーのローカル変数とまったく同じように振る舞います。 現時点ではパフォーマンスに違いはありませんが、 長期的には、
valueフレーバーのローカル変数はレジスタに常駐できるため、 大幅に高速になるでしょう。
</p>
</dd>
<dt><span><em>variableフレーバー</em></span></dt>
<dd><p>(see <a href="Variables.html">Variables</a>) variableフレーバーのローカル変数(<code>W^</code>
などで定義)はそのアドレスを生成します(変数のスコープを離れると無効になります)。  たとえば、 標準のワード <code>emit</code> は、
以下のように variableフレーバーのローカル変数(<code>C^ char*</code>) と <code>type</code> で定義できます:
</p>
<div class="example">
<pre class="example">: emit {: C^ char* -- :}
    char* 1 type ;
</pre></div>

</dd>
<dt><span><em>deferフレーバー(defer-flavoured)</em></span></dt>
<dd><p>(see <a href="Deferred-Words.html">Deferred Words</a>) (<code>XT:</code> または <code>XTA:</code> と指定した) defer
フレーバーのローカル変数 xt を <code>execute</code> します。 <code>action-of</code> を使用すると、 defer
フレーバーのローカル変数から xt を取得できます。  ローカル変数が <code>xta:</code> で定義されている場合、 <code>addr</code>
を使用して、 xt が保存されているアドレス(ローカル変数のスコープの終わりまで有効)を取得できます。  たとえば、 標準のワード
<code>execute</code> は、 以下のように defer フレーバーのローカル変数で定義できます:
</p>
<div class="example">
<pre class="example">: execute {: xt: x -- :}
  x ;
</pre></div>

</dd>
</dl>

<span id="index-default-type-of-locals"></span>
<span id="index-locals_002c-default-type"></span>
<p>型指定子のないローカル変数は <code>W:</code> ローカル変数として扱われます。  以下を使用して <code>addr</code>
の使用を許可または禁止できます:
</p>
<span id="index-default_002dwa_003a-_0028--_002d_002d--_0029-gforth_002dexperimental"></span>
<span id="index-default_002dwa_003a"></span>
<span id="index-default_002dwa_003a-1"></span>
<div class="format">
<pre class="format"><code>default-wa:</code> ( <i>&ndash;  </i>) gforth-experimental &ldquo;default-wa:&rdquo;
</pre></div>
<p>型指定子なしで定義されたローカル変数で <code>addr</code> を許可します。  言い換えれば、 型指定子無しでローカル変数定義したときは
<code>wa:</code> 型指定子を指定したのと同じです
</p>

<span id="index-default_002dw_003a-_0028--_002d_002d--_0029-gforth_002dexperimental"></span>
<span id="index-default_002dw_003a"></span>
<span id="index-default_002dw_003a-1"></span>
<div class="format">
<pre class="format"><code>default-w:</code> ( <i>&ndash;  </i>) gforth-experimental &ldquo;default-w:&rdquo;
</pre></div>
<p>型指定子なしで定義されたローカル変数では <code>addr</code> を禁止します。  言い換えれば、 型指定子なしで定義されたローカル変数は
<code>w:</code> 型指定子を指定してローカル変数を定義したのと同じです。
</p>


<span id="index-locals-initialization"></span>
<span id="index-initialization-of-locals"></span>
<p><code>|</code> の後ろで定義されたローカル変数を除いて、 ローカル変数の全てのフレーバーは、 データ・スタックの値または、 (FP
ローカル変数の場合) FP スタックの値で初期化されます。 Gforth は <code>|</code> の後ろで定義されたローカル変数を 0 に初期化します。
一部の Forth システムでは初期化されないままになっています。
</p>
<span id="index-data-structure-locals"></span>
<p>Gforth は、 ローカル・バッファーとデータ構造体のための角括弧(square bracket)表記をサポートしています。  これらのローカル変数は
variableフレーバーのローカル変数に似ており、 サイズは定数式として指定します。  宣言は <code><i>name</i>[ <i>size</i> ]</code>
のようになります。  Forth の式 <code><i>size</i></code> は宣言中に評価され、 サイズをバイト単位で指定するスタック効果 <code>(
-- +n )</code> が必要です。  なお、 角括弧 <code>[</code> は定義された名前の一部です。
</p>
<p>ローカルのデータ構造体は、 データ・スタックに渡されたアドレスから <i>size</i> バイトをコピーすることによって初期化されます。 (宣言内の
<code>|</code> の後の、)初期化されていないローカルのデータ構造体は消去されず、 以前にローカル・スタックにあったデータをすべて含むだけです。
</p>
<p>Example:
</p>
<div class="example">
<pre class="example">begin-structure test-struct
  field: a1
  field: a2
end-structure

: test-local {: foo[ test-struct ] :}
    foo[ a1 !  foo[ a2 !
    foo[ test-struct dump ;
</pre></div>

<p>Gforth では、コロン定義内のあらゆる場所でローカル変数を定義できます。 これにより、 以下のような疑問が生じます:
</p>

<ul class="section-toc">
<li><a href="Locals-definition-words.html" accesskey="1">Locals definitions words</a></li>
<li><a href="Where-are-locals-visible-by-name_003f.html" accesskey="2">Where are locals visible by name?</a></li>
<li><a href="How-long-do-locals-live_003f.html" accesskey="3">How long do locals live?</a></li>
<li><a href="Locals-programming-style.html" accesskey="4">Locals programming style</a></li>
<li><a href="Locals-implementation.html" accesskey="5">Locals implementation</a></li>
<li><a href="Closures.html" accesskey="6">Closures</a></li>
</ul>
</div>
<hr>
<div class="header">
<p>
Next: <a href="Standard-Forth-locals.html">Standard Forth locals</a>, Previous: <a href="Locals.html">Locals</a>, Up: <a href="Locals.html">Locals</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Word-Index.html" title="Index" rel="index">Index</a>]</p>
</div>



</body>
</html>
