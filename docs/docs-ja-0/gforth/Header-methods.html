<!DOCTYPE html>
<html>
<!-- Created by GNU Texinfo 7.1, https://www.gnu.org/software/texinfo/ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<!-- このマニュアルは、 標準 Forth 言語の高速で移植可能な実装である Gforth (バージョン 0.7.9_20240418,
April 18, 2024)用です。 これはリファレンス・マニュアルとして機能しますが、 Forth の概要と Forth
チュートリアルも含まれています。

Authors: Bernd Paysan, Anton Ertl, Gerald Wodni Copyright © 1995,
1996, 1997, 1998, 2000, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010,
2011, 2012, 2013, 2014,2015,2016,2017,2018,2019,2020,2021,2022,2023 Free
Software Foundation, Inc.

Permission is granted to copy, distribute and/or modify this document under
the terms of the GNU Free Documentation License, Version 1.1 or any later
version published by the Free Software Foundation; with no Invariant
Sections, with the Front-Cover texts being "A GNU Manual," and with the
Back-Cover Texts as in (a) below.  A copy of the license is included in the
section entitled "GNU Free Documentation License."

(a) The FSF's Back-Cover Text is: "You have freedom to copy and modify this
GNU Manual, like GNU software.  Copies published by the Free Software
Foundation raise funds for GNU development." -->
<title>Header methods (Gforth マニュアル)</title>

<meta name="description" content="Header methods (Gforth マニュアル)">
<meta name="keywords" content="Header methods (Gforth マニュアル)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<meta name="viewport" content="width=device-width,initial-scale=1">

<link href="index.html" rel="start" title="Top">
<link href="Word-Index.html" rel="index" title="Word Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Carnal-words.html" rel="up" title="Carnal words">
<link href="Threading-Words.html" rel="next" title="Threading Words">
<link href="Header-fields.html" rel="prev" title="Header fields">
<style type="text/css">
<!--
a.copiable-link {visibility: hidden; text-decoration: none; line-height: 0em}
div.example {margin-left: 3.2em}
pre.format-preformatted {font-family: inherit}
span:hover a.copiable-link {visibility: visible}
-->
</style>
<link rel="stylesheet" type="text/css" href="gforth.css">


</head>

<body lang="en">
<div class="subsection-level-extent" id="Header-methods">
<div class="nav-panel">
<p>
Next: <a href="Threading-Words.html" accesskey="n" rel="next">Threading Words</a>, Previous: <a href="Header-fields.html" accesskey="p" rel="prev">Header fields</a>, Up: <a href="Carnal-words.html" accesskey="u" rel="up">Carnal words</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Word-Index.html" title="Index" rel="index">Index</a>]</p>
</div>
<hr>
<h4 class="subsection" id="Header-methods-1"><span>6.30.2 Header methods<a class="copiable-link" href="#Header-methods-1"> &para;</a></span></h4>
<a class="index-entry-id" id="index-header-methods"></a>

<p>新しい Gforth ワード・ヘッダーはオブジェクト指向であり、 以下のメソッド(メソッド・セレクター)をサポートします:
</p>
<div class="example">
<pre class="example-preformatted">.hm label method          overrider        field
          execute         set-execute      &gt;cfa
opt:      opt-compile,    set-optimizer    &gt;hmcompile,
to:       (to)            set-to           &gt;hmto
extra:                                     &gt;hmextra
&gt;int:     name&gt;interpret  set-&gt;int         &gt;hm&gt;int
&gt;comp:    name&gt;compile    set-&gt;comp        &gt;hm&gt;comp
&gt;string:  name&gt;string     set-name&gt;string  &gt;hm&gt;string
&gt;link:    name&gt;link       set-name&gt;link    &gt;hm&gt;link
</pre></div>

<p>これらのワードの多くは定着(stable)した Gforth ワードではありませんが、 Gforth には後述する定着した高レベルのワードがあります。
</p>
<p>以下を使用すると、 ワードのヘッダー・メソッドを確認できます
</p>
<a class="index-entry-id" id="index-_002ehm-_0028-nt-_002d_002d-_0029-gforth_002d1_002e0"></a>
<a class="index-entry-id" id="index-_002ehm"></a>
<a class="index-entry-id" id="index-_002ehm-1"></a>
<div class="format">
<pre class="format-preformatted"><code class="code">.hm</code> ( <i class="i">nt &ndash;  </i>) gforth-1.0 &ldquo;dot-h-m&rdquo;
</pre></div>
<p><i class="i">nt</i> のヘッダー・メソッドを出力します
</p>


<p>オーバーライダー(overrider)(セッター)ワードは、 最新の定義のメソッド実装を変更します。  クォーテーションまたはクロージャーは、
完了時に以前の最新の定義を復元するため、 最新のものとはみなされず、 以下のようなことができます:
</p>
<div class="example">
<pre class="example-preformatted">: my2dup over over ;
[: drop ]] over over [[ ;] set-optimizer
</pre></div>

<p><code class="code">execute</code> メソッドは、 パフォーマンス上の理由から、 実際にはヘッダー・メソッド・テーブルではなくヘッダーの <code class="code">&gt;cfa</code>
フィールドに格納されます。 また、 他のメソッドは xt を呼び出すことによって実装されますが、 ネイティブ・コード・アドレスを通じて実装されます。
このメソッドを設定する大まかな方法​​は以下のとおりです
</p>
<a class="index-entry-id" id="index-set_002dexecute-_0028-ca-_002d_002d-_0029-gforth_002d1_002e0"></a>
<a class="index-entry-id" id="index-set_002dexecute"></a>
<a class="index-entry-id" id="index-set_002dexecute-1"></a>
<div class="format">
<pre class="format-preformatted"><code class="code">set-execute</code> ( <i class="i">ca &ndash;  </i>) gforth-1.0 &ldquo;set-execute&rdquo;
</pre></div>
<p><i class="i">ca</i> のネイティブ・コードにジャンプするように現在のワードを変更します。  また、 <code class="code">compile,</code>
実装を最も一般的な(そして最も遅い)実装に変更します。  より効率的な <code class="code">compile,</code> 実装が必要な場合は、 後で
<code class="code">set-optimizer</code> を呼び出します。
</p>


<p><code class="code">set-execute</code> で使用するコード・アドレスを取得するには、 <code class="code">docol:</code> または
<code class="code">&gt;code-address</code> などのワードを使用できます。 See <a class="xref" href="Threading-Words.html">Threading Words</a>
</p>
<p><code class="code">set-execute</code> の代わりに、 xt を受け取る <code class="code">set-does&gt;</code> (see <a class="pxref" href="User_002ddefined-Defining-Words.html">User-defined Defining Words</a>)もあります。
</p>
<p>さらに、 低レベルの <code class="code">code-address!</code> と <code class="code">definer!</code> があります。 (see <a class="pxref" href="Threading-Words.html">Threading Words</a>)
</p>
<p><code class="code">opt-compile,</code> メソッドは、 ほとんどの Gforth エンジンで動く <code class="code">compile,</code>
です(<code class="code">gforth-itc</code> は代わりに <code class="code">,</code> を使用します)。  <code class="code">set-optimizer</code> を使用して、
現在のワードに対する <code class="code">compile,</code> のより効率的な実装を定義できます((see <a class="pxref" href="User_002ddefined-compile_002dcomma.html">User-defined <code class="code">compile,</code></a>))。 注意: 最終結果は <code class="code">postpone literal postpone execute</code>
と同等でなければならないことに注意してください。
</p>
<p><code class="code">set-optimizer</code> の使用例として、 以下の <code class="code">constant</code> の定義を考えてみましょう:
</p>
<div class="example">
<pre class="example-preformatted">: constant ( n &quot;name&quot; -- ; name: -- n )
  create ,
  ['] @ set-does&gt;
;

5 constant five
: foo five ; see foo
</pre></div>

<p>Forth システムは、 定数の値を変更してはならないことを認識せず、 単に <code class="code">create</code> されたワード (<code class="code">&gt;body</code>
で変更可能)として見て、 <code class="code">foo</code> は最初に <code class="code">five</code> のボティのアドレスをスタックにプッシュし、
その次にそこから値を取得します。 <code class="code">set-optimizer</code> を使用すると、 <code class="code">constant</code>
の定義を以下のように最適化できます:
</p>
<div class="example">
<pre class="example-preformatted">: constant ( n &quot;name&quot; -- ; name: -- n )
  create ,
  ['] @ set-does&gt;
  [: &gt;body @ postpone literal ;] set-optimizer
;
</pre></div>

<p>いまや、 <code class="code">foo</code> には、 <code class="code">five</code> の呼び出しではなく、 即値(literal)の 5 が含まれるようになりました。
</p>
<p>注意: <code class="code">set-execute</code> と <code class="code">set-does&gt;</code> は、<code class="code">execute</code> と <code class="code">compile,</code>
が一致していることを確認するために、 <code class="code">set-optimizer</code> 自体を実行することに注意してください。
あなた独自のオプティマイザーを追加するには、 後で追加する必要があります。
</p>
<p><code class="code">defer!</code> (別名 <code class="code">(to)</code> メソッド(see <a class="pxref" href="User_002ddefined-TO-and-DEFER_0040.html">User-defined <code class="code">to</code> and <code class="code">defer@</code></a>)は、
<code class="code">defer</code> で定義されたワードおよび類似のワードに対して <code class="code">defer!</code> を実装します。 ですが、 これは <code class="code">to</code>
の核心(core)でもあります。 <code class="code">defer!</code>/<code class="code">(to)</code> メソッドの一般的なスタック効果は <code class="code">( val xt
-- )</code> です。 ここで <i class="i">xt</i> は格納されているワードを示し、 <i class="i">val</i> はそこに格納されている(適切な型の)値です。
</p>
<p>たとえば、 以下のように <code class="code">fvalue</code> を実装できます:
</p>
<div class="example">
<pre class="example-preformatted">: fvalue-to ( r xt -- ) &gt;body f! ;

: fvalue ( r -- )
  create f,
  ['] f@ set-does&gt;
  ['] fvalue-to set-to ;

5e fvalue foo
: bar foo 1e f+ to foo ;
see bar
</pre></div>

<p><code class="code">set-optimizer</code> を使用して、 生成されたコードを改善できます:
</p>
<div class="example">
<pre class="example-preformatted">: compile-fvalue-to ( xt-value-to -- )
  drop ]] &gt;body f! [[ ;
  
: fvalue-to ( r xt -- ) &gt;body f! ;
' compile-fvalue-to set-optimizer

: fvalue ( r -- )
  create f,
  ['] f@ set-does&gt;
  [: &gt;body ]] literal f@ [[ ;] set-optimizer
  ['] fvalue-to set-to ;

5e fvalue foo
: bar foo 1e f+ to foo ;
see bar
</pre></div>

<p>実際には、 Gforth には、 <code class="code">+TO</code> など、 実装するための追加の工夫がいくつかあります。
</p>
<p><code class="code">Set-defer@</code> (see <a class="pxref" href="User_002ddefined-TO-and-DEFER_0040.html">User-defined <code class="code">to</code> and <code class="code">defer@</code></a>) を使用すると、
<code class="code">defer</code> のようなワードに対して <code class="code">defer@</code> (see <a class="pxref" href="Deferred-Words.html">Deferred Words</a>)
メソッドのバリエーションを実装できます。
</p>
<p><code class="code">&gt;hmextra</code> フィールドは、 追加のデータをヘッダー・メソッド・テーブルに保存する必要がある場合に使用されます。  特に、 それは
<code class="code">set-does&gt;</code> に渡す xt を保存し(そして <code class="code">does&gt;</code> は <code class="code">set-does&gt;</code> を呼び出し)、
そして、 <code class="code">;abi-code</code> の後のコードのアドレスを保存します。
</p>
<p>これらのメソッドはすべて、 nt ではなく xt を使用しますが、 オーバーライド・ワード(override words)は最新の定義で機能します。
これは、 たとえば、 同義語(synonym)に対して <code class="code">set-optimizer</code> を使用した場合、
その効果はおそらくあなたが意図したものとは異なることを意味します。 ワードの xt を <code class="code">compile,</code> する場合、
新たに設定された同義語(synonym)ではなく、 元のワードの <code class="code">opt-compile,</code> 実装が使用されます。
</p>
<p>以下のメソッド達は nt を消費します。
</p>
<p><code class="code">name&gt;interpret</code> メソッドは、 同義語(synonym)や類似のワードを除くほとんどのワードに対して noop
として実装されます。
</p>
<a class="index-entry-id" id="index-set_002d_003eint-_0028-xt-_002d_002d-_0029-gforth_002d1_002e0"></a>
<a class="index-entry-id" id="index-set_002d_003eint"></a>
<a class="index-entry-id" id="index-set_002d_003eint-1"></a>
<div class="format">
<pre class="format-preformatted"><code class="code">set-&gt;int</code> ( <i class="i">xt &ndash;  </i>) gforth-1.0 &ldquo;set-to-int&rdquo;
</pre></div>
<p>現在のワードの <code class="code">name&gt;interpret (nt -- xt2 )</code> メソッドの実装を <i class="i">xt</i> に設定します。
</p>


<p><code class="code">name&gt;compile</code> メソッドは、 nt のコンパイル機能(compilation semantics)を生成します。
<code class="code">set-&gt;comp</code> で変更することでコンパイル機能を変更できますが、 <code class="code">name&gt;compile</code> のスタック効果のため、
目的のコンパイル機能の xt をプッシュするだけというほど単純ではありません。  一般に、 コンパイル機能の変更は避ける必要があり、 変更する場合は、
<code class="code">immediate</code> または <code class="code">interpret/compile:</code>
などの高レベル・ワードを使用してください(See <a class="xref" href="Combined-words.html">Combined Words</a>)。
</p>
<a class="index-entry-id" id="index-set_002d_003ecomp-_0028-xt-_002d_002d-_0029-gforth_002d1_002e0"></a>
<a class="index-entry-id" id="index-set_002d_003ecomp"></a>
<a class="index-entry-id" id="index-set_002d_003ecomp-1"></a>
<div class="format">
<pre class="format-preformatted"><code class="code">set-&gt;comp</code> ( <i class="i">xt &ndash;  </i>) gforth-1.0 &ldquo;set-to-comp&rdquo;
</pre></div>
<p>現在のワードの <code class="code">name&gt;compile ( nt -- w xt2 )</code> メソッドの実装を <i class="i">xt</i> に設定します。
</p>

<a class="index-entry-id" id="index-immediate_003f-_0028-nt-_002d_002d-flag-_0029-gforth_002d1_002e0"></a>
<a class="index-entry-id" id="index-immediate_003f"></a>
<a class="index-entry-id" id="index-immediate_003f-1"></a>
<div class="format">
<pre class="format-preformatted"><code class="code">immediate?</code> ( <i class="i">nt &ndash; flag  </i>) gforth-1.0 &ldquo;immediate?&rdquo;
</pre></div>
<p>ワード <i class="i">nt</i> がデフォルト以外のコンパイル機能(compilation semantics)を持っている場合は true
(これは即時性(immediacy)の定義と完全には一致しませんが、
多くの人はワード語を「即時」(immediate)と呼ぶときはこれを意味しています)。
</p>


<p><code class="code">Name&gt;string</code> および <code class="code">Name&gt;link</code> は、 noname ヘッダーから  name と <code class="code">&gt;f+c</code>
と <code class="code">link</code> フィールドを削除できるようにするためのメソッドです。 これらのワードを使用すると意味のある結果が得られます。  通常、
<code class="code">noname</code> を使用する場合を除き、 これらのメソッドの実装を変更することはありませんが、
あなたがそれでも必要とするなら以下をご覧ください
</p>
<a class="index-entry-id" id="index-set_002dname_003estring-_0028-xt-_002d_002d-_0029-gforth_002d1_002e0"></a>
<a class="index-entry-id" id="index-set_002dname_003estring"></a>
<a class="index-entry-id" id="index-set_002dname_003estring-1"></a>
<div class="format">
<pre class="format-preformatted"><code class="code">set-name&gt;string</code> ( <i class="i">xt &ndash;  </i>) gforth-1.0 &ldquo;set-name-to-string&rdquo;
</pre></div>
<p>現在のワードの <code class="code">name&gt;string ( nt -- addr u )</code> メソッドの実装を <i class="i">xt</i> に設定します。
</p>

<a class="index-entry-id" id="index-set_002dname_003elink-_0028-xt-_002d_002d-_0029-gforth_002d1_002e0"></a>
<a class="index-entry-id" id="index-set_002dname_003elink"></a>
<a class="index-entry-id" id="index-set_002dname_003elink-1"></a>
<div class="format">
<pre class="format-preformatted"><code class="code">set-name&gt;link</code> ( <i class="i">xt &ndash;  </i>) gforth-1.0 &ldquo;set-name-to-link&rdquo;
</pre></div>
<p>現在のワードの <code class="code">name&gt;link (nt1 -- nt2|0 )</code> メソッドの実装を <i class="i">xt</i> に設定します。
</p>


</div>
<hr>
<div class="nav-panel">
<p>
Next: <a href="Threading-Words.html">Threading Words</a>, Previous: <a href="Header-fields.html">Header fields</a>, Up: <a href="Carnal-words.html">Carnal words</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Word-Index.html" title="Index" rel="index">Index</a>]</p>
</div>



</body>
</html>
